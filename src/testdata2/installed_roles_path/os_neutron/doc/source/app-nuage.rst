=========================================
Scenario - Using the Nuage neutron plugin
=========================================

Introduction
~~~~~~~~~~~~

Follow these steps to deploy Nuage Networks VCS with OpenStack-Ansible
(OSA):

- Install prerequisites.

- Configure neutron to use the Nuage Networks neutron plugin.

- Configure the Nuage Networks neutron plugin.

- Download Nuage Networks VCS components and playbooks.

- Execute the playbooks.

Prerequisites
~~~~~~~~~~~~~

#. The deployment environment is configured according to OSA best
   practices such as cloning OSA software and bootstrapping Ansible.
   See `OpenStack-Ansible Install Guide
   <https://docs.openstack.org/project-deploy-guide/openstack-ansible/newton/>`_.

#. VCS stand-alone components, VSD and VSC, are configured and
   deployed. See the Nuage Networks VSD and VSC Install Guides.

#. Nuage VRS playbooks were cloned to the deployment host from
   `https://github.com/nuagenetworks/nuage-openstack-ansible
   <https://github.com/nuagenetworks/nuage-openstack-ansible>`_. This
   guide assumes a deployment host path of
   ``/opt/nuage-openstack-ansible``.

Configure Nuage neutron plugin
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Configuring the neutron plugin requires creating or editing of
parameters in the following two files:

- ``/etc/openstack_deploy/user_nuage_vars.yml``

- ``/etc/openstack_deploy/user_variables.yml``

On the deployment host, copy the Nuage user variables file from
``/opt/nuage-openstack-ansible/etc/user_nuage_vars.yml`` to the
``/etc/openstack_deploy/`` folder.

.. code-block:: console

   # cp /opt/nuage-openstack-ansible/etc/user_nuage_vars.yml \
     /etc/openstack_deploy/

Next, modify the following parameters in that file as per your Nuage
VCS environment:

#. Replace *VSD Enterprise Name* with the name of VSD Enterprise:

   .. code-block:: yaml

      nuage_net_partition_name: "<VSD Enterprise Name>"

#. Replace *VSD IP* and *VSD GUI Port* as per your VSD configuration:

   .. code-block:: yaml

      nuage_vsd_ip: "<VSD IP>:<VSD GUI Port>"

#. Replace *VSD Username, VSD Password*, and *VSD Organization Name*
   with your login credentials for the VSD GUI:

   .. code-block:: yaml

      nuage_vsd_username: "<VSD Username>"

      nuage_vsd_password: "<VSD Password>"

      nuage_vsd_organization: "<VSD Organization Name>"

#. Replace *Nuage VSP Version* with the Nuage VSP release for
   Integration. For example, for Nuage VSP release 3.2 this value
   would be *v3\_2*.

   .. code-block:: yaml

      nuage_base_uri_version: "<Nuage VSP Version>"

#. Replace *Nuage VSD CMS Id* with the ``CMS-Id`` generated by VSD to
   manage your OpenStack cluster:

   .. code-block:: yaml

      nuage_cms_id: "<Nuage VSD CMS Id>"

#. Replace *Active VSC-IP* with the IP address of your active VSC node
   and *Standby VSC-IP* with the IP address of your standby VSC node:

   .. code-block:: yaml

      active_controller: "<Active VSC-IP>"

      standby_controller: "<Standby VSC-IP>"

#. Replace *Local Package Repository* with the link of the local
   repository hosting the Nuage VRS packages. For example:
   ``http://192.0.2.10/debs/3.2/vrs/``:

   .. code-block:: yaml

      nuage_vrs_debs_repo: "deb <Local Package Repository>"

#. On the Deployment host, add the following lines to the
   ``/etc/openstack_deploy/user_variables.yml`` file, replacing the
   *Local PyPi Mirror URL* with the link to the PyPi server hosting
   the Nuage OpenStack Python packages in ".whl" format:

   .. code-block:: yaml

      neutron_plugin_type: "nuage"
      nova_network_type: "nuage"
      pip_links:
        - { name: "openstack_release", link: "{{ openstack_repo_url \
          }}/os-releases/{{ openstack_release }}/" }
        - { name: "nuage_repo", link: "<Local PyPi Mirror URL>" }

Installation
~~~~~~~~~~~~

#. After you set up the multi-node OpenStack cluster, start the
   OpenStack deployment as listed in the OpenStack-Ansible Install
   guide by running all playbooks in sequence on the deployment host.

#. After OpenStack deployment is complete, deploy Nuage VRS on all
   compute target hosts in the OpenStack cluster by running the Nuage
   VRS playbooks in ``/opt/nuage-openstack-ansible/nuage_playbook`` on
   your deployment host:

   .. code-block:: console

      # cd /opt/nuage-openstack-ansible/nuage_playbooks
      # openstack-ansible nuage_all.yml

   .. note::

      To obtain Nuage Networks VSP software packages, user
      documentation, and licenses, contact ``info@nuagenetworks.net``.
