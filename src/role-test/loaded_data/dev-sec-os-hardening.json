{"py/object": "struct4.Repository", "name": "", "path": "", "my_collection_name": "", "playbooks": [], "roles": [], "installed_collections_path": "", "installed_collections": [], "installed_roles_path": "./role-test/testdata/dev-sec-os-hardening", "installed_roles": [{"py/object": "struct4.Role", "name": "dev-sec.os-hardening", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening", "fqcn": "dev-sec.os-hardening", "collection": "", "taskfiles": [{"py/object": "struct4.TaskFile", "name": "user_accounts.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "tasks": [{"py/object": "struct4.Task", "name": "get UID_MIN from login.defs", "module": "shell", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "get UID_MIN from login.defs", "args": {"removes": "/etc/login.defs"}, "register": "uid_min", "check_mode": false, "changed_when": false}, "module_options": "awk '/^\\s*UID_MIN\\s*([0-9]*).*?$/ {print $2}' /etc/login.defs", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "calculate UID_MAX from UID_MIN by substracting 1", "module": "set_fact", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "calculate UID_MAX from UID_MIN by substracting 1", "when": "uid_min.stdout|int > 0"}, "module_options": {"uid_max": "{{ uid_min.stdout | int - 1 }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "set UID_MAX on Debian-systems if no login.defs exist", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "set UID_MAX on Debian-systems if no login.defs exist", "when": ["ansible_facts.os_family == 'Debian'", "uid_max is not defined"]}, "module_options": {"uid_max": "999"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "set UID_MAX on other systems if no login.defs exist", "module": "set_fact", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "set UID_MAX on other systems if no login.defs exist", "when": "uid_max is not defined"}, "module_options": {"uid_max": "499"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "get all system accounts", "module": "command", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "get all system accounts", "args": {"removes": "/etc/passwd"}, "changed_when": false, "check_mode": false, "register": "sys_accs"}, "module_options": "awk -F'':'' '{ if ( $3 <= {{ uid_max|quote }} ) print $1}' /etc/passwd", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove always ignored system accounts from list", "module": "set_fact", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "remove always ignored system accounts from list", "check_mode": false}, "module_options": {"sys_accs_cond": "{{ sys_accs.stdout_lines | difference(os_always_ignore_users) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "change system accounts not on the user provided ignore-list", "module": "user", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "change system accounts not on the user provided ignore-list", "with_flattened": ["{{ sys_accs_cond | default([]) | difference(os_ignore_users) | list }}"]}, "module_options": {"name": "{{ item }}", "shell": "{{ os_nologin_shell_path }}", "password": "*", "createhome": false}, "executable": "user", "executable_type": "Module", "fqcn": "ansible.builtin.user", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "rhosts.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "tasks": [{"py/object": "struct4.Task", "name": "Get user accounts | os-09", "module": "command", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "Get user accounts | os-09", "changed_when": false, "check_mode": false, "register": "users_accounts"}, "module_options": "awk -F: '{print $1}' /etc/passwd", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete rhosts-files from system | os-09", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete rhosts-files from system | os-09", "with_flattened": "{{ users_accounts.stdout_lines | default([]) }}"}, "module_options": {"dest": "~{{ item }}/.rhosts", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete hosts.equiv from system | os-01", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete hosts.equiv from system | os-01"}, "module_options": {"dest": "/etc/hosts.equiv", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete .netrc-files from system | os-09", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete .netrc-files from system | os-09", "with_flattened": "{{ users_accounts.stdout_lines | default([]) }}"}, "module_options": {"dest": "~{{ item }}/.netrc", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "securetty.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/securetty.yml", "tasks": [{"py/object": "struct4.Task", "name": "create securetty", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/securetty.yml", "options": {"name": "create securetty"}, "module_options": {"src": "etc/securetty.j2", "dest": "/etc/securetty", "owner": "root", "group": "root", "mode": "0400"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "minimize_access.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "tasks": [{"py/object": "struct4.Task", "name": "find files with write-permissions for group", "module": "shell", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "find files with write-permissions for group", "with_flattened": ["/usr/local/sbin", "/usr/local/bin", "/usr/sbin", "/usr/bin", "/sbin", "/bin", "{{ os_env_extra_user_paths }}"], "register": "minimize_access_directories", "ignore_errors": true, "changed_when": false}, "module_options": "find -L {{ item }} -perm /go+w -type f", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "minimize access on found files", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "minimize access on found files", "with_subelements": ["{{ minimize_access_directories.results }}", "stdout_lines"]}, "module_options": {"path": "{{ item.1 }}", "mode": "go-w", "state": "file"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "change shadow ownership to root and mode to 0600 | os-02", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change shadow ownership to root and mode to 0600 | os-02"}, "module_options": {"dest": "/etc/shadow", "owner": "{{ os_shadow_perms.owner }}", "group": "{{ os_shadow_perms.group }}", "mode": "{{ os_shadow_perms.mode }}"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "change passwd ownership to root and mode to 0644 | os-03", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change passwd ownership to root and mode to 0644 | os-03"}, "module_options": {"dest": "/etc/passwd", "owner": "{{ os_passwd_perms.owner }}", "group": "{{ os_passwd_perms.group }}", "mode": "{{ os_passwd_perms.mode }}"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "change su-binary to only be accessible to user and group root", "module": "file", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change su-binary to only be accessible to user and group root", "when": "\"change_user\" not in os_security_users_allow"}, "module_options": {"dest": "/bin/su", "owner": "root", "group": "root", "mode": "0750"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "set option hidepid for proc filesystem", "module": "mount", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "set option hidepid for proc filesystem"}, "module_options": {"path": "/proc", "src": "proc", "fstype": "proc", "opts": "{{ proc_mnt_options }}", "state": "present"}, "executable": "mount", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "limits.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "tasks": [{"py/object": "struct4.Task", "name": "create limits.d-directory if it does not exist | sysctl-31a, sysctl-31b", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "create limits.d-directory if it does not exist | sysctl-31a, sysctl-31b"}, "module_options": {"path": "/etc/security/limits.d", "owner": "root", "group": "root", "mode": "0755", "state": "directory"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "create additional limits config file -> 10.hardcore.conf | sysctl-31a, sysctl-31b", "module": "pam_limits", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "create additional limits config file -> 10.hardcore.conf | sysctl-31a, sysctl-31b"}, "module_options": {"dest": "/etc/security/limits.d/10.hardcore.conf", "domain": "*", "limit_type": "hard", "limit_item": "core", "value": "0", "comment": "Prevent core dumps for all users. These are usually not needed and may contain sensitive information"}, "executable": "pam_limits", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "set 10.hardcore.conf perms to 0400 and root ownership", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "set 10.hardcore.conf perms to 0400 and root ownership"}, "module_options": {"path": "/etc/security/limits.d/10.hardcore.conf", "owner": "root", "group": "root", "mode": "0440"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove 10.hardcore.conf config file", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "remove 10.hardcore.conf config file", "when": "os_security_kernel_enable_core_dump | bool"}, "module_options": {"path": "/etc/security/limits.d/10.hardcore.conf", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "selinux.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/selinux.yml", "tasks": [{"py/object": "struct4.Task", "name": "configure selinux | selinux-01", "module": "selinux", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/selinux.yml", "options": {"name": "configure selinux | selinux-01"}, "module_options": {"policy": "{{ os_selinux_policy }}", "state": "{{ os_selinux_state }}"}, "executable": "selinux", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "profile.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "tasks": [{"py/object": "struct4.Task", "name": "add pinerolo_profile.sh to profile.d", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "options": {"name": "add pinerolo_profile.sh to profile.d", "when": "not os_security_kernel_enable_core_dump | bool"}, "module_options": {"src": "etc/profile.d/profile.conf.j2", "dest": "/etc/profile.d/pinerolo_profile.sh", "owner": "root", "group": "root", "mode": "0750"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pinerolo_profile.sh from profile.d", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "options": {"name": "remove pinerolo_profile.sh from profile.d", "when": "os_security_kernel_enable_core_dump | bool"}, "module_options": {"path": "/etc/profile.d/pinerolo_profile.sh", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "pam.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "tasks": [{"py/object": "struct4.Task", "name": "update pam on Debian systems", "module": "command", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "update pam on Debian systems", "when": "ansible_facts.distribution in ['Debian', 'Ubuntu']", "changed_when": false, "environment": {"DEBIAN_FRONTEND": "noninteractive"}}, "module_options": "pam-auth-update --package", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pam ccreds to disable password caching", "module": "package", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam ccreds to disable password caching"}, "module_options": {"name": "{{ os_packages_pam_ccreds }}", "state": "absent"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pam_cracklib, because it does not play nice with passwdqc", "module": "apt", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam_cracklib, because it does not play nice with passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_cracklib }}", "state": "absent"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "install the package for strong password checking", "module": "apt", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install the package for strong password checking", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "present", "update_cache": "yes"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure passwdqc", "module": "template", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"src": "usr/share/pam-configs/pam_passwdqd.j2", "dest": "{{ passwdqc_path }}", "mode": "0644", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove passwdqc", "module": "apt", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "absent"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "install tally2", "module": "apt", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install tally2", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries > 0"]}, "module_options": {"name": "libpam-modules", "state": "present"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure tally2", "module": "template", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure tally2", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries > 0"]}, "module_options": {"src": "usr/share/pam-configs/pam_tally2.j2", "dest": "{{ tally2_path }}", "mode": "0644", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete tally2 when retries is 0", "module": "file", "index": 8, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "delete tally2 when retries is 0", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries == 0"]}, "module_options": {"path": "{{ tally2_path }}", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pam_cracklib, because it does not play nice with passwdqc", "module": "yum", "index": 9, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam_cracklib, because it does not play nice with passwdqc", "when": ["ansible_facts.os_family == 'RedHat'", "ansible_facts.distribution_major_version|int is version('7', '<')", "ansible_facts.distribution != 'Amazon'", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_cracklib }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "install the package for strong password checking", "module": "yum", "index": 10, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install the package for strong password checking", "when": ["ansible_facts.os_family == 'RedHat'", "ansible_facts.distribution_major_version|int is version('7', '<')", "ansible_facts.distribution != 'Amazon'", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "present"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove passwdqc", "module": "yum", "index": 11, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove passwdqc", "when": ["ansible_facts.os_family == 'RedHat'", "not os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure passwdqc and tally via central system-auth confic", "module": "template", "index": 12, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure passwdqc and tally via central system-auth confic", "when": "ansible_facts.os_family == 'RedHat'"}, "module_options": {"src": "etc/pam.d/rhel_system_auth.j2", "dest": "/etc/pam.d/system-auth-ac", "mode": "0640", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather package facts", "module": "package_facts", "index": 13, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "Gather package facts", "when": "ansible_facts.os_family != 'Suse'"}, "module_options": {"manager": "auto"}, "executable": "package_facts", "executable_type": "Module", "fqcn": "ansible.builtin.package_facts", "annotations": {}}, {"py/object": "struct4.Task", "name": "NSA 2.3.3.5 Upgrade Password Hashing Algorithm to SHA-512", "module": "template", "index": 14, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "NSA 2.3.3.5 Upgrade Password Hashing Algorithm to SHA-512", "when": ["ansible_facts.os_family != 'Suse'", "'libuser' in ansible_facts.packages"]}, "module_options": {"src": "etc/libuser.conf.j2", "dest": "/etc/libuser.conf", "mode": "0640", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "hardening.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "tasks": [{"py/object": "struct4.Task", "name": "Set OS family dependent variables", "module": "include_vars", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"name": "Set OS family dependent variables", "tags": "always"}, "module_options": "{{ ansible_facts.os_family }}.yml", "executable": "include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set OS dependent variables", "module": "include_vars", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"name": "Set OS dependent variables", "with_first_found": [{"files": ["{{ ansible_facts.distribution }}-{{ ansible_facts.distribution_major_version }}.yml", "{{ ansible_facts.distribution }}.yml", "{{ ansible_facts.os_family }}-{{ ansible_facts.distribution_major_version }}.yml"], "skip": true}], "tags": "always"}, "module_options": "{{ item }}", "executable": "include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "auditd", "when": "os_auditd_enabled | bool"}, "module_options": "auditd.yml", "executable": "auditd.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "limits"}, "module_options": "limits.yml", "executable": "limits.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "login_defs"}, "module_options": "login_defs.yml", "executable": "login_defs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "minimize_access"}, "module_options": "minimize_access.yml", "executable": "minimize_access.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "pam"}, "module_options": "pam.yml", "executable": "pam.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "modprobe"}, "module_options": "modprobe.yml", "executable": "modprobe.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 8, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "profile"}, "module_options": "profile.yml", "executable": "profile.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 9, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "securetty"}, "module_options": "securetty.yml", "executable": "securetty.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 10, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "os_security_suid_sgid_enforce  | bool", "tags": "suid_sgid"}, "module_options": "suid_sgid.yml", "executable": "suid_sgid.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 11, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "sysctl"}, "module_options": "sysctl.yml", "executable": "sysctl.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 12, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "user_accounts"}, "module_options": "user_accounts.yml", "executable": "user_accounts.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 13, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "rhosts"}, "module_options": "rhosts.yml", "executable": "rhosts.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 14, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "ansible_facts.os_family == 'RedHat'", "tags": "yum"}, "module_options": "yum.yml", "executable": "yum.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 15, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "ansible_facts.distribution in ['Debian', 'Ubuntu']", "tags": "apt"}, "module_options": "apt.yml", "executable": "apt.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 16, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "selinux", "when": "ansible_facts.selinux.status == 'enabled'"}, "module_options": "selinux.yml", "executable": "selinux.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "suid_sgid.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "tasks": [{"py/object": "struct4.Task", "name": "remove suid/sgid bit from binaries in blacklist | os-06", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "remove suid/sgid bit from binaries in blacklist | os-06", "failed_when": false, "with_flattened": ["{{ os_security_suid_sgid_system_blacklist }}", "{{ os_security_suid_sgid_blacklist }}"]}, "module_options": {"path": "{{ item }}", "mode": "a-s", "state": "file", "follow": "yes"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "find binaries with suid/sgid set | os-06", "module": "shell", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "find binaries with suid/sgid set | os-06", "register": "sbit_binaries", "when": "os_security_suid_sgid_remove_from_unknown | bool", "changed_when": false}, "module_options": "find / -xdev \\( -perm -4000 -o -perm -2000 \\) -type f ! -path '/proc/*' -print 2>/dev/null", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "gather files from which to remove suids/sgids and remove system white-listed files | os-06", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "gather files from which to remove suids/sgids and remove system white-listed files | os-06", "when": "os_security_suid_sgid_remove_from_unknown | bool"}, "module_options": {"suid": "{{ sbit_binaries.stdout_lines | difference(os_security_suid_sgid_system_whitelist) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove suid/sgid bit from all binaries except in system and user whitelist | os-06", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "remove suid/sgid bit from all binaries except in system and user whitelist | os-06", "with_flattened": ["{{ suid | default([]) | difference(os_security_suid_sgid_whitelist) }}"], "when": "os_security_suid_sgid_remove_from_unknown | bool"}, "module_options": {"path": "{{ item }}", "mode": "a-s", "state": "file", "follow": "yes"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "login_defs.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/login_defs.yml", "tasks": [{"py/object": "struct4.Task", "name": "create login.defs | os-05, os-05b", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/login_defs.yml", "options": {"name": "create login.defs | os-05, os-05b"}, "module_options": {"src": "etc/login.defs.j2", "dest": "/etc/login.defs", "owner": "root", "group": "root", "mode": "0444"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "auditd.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "tasks": [{"py/object": "struct4.Task", "name": "install auditd package | package-08", "module": "package", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "options": {"name": "install auditd package | package-08"}, "module_options": {"name": "{{ auditd_package }}", "state": "present"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure auditd | package-08", "module": "template", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "options": {"name": "configure auditd | package-08"}, "module_options": {"src": "etc/audit/auditd.conf.j2", "dest": "/etc/audit/auditd.conf", "owner": "root", "group": "root", "mode": "0640"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "apt.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/apt.yml", "tasks": [{"py/object": "struct4.Task", "name": "remove deprecated or insecure packages | package-01 - package-09", "module": "apt", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/apt.yml", "options": {"name": "remove deprecated or insecure packages | package-01 - package-09", "when": "os_security_packages_clean | bool"}, "module_options": {"name": "{{ os_security_packages_list }}", "state": "absent", "purge": "yes"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "yum.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "tasks": [{"py/object": "struct4.Task", "name": "remove unused repositories", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "remove unused repositories", "loop": ["CentOS-Debuginfo", "CentOS-Media", "CentOS-Vault"], "when": "os_security_packages_clean | bool"}, "module_options": {"name": "/etc/yum.repos.d/{{ item }}.repo", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "get yum-repository-files", "module": "find", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "get yum-repository-files", "register": "yum_repos"}, "module_options": {"paths": "/etc/yum.repos.d", "patterns": "*.repo"}, "executable": "find", "executable_type": "Module", "fqcn": "ansible.builtin.find", "annotations": {}}, {"py/object": "struct4.Task", "name": "activate gpg-check for yum-repository-files", "module": "replace", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "activate gpg-check for yum-repository-files", "with_items": ["{{ yum_repos.files | default([]) }}"]}, "module_options": {"path": "{{ item.path }}", "regexp": "^\\s*gpgcheck.*", "replace": "gpgcheck=1"}, "executable": "replace", "executable_type": "Module", "fqcn": "ansible.builtin.replace", "annotations": {}}, {"py/object": "struct4.Task", "name": "activate gpg-check for config files", "module": "replace", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "activate gpg-check for config files", "register": "status", "failed_when": "status.rc is defined and status.rc != 257", "loop": ["/etc/yum.conf", "/etc/dnf/dnf.conf", "/etc/yum/pluginconf.d/rhnplugin.conf"]}, "module_options": {"path": "{{ item }}", "regexp": "^\\s*gpgcheck\\W.*", "replace": "gpgcheck=1"}, "executable": "replace", "executable_type": "Module", "fqcn": "ansible.builtin.replace", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove deprecated or insecure packages | package-01 - package-09", "module": "yum", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "remove deprecated or insecure packages | package-01 - package-09", "when": "os_security_packages_clean | bool"}, "module_options": {"name": "{{ os_security_packages_list }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "sysctl.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "tasks": [{"py/object": "struct4.Task", "name": "protect sysctl.conf", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "protect sysctl.conf"}, "module_options": {"path": "/etc/sysctl.conf", "owner": "root", "group": "root", "mode": "0440"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "set Daemon umask, do config for rhel-family | NSA 2.2.4.1", "module": "template", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "set Daemon umask, do config for rhel-family | NSA 2.2.4.1", "when": "ansible_facts.distribution in ['Amazon', 'CentOS', 'Fedora', 'RedHat']"}, "module_options": {"src": "etc/sysconfig/rhel_sysconfig_init.j2", "dest": "/etc/sysconfig/init", "owner": "root", "group": "root", "mode": "0544"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "install initramfs-tools", "module": "apt", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "install initramfs-tools", "when": ["ansible_facts.os_family == 'Debian'", "os_security_kernel_enable_module_loading"]}, "module_options": {"name": "initramfs-tools", "state": "present", "update_cache": true}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "rebuild initramfs with starting pack of modules, if module loading at runtime is disabled", "module": "template", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "rebuild initramfs with starting pack of modules, if module loading at runtime is disabled", "notify": ["update-initramfs"], "when": ["ansible_facts.os_family == 'Debian'", "os_security_kernel_enable_module_loading"], "register": "initramfs"}, "module_options": {"src": "etc/initramfs-tools/modules.j2", "dest": "/etc/initramfs-tools/modules", "owner": "root", "group": "root", "mode": "0440"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "create a combined sysctl-dict if overwrites are defined", "module": "set_fact", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "create a combined sysctl-dict if overwrites are defined", "when": "sysctl_overwrite | default()"}, "module_options": {"sysctl_config": "{{ sysctl_config | combine(sysctl_overwrite) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Change various sysctl-settings, look at the sysctl-vars file for documentation", "module": "sysctl", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Change various sysctl-settings, look at the sysctl-vars file for documentation", "with_dict": "{{ sysctl_config }}"}, "module_options": {"name": "{{ item.key }}", "value": "{{ item.value }}", "sysctl_set": true, "state": "present", "reload": true, "ignoreerrors": true}, "executable": "sysctl", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation", "module": "sysctl", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation", "with_dict": "{{ sysctl_rhel_config }}", "when": "((ansible_facts.distribution in ['CentOS', 'Fedora', 'RedHat']) and ansible_distribution_version|int is version('7', '<')) or ansible_facts.distribution == 'Amazon'"}, "module_options": {"name": "{{ item.key }}", "value": "{{ item.value }}", "state": "present", "reload": true, "ignoreerrors": true}, "executable": "sysctl", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Apply ufw defaults", "module": "template", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Apply ufw defaults", "when": ["ufw_manage_defaults", "ansible_facts.distribution in ['Debian', 'Ubuntu']"], "tags": "ufw"}, "module_options": {"src": "etc/default/ufw.j2", "dest": "/etc/default/ufw"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "main.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/main.yml", "tasks": [{"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/main.yml", "options": {"when": "os_hardening_enabled | bool"}, "module_options": "hardening.yml", "executable": "hardening.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "modprobe.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "tasks": [{"py/object": "struct4.Task", "name": "install modprobe to disable filesystems | os-10", "module": "package", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "install modprobe to disable filesystems | os-10"}, "module_options": {"name": "{{ modprobe_package }}", "state": "present"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "check if efi is installed", "module": "stat", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "check if efi is installed", "register": "efi_installed"}, "module_options": {"path": "/sys/firmware/efi"}, "executable": "stat", "executable_type": "Module", "fqcn": "ansible.builtin.stat", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove vfat from fs-list if efi is used", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "remove vfat from fs-list if efi is used", "when": ["efi_installed.stat.isdir is defined", "efi_installed.stat.isdir"]}, "module_options": {"os_unused_filesystems": "{{ os_unused_filesystems | difference('vfat') }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove used filesystems from fs-list", "module": "set_fact", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "remove used filesystems from fs-list", "when": "not ((ansible_facts.os_family in ['Oracle Linux', 'RedHat']) and ansible_facts.distribution_major_version < '7')"}, "module_options": {"os_unused_filesystems": "{{ os_unused_filesystems | difference(ansible_mounts | map(attribute='fstype') | list) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "disable unused filesystems | os-10", "module": "template", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "disable unused filesystems | os-10"}, "module_options": {"src": "etc/modprobe.d/modprobe.j2", "dest": "/etc/modprobe.d/dev-sec.conf", "owner": "root", "group": "root", "mode": "0644"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}], "modules": [], "source": "", "annotations": {}, "used_in": []}], "modules": [], "taskfiles": [], "version": "", "module_dict": {}, "task_dict": {"{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "get UID_MIN from login.defs", "module": "shell", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "get UID_MIN from login.defs", "args": {"removes": "/etc/login.defs"}, "register": "uid_min", "check_mode": false, "changed_when": false}, "module_options": "awk '/^\\s*UID_MIN\\s*([0-9]*).*?$/ {print $2}' /etc/login.defs", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "calculate UID_MAX from UID_MIN by substracting 1", "module": "set_fact", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "calculate UID_MAX from UID_MIN by substracting 1", "when": "uid_min.stdout|int > 0"}, "module_options": {"uid_max": "{{ uid_min.stdout | int - 1 }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "set UID_MAX on Debian-systems if no login.defs exist", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "set UID_MAX on Debian-systems if no login.defs exist", "when": ["ansible_facts.os_family == 'Debian'", "uid_max is not defined"]}, "module_options": {"uid_max": "999"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "set UID_MAX on other systems if no login.defs exist", "module": "set_fact", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "set UID_MAX on other systems if no login.defs exist", "when": "uid_max is not defined"}, "module_options": {"uid_max": "499"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "get all system accounts", "module": "command", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "get all system accounts", "args": {"removes": "/etc/passwd"}, "changed_when": false, "check_mode": false, "register": "sys_accs"}, "module_options": "awk -F'':'' '{ if ( $3 <= {{ uid_max|quote }} ) print $1}' /etc/passwd", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "remove always ignored system accounts from list", "module": "set_fact", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "remove always ignored system accounts from list", "check_mode": false}, "module_options": {"sys_accs_cond": "{{ sys_accs.stdout_lines | difference(os_always_ignore_users) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "change system accounts not on the user provided ignore-list", "module": "user", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "change system accounts not on the user provided ignore-list", "with_flattened": ["{{ sys_accs_cond | default([]) | difference(os_ignore_users) | list }}"]}, "module_options": {"name": "{{ item }}", "shell": "{{ os_nologin_shell_path }}", "password": "*", "createhome": false}, "executable": "user", "executable_type": "Module", "fqcn": "ansible.builtin.user", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Get user accounts | os-09", "module": "command", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "Get user accounts | os-09", "changed_when": false, "check_mode": false, "register": "users_accounts"}, "module_options": "awk -F: '{print $1}' /etc/passwd", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "delete rhosts-files from system | os-09", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete rhosts-files from system | os-09", "with_flattened": "{{ users_accounts.stdout_lines | default([]) }}"}, "module_options": {"dest": "~{{ item }}/.rhosts", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "delete hosts.equiv from system | os-01", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete hosts.equiv from system | os-01"}, "module_options": {"dest": "/etc/hosts.equiv", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "delete .netrc-files from system | os-09", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete .netrc-files from system | os-09", "with_flattened": "{{ users_accounts.stdout_lines | default([]) }}"}, "module_options": {"dest": "~{{ item }}/.netrc", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/securetty.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "create securetty", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/securetty.yml", "options": {"name": "create securetty"}, "module_options": {"src": "etc/securetty.j2", "dest": "/etc/securetty", "owner": "root", "group": "root", "mode": "0400"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "find files with write-permissions for group", "module": "shell", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "find files with write-permissions for group", "with_flattened": ["/usr/local/sbin", "/usr/local/bin", "/usr/sbin", "/usr/bin", "/sbin", "/bin", "{{ os_env_extra_user_paths }}"], "register": "minimize_access_directories", "ignore_errors": true, "changed_when": false}, "module_options": "find -L {{ item }} -perm /go+w -type f", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "minimize access on found files", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "minimize access on found files", "with_subelements": ["{{ minimize_access_directories.results }}", "stdout_lines"]}, "module_options": {"path": "{{ item.1 }}", "mode": "go-w", "state": "file"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "change shadow ownership to root and mode to 0600 | os-02", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change shadow ownership to root and mode to 0600 | os-02"}, "module_options": {"dest": "/etc/shadow", "owner": "{{ os_shadow_perms.owner }}", "group": "{{ os_shadow_perms.group }}", "mode": "{{ os_shadow_perms.mode }}"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "change passwd ownership to root and mode to 0644 | os-03", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change passwd ownership to root and mode to 0644 | os-03"}, "module_options": {"dest": "/etc/passwd", "owner": "{{ os_passwd_perms.owner }}", "group": "{{ os_passwd_perms.group }}", "mode": "{{ os_passwd_perms.mode }}"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "change su-binary to only be accessible to user and group root", "module": "file", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change su-binary to only be accessible to user and group root", "when": "\"change_user\" not in os_security_users_allow"}, "module_options": {"dest": "/bin/su", "owner": "root", "group": "root", "mode": "0750"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "set option hidepid for proc filesystem", "module": "mount", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "set option hidepid for proc filesystem"}, "module_options": {"path": "/proc", "src": "proc", "fstype": "proc", "opts": "{{ proc_mnt_options }}", "state": "present"}, "executable": "mount", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "create limits.d-directory if it does not exist | sysctl-31a, sysctl-31b", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "create limits.d-directory if it does not exist | sysctl-31a, sysctl-31b"}, "module_options": {"path": "/etc/security/limits.d", "owner": "root", "group": "root", "mode": "0755", "state": "directory"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "create additional limits config file -> 10.hardcore.conf | sysctl-31a, sysctl-31b", "module": "pam_limits", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "create additional limits config file -> 10.hardcore.conf | sysctl-31a, sysctl-31b"}, "module_options": {"dest": "/etc/security/limits.d/10.hardcore.conf", "domain": "*", "limit_type": "hard", "limit_item": "core", "value": "0", "comment": "Prevent core dumps for all users. These are usually not needed and may contain sensitive information"}, "executable": "pam_limits", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "set 10.hardcore.conf perms to 0400 and root ownership", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "set 10.hardcore.conf perms to 0400 and root ownership"}, "module_options": {"path": "/etc/security/limits.d/10.hardcore.conf", "owner": "root", "group": "root", "mode": "0440"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "remove 10.hardcore.conf config file", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "remove 10.hardcore.conf config file", "when": "os_security_kernel_enable_core_dump | bool"}, "module_options": {"path": "/etc/security/limits.d/10.hardcore.conf", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/selinux.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "configure selinux | selinux-01", "module": "selinux", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/selinux.yml", "options": {"name": "configure selinux | selinux-01"}, "module_options": {"policy": "{{ os_selinux_policy }}", "state": "{{ os_selinux_state }}"}, "executable": "selinux", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "add pinerolo_profile.sh to profile.d", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "options": {"name": "add pinerolo_profile.sh to profile.d", "when": "not os_security_kernel_enable_core_dump | bool"}, "module_options": {"src": "etc/profile.d/profile.conf.j2", "dest": "/etc/profile.d/pinerolo_profile.sh", "owner": "root", "group": "root", "mode": "0750"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "remove pinerolo_profile.sh from profile.d", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "options": {"name": "remove pinerolo_profile.sh from profile.d", "when": "os_security_kernel_enable_core_dump | bool"}, "module_options": {"path": "/etc/profile.d/pinerolo_profile.sh", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "update pam on Debian systems", "module": "command", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "update pam on Debian systems", "when": "ansible_facts.distribution in ['Debian', 'Ubuntu']", "changed_when": false, "environment": {"DEBIAN_FRONTEND": "noninteractive"}}, "module_options": "pam-auth-update --package", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "remove pam ccreds to disable password caching", "module": "package", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam ccreds to disable password caching"}, "module_options": {"name": "{{ os_packages_pam_ccreds }}", "state": "absent"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "remove pam_cracklib, because it does not play nice with passwdqc", "module": "apt", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam_cracklib, because it does not play nice with passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_cracklib }}", "state": "absent"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "install the package for strong password checking", "module": "apt", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install the package for strong password checking", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "present", "update_cache": "yes"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "configure passwdqc", "module": "template", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"src": "usr/share/pam-configs/pam_passwdqd.j2", "dest": "{{ passwdqc_path }}", "mode": "0644", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "remove passwdqc", "module": "apt", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "absent"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "install tally2", "module": "apt", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install tally2", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries > 0"]}, "module_options": {"name": "libpam-modules", "state": "present"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 7}": {"py/object": "struct4.Task", "name": "configure tally2", "module": "template", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure tally2", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries > 0"]}, "module_options": {"src": "usr/share/pam-configs/pam_tally2.j2", "dest": "{{ tally2_path }}", "mode": "0644", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 8}": {"py/object": "struct4.Task", "name": "delete tally2 when retries is 0", "module": "file", "index": 8, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "delete tally2 when retries is 0", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries == 0"]}, "module_options": {"path": "{{ tally2_path }}", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 9}": {"py/object": "struct4.Task", "name": "remove pam_cracklib, because it does not play nice with passwdqc", "module": "yum", "index": 9, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam_cracklib, because it does not play nice with passwdqc", "when": ["ansible_facts.os_family == 'RedHat'", "ansible_facts.distribution_major_version|int is version('7', '<')", "ansible_facts.distribution != 'Amazon'", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_cracklib }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 10}": {"py/object": "struct4.Task", "name": "install the package for strong password checking", "module": "yum", "index": 10, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install the package for strong password checking", "when": ["ansible_facts.os_family == 'RedHat'", "ansible_facts.distribution_major_version|int is version('7', '<')", "ansible_facts.distribution != 'Amazon'", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "present"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 11}": {"py/object": "struct4.Task", "name": "remove passwdqc", "module": "yum", "index": 11, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove passwdqc", "when": ["ansible_facts.os_family == 'RedHat'", "not os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 12}": {"py/object": "struct4.Task", "name": "configure passwdqc and tally via central system-auth confic", "module": "template", "index": 12, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure passwdqc and tally via central system-auth confic", "when": "ansible_facts.os_family == 'RedHat'"}, "module_options": {"src": "etc/pam.d/rhel_system_auth.j2", "dest": "/etc/pam.d/system-auth-ac", "mode": "0640", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 13}": {"py/object": "struct4.Task", "name": "Gather package facts", "module": "package_facts", "index": 13, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "Gather package facts", "when": "ansible_facts.os_family != 'Suse'"}, "module_options": {"manager": "auto"}, "executable": "package_facts", "executable_type": "Module", "fqcn": "ansible.builtin.package_facts", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml\", \"index\": 14}": {"py/object": "struct4.Task", "name": "NSA 2.3.3.5 Upgrade Password Hashing Algorithm to SHA-512", "module": "template", "index": 14, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "NSA 2.3.3.5 Upgrade Password Hashing Algorithm to SHA-512", "when": ["ansible_facts.os_family != 'Suse'", "'libuser' in ansible_facts.packages"]}, "module_options": {"src": "etc/libuser.conf.j2", "dest": "/etc/libuser.conf", "mode": "0640", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Set OS family dependent variables", "module": "include_vars", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"name": "Set OS family dependent variables", "tags": "always"}, "module_options": "{{ ansible_facts.os_family }}.yml", "executable": "include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Set OS dependent variables", "module": "include_vars", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"name": "Set OS dependent variables", "with_first_found": [{"files": ["{{ ansible_facts.distribution }}-{{ ansible_facts.distribution_major_version }}.yml", "{{ ansible_facts.distribution }}.yml", "{{ ansible_facts.os_family }}-{{ ansible_facts.distribution_major_version }}.yml"], "skip": true}], "tags": "always"}, "module_options": "{{ item }}", "executable": "include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "auditd", "when": "os_auditd_enabled | bool"}, "module_options": "auditd.yml", "executable": "auditd.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "limits"}, "module_options": "limits.yml", "executable": "limits.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "login_defs"}, "module_options": "login_defs.yml", "executable": "login_defs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "minimize_access"}, "module_options": "minimize_access.yml", "executable": "minimize_access.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "pam"}, "module_options": "pam.yml", "executable": "pam.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 7}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "modprobe"}, "module_options": "modprobe.yml", "executable": "modprobe.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 8}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 8, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "profile"}, "module_options": "profile.yml", "executable": "profile.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 9}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 9, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "securetty"}, "module_options": "securetty.yml", "executable": "securetty.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 10}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 10, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "os_security_suid_sgid_enforce  | bool", "tags": "suid_sgid"}, "module_options": "suid_sgid.yml", "executable": "suid_sgid.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 11}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 11, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "sysctl"}, "module_options": "sysctl.yml", "executable": "sysctl.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 12}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 12, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "user_accounts"}, "module_options": "user_accounts.yml", "executable": "user_accounts.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 13}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 13, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "rhosts"}, "module_options": "rhosts.yml", "executable": "rhosts.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 14}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 14, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "ansible_facts.os_family == 'RedHat'", "tags": "yum"}, "module_options": "yum.yml", "executable": "yum.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 15}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 15, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "ansible_facts.distribution in ['Debian', 'Ubuntu']", "tags": "apt"}, "module_options": "apt.yml", "executable": "apt.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml\", \"index\": 16}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 16, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "selinux", "when": "ansible_facts.selinux.status == 'enabled'"}, "module_options": "selinux.yml", "executable": "selinux.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "remove suid/sgid bit from binaries in blacklist | os-06", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "remove suid/sgid bit from binaries in blacklist | os-06", "failed_when": false, "with_flattened": ["{{ os_security_suid_sgid_system_blacklist }}", "{{ os_security_suid_sgid_blacklist }}"]}, "module_options": {"path": "{{ item }}", "mode": "a-s", "state": "file", "follow": "yes"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "find binaries with suid/sgid set | os-06", "module": "shell", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "find binaries with suid/sgid set | os-06", "register": "sbit_binaries", "when": "os_security_suid_sgid_remove_from_unknown | bool", "changed_when": false}, "module_options": "find / -xdev \\( -perm -4000 -o -perm -2000 \\) -type f ! -path '/proc/*' -print 2>/dev/null", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "gather files from which to remove suids/sgids and remove system white-listed files | os-06", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "gather files from which to remove suids/sgids and remove system white-listed files | os-06", "when": "os_security_suid_sgid_remove_from_unknown | bool"}, "module_options": {"suid": "{{ sbit_binaries.stdout_lines | difference(os_security_suid_sgid_system_whitelist) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "remove suid/sgid bit from all binaries except in system and user whitelist | os-06", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "remove suid/sgid bit from all binaries except in system and user whitelist | os-06", "with_flattened": ["{{ suid | default([]) | difference(os_security_suid_sgid_whitelist) }}"], "when": "os_security_suid_sgid_remove_from_unknown | bool"}, "module_options": {"path": "{{ item }}", "mode": "a-s", "state": "file", "follow": "yes"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/login_defs.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "create login.defs | os-05, os-05b", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/login_defs.yml", "options": {"name": "create login.defs | os-05, os-05b"}, "module_options": {"src": "etc/login.defs.j2", "dest": "/etc/login.defs", "owner": "root", "group": "root", "mode": "0444"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "install auditd package | package-08", "module": "package", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "options": {"name": "install auditd package | package-08"}, "module_options": {"name": "{{ auditd_package }}", "state": "present"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "configure auditd | package-08", "module": "template", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "options": {"name": "configure auditd | package-08"}, "module_options": {"src": "etc/audit/auditd.conf.j2", "dest": "/etc/audit/auditd.conf", "owner": "root", "group": "root", "mode": "0640"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/apt.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "remove deprecated or insecure packages | package-01 - package-09", "module": "apt", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/apt.yml", "options": {"name": "remove deprecated or insecure packages | package-01 - package-09", "when": "os_security_packages_clean | bool"}, "module_options": {"name": "{{ os_security_packages_list }}", "state": "absent", "purge": "yes"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "remove unused repositories", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "remove unused repositories", "loop": ["CentOS-Debuginfo", "CentOS-Media", "CentOS-Vault"], "when": "os_security_packages_clean | bool"}, "module_options": {"name": "/etc/yum.repos.d/{{ item }}.repo", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "get yum-repository-files", "module": "find", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "get yum-repository-files", "register": "yum_repos"}, "module_options": {"paths": "/etc/yum.repos.d", "patterns": "*.repo"}, "executable": "find", "executable_type": "Module", "fqcn": "ansible.builtin.find", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "activate gpg-check for yum-repository-files", "module": "replace", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "activate gpg-check for yum-repository-files", "with_items": ["{{ yum_repos.files | default([]) }}"]}, "module_options": {"path": "{{ item.path }}", "regexp": "^\\s*gpgcheck.*", "replace": "gpgcheck=1"}, "executable": "replace", "executable_type": "Module", "fqcn": "ansible.builtin.replace", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "activate gpg-check for config files", "module": "replace", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "activate gpg-check for config files", "register": "status", "failed_when": "status.rc is defined and status.rc != 257", "loop": ["/etc/yum.conf", "/etc/dnf/dnf.conf", "/etc/yum/pluginconf.d/rhnplugin.conf"]}, "module_options": {"path": "{{ item }}", "regexp": "^\\s*gpgcheck\\W.*", "replace": "gpgcheck=1"}, "executable": "replace", "executable_type": "Module", "fqcn": "ansible.builtin.replace", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "remove deprecated or insecure packages | package-01 - package-09", "module": "yum", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "remove deprecated or insecure packages | package-01 - package-09", "when": "os_security_packages_clean | bool"}, "module_options": {"name": "{{ os_security_packages_list }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "protect sysctl.conf", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "protect sysctl.conf"}, "module_options": {"path": "/etc/sysctl.conf", "owner": "root", "group": "root", "mode": "0440"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "set Daemon umask, do config for rhel-family | NSA 2.2.4.1", "module": "template", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "set Daemon umask, do config for rhel-family | NSA 2.2.4.1", "when": "ansible_facts.distribution in ['Amazon', 'CentOS', 'Fedora', 'RedHat']"}, "module_options": {"src": "etc/sysconfig/rhel_sysconfig_init.j2", "dest": "/etc/sysconfig/init", "owner": "root", "group": "root", "mode": "0544"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "install initramfs-tools", "module": "apt", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "install initramfs-tools", "when": ["ansible_facts.os_family == 'Debian'", "os_security_kernel_enable_module_loading"]}, "module_options": {"name": "initramfs-tools", "state": "present", "update_cache": true}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "rebuild initramfs with starting pack of modules, if module loading at runtime is disabled", "module": "template", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "rebuild initramfs with starting pack of modules, if module loading at runtime is disabled", "notify": ["update-initramfs"], "when": ["ansible_facts.os_family == 'Debian'", "os_security_kernel_enable_module_loading"], "register": "initramfs"}, "module_options": {"src": "etc/initramfs-tools/modules.j2", "dest": "/etc/initramfs-tools/modules", "owner": "root", "group": "root", "mode": "0440"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "create a combined sysctl-dict if overwrites are defined", "module": "set_fact", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "create a combined sysctl-dict if overwrites are defined", "when": "sysctl_overwrite | default()"}, "module_options": {"sysctl_config": "{{ sysctl_config | combine(sysctl_overwrite) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "Change various sysctl-settings, look at the sysctl-vars file for documentation", "module": "sysctl", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Change various sysctl-settings, look at the sysctl-vars file for documentation", "with_dict": "{{ sysctl_config }}"}, "module_options": {"name": "{{ item.key }}", "value": "{{ item.value }}", "sysctl_set": true, "state": "present", "reload": true, "ignoreerrors": true}, "executable": "sysctl", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation", "module": "sysctl", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation", "with_dict": "{{ sysctl_rhel_config }}", "when": "((ansible_facts.distribution in ['CentOS', 'Fedora', 'RedHat']) and ansible_distribution_version|int is version('7', '<')) or ansible_facts.distribution == 'Amazon'"}, "module_options": {"name": "{{ item.key }}", "value": "{{ item.value }}", "state": "present", "reload": true, "ignoreerrors": true}, "executable": "sysctl", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml\", \"index\": 7}": {"py/object": "struct4.Task", "name": "Apply ufw defaults", "module": "template", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Apply ufw defaults", "when": ["ufw_manage_defaults", "ansible_facts.distribution in ['Debian', 'Ubuntu']"], "tags": "ufw"}, "module_options": {"src": "etc/default/ufw.j2", "dest": "/etc/default/ufw"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/main.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/main.yml", "options": {"when": "os_hardening_enabled | bool"}, "module_options": "hardening.yml", "executable": "hardening.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "install modprobe to disable filesystems | os-10", "module": "package", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "install modprobe to disable filesystems | os-10"}, "module_options": {"name": "{{ modprobe_package }}", "state": "present"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "check if efi is installed", "module": "stat", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "check if efi is installed", "register": "efi_installed"}, "module_options": {"path": "/sys/firmware/efi"}, "executable": "stat", "executable_type": "Module", "fqcn": "ansible.builtin.stat", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "remove vfat from fs-list if efi is used", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "remove vfat from fs-list if efi is used", "when": ["efi_installed.stat.isdir is defined", "efi_installed.stat.isdir"]}, "module_options": {"os_unused_filesystems": "{{ os_unused_filesystems | difference('vfat') }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "remove used filesystems from fs-list", "module": "set_fact", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "remove used filesystems from fs-list", "when": "not ((ansible_facts.os_family in ['Oracle Linux', 'RedHat']) and ansible_facts.distribution_major_version < '7')"}, "module_options": {"os_unused_filesystems": "{{ os_unused_filesystems | difference(ansible_mounts | map(attribute='fstype') | list) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "disable unused filesystems | os-10", "module": "template", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "disable unused filesystems | os-10"}, "module_options": {"src": "etc/modprobe.d/modprobe.j2", "dest": "/etc/modprobe.d/dev-sec.conf", "owner": "root", "group": "root", "mode": "0644"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}}, "taskfile_dict": {"./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml": {"py/object": "struct4.TaskFile", "name": "user_accounts.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "tasks": [{"py/object": "struct4.Task", "name": "get UID_MIN from login.defs", "module": "shell", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "get UID_MIN from login.defs", "args": {"removes": "/etc/login.defs"}, "register": "uid_min", "check_mode": false, "changed_when": false}, "module_options": "awk '/^\\s*UID_MIN\\s*([0-9]*).*?$/ {print $2}' /etc/login.defs", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "calculate UID_MAX from UID_MIN by substracting 1", "module": "set_fact", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "calculate UID_MAX from UID_MIN by substracting 1", "when": "uid_min.stdout|int > 0"}, "module_options": {"uid_max": "{{ uid_min.stdout | int - 1 }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "set UID_MAX on Debian-systems if no login.defs exist", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "set UID_MAX on Debian-systems if no login.defs exist", "when": ["ansible_facts.os_family == 'Debian'", "uid_max is not defined"]}, "module_options": {"uid_max": "999"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "set UID_MAX on other systems if no login.defs exist", "module": "set_fact", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "set UID_MAX on other systems if no login.defs exist", "when": "uid_max is not defined"}, "module_options": {"uid_max": "499"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "get all system accounts", "module": "command", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "get all system accounts", "args": {"removes": "/etc/passwd"}, "changed_when": false, "check_mode": false, "register": "sys_accs"}, "module_options": "awk -F'':'' '{ if ( $3 <= {{ uid_max|quote }} ) print $1}' /etc/passwd", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove always ignored system accounts from list", "module": "set_fact", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "remove always ignored system accounts from list", "check_mode": false}, "module_options": {"sys_accs_cond": "{{ sys_accs.stdout_lines | difference(os_always_ignore_users) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "change system accounts not on the user provided ignore-list", "module": "user", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "change system accounts not on the user provided ignore-list", "with_flattened": ["{{ sys_accs_cond | default([]) | difference(os_ignore_users) | list }}"]}, "module_options": {"name": "{{ item }}", "shell": "{{ os_nologin_shell_path }}", "password": "*", "createhome": false}, "executable": "user", "executable_type": "Module", "fqcn": "ansible.builtin.user", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml": {"py/object": "struct4.TaskFile", "name": "rhosts.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "tasks": [{"py/object": "struct4.Task", "name": "Get user accounts | os-09", "module": "command", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "Get user accounts | os-09", "changed_when": false, "check_mode": false, "register": "users_accounts"}, "module_options": "awk -F: '{print $1}' /etc/passwd", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete rhosts-files from system | os-09", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete rhosts-files from system | os-09", "with_flattened": "{{ users_accounts.stdout_lines | default([]) }}"}, "module_options": {"dest": "~{{ item }}/.rhosts", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete hosts.equiv from system | os-01", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete hosts.equiv from system | os-01"}, "module_options": {"dest": "/etc/hosts.equiv", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete .netrc-files from system | os-09", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete .netrc-files from system | os-09", "with_flattened": "{{ users_accounts.stdout_lines | default([]) }}"}, "module_options": {"dest": "~{{ item }}/.netrc", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/securetty.yml": {"py/object": "struct4.TaskFile", "name": "securetty.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/securetty.yml", "tasks": [{"py/object": "struct4.Task", "name": "create securetty", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/securetty.yml", "options": {"name": "create securetty"}, "module_options": {"src": "etc/securetty.j2", "dest": "/etc/securetty", "owner": "root", "group": "root", "mode": "0400"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml": {"py/object": "struct4.TaskFile", "name": "minimize_access.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "tasks": [{"py/object": "struct4.Task", "name": "find files with write-permissions for group", "module": "shell", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "find files with write-permissions for group", "with_flattened": ["/usr/local/sbin", "/usr/local/bin", "/usr/sbin", "/usr/bin", "/sbin", "/bin", "{{ os_env_extra_user_paths }}"], "register": "minimize_access_directories", "ignore_errors": true, "changed_when": false}, "module_options": "find -L {{ item }} -perm /go+w -type f", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "minimize access on found files", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "minimize access on found files", "with_subelements": ["{{ minimize_access_directories.results }}", "stdout_lines"]}, "module_options": {"path": "{{ item.1 }}", "mode": "go-w", "state": "file"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "change shadow ownership to root and mode to 0600 | os-02", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change shadow ownership to root and mode to 0600 | os-02"}, "module_options": {"dest": "/etc/shadow", "owner": "{{ os_shadow_perms.owner }}", "group": "{{ os_shadow_perms.group }}", "mode": "{{ os_shadow_perms.mode }}"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "change passwd ownership to root and mode to 0644 | os-03", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change passwd ownership to root and mode to 0644 | os-03"}, "module_options": {"dest": "/etc/passwd", "owner": "{{ os_passwd_perms.owner }}", "group": "{{ os_passwd_perms.group }}", "mode": "{{ os_passwd_perms.mode }}"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "change su-binary to only be accessible to user and group root", "module": "file", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change su-binary to only be accessible to user and group root", "when": "\"change_user\" not in os_security_users_allow"}, "module_options": {"dest": "/bin/su", "owner": "root", "group": "root", "mode": "0750"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "set option hidepid for proc filesystem", "module": "mount", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "set option hidepid for proc filesystem"}, "module_options": {"path": "/proc", "src": "proc", "fstype": "proc", "opts": "{{ proc_mnt_options }}", "state": "present"}, "executable": "mount", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml": {"py/object": "struct4.TaskFile", "name": "limits.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "tasks": [{"py/object": "struct4.Task", "name": "create limits.d-directory if it does not exist | sysctl-31a, sysctl-31b", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "create limits.d-directory if it does not exist | sysctl-31a, sysctl-31b"}, "module_options": {"path": "/etc/security/limits.d", "owner": "root", "group": "root", "mode": "0755", "state": "directory"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "create additional limits config file -> 10.hardcore.conf | sysctl-31a, sysctl-31b", "module": "pam_limits", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "create additional limits config file -> 10.hardcore.conf | sysctl-31a, sysctl-31b"}, "module_options": {"dest": "/etc/security/limits.d/10.hardcore.conf", "domain": "*", "limit_type": "hard", "limit_item": "core", "value": "0", "comment": "Prevent core dumps for all users. These are usually not needed and may contain sensitive information"}, "executable": "pam_limits", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "set 10.hardcore.conf perms to 0400 and root ownership", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "set 10.hardcore.conf perms to 0400 and root ownership"}, "module_options": {"path": "/etc/security/limits.d/10.hardcore.conf", "owner": "root", "group": "root", "mode": "0440"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove 10.hardcore.conf config file", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "remove 10.hardcore.conf config file", "when": "os_security_kernel_enable_core_dump | bool"}, "module_options": {"path": "/etc/security/limits.d/10.hardcore.conf", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/selinux.yml": {"py/object": "struct4.TaskFile", "name": "selinux.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/selinux.yml", "tasks": [{"py/object": "struct4.Task", "name": "configure selinux | selinux-01", "module": "selinux", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/selinux.yml", "options": {"name": "configure selinux | selinux-01"}, "module_options": {"policy": "{{ os_selinux_policy }}", "state": "{{ os_selinux_state }}"}, "executable": "selinux", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml": {"py/object": "struct4.TaskFile", "name": "profile.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "tasks": [{"py/object": "struct4.Task", "name": "add pinerolo_profile.sh to profile.d", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "options": {"name": "add pinerolo_profile.sh to profile.d", "when": "not os_security_kernel_enable_core_dump | bool"}, "module_options": {"src": "etc/profile.d/profile.conf.j2", "dest": "/etc/profile.d/pinerolo_profile.sh", "owner": "root", "group": "root", "mode": "0750"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pinerolo_profile.sh from profile.d", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "options": {"name": "remove pinerolo_profile.sh from profile.d", "when": "os_security_kernel_enable_core_dump | bool"}, "module_options": {"path": "/etc/profile.d/pinerolo_profile.sh", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml": {"py/object": "struct4.TaskFile", "name": "pam.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "tasks": [{"py/object": "struct4.Task", "name": "update pam on Debian systems", "module": "command", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "update pam on Debian systems", "when": "ansible_facts.distribution in ['Debian', 'Ubuntu']", "changed_when": false, "environment": {"DEBIAN_FRONTEND": "noninteractive"}}, "module_options": "pam-auth-update --package", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pam ccreds to disable password caching", "module": "package", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam ccreds to disable password caching"}, "module_options": {"name": "{{ os_packages_pam_ccreds }}", "state": "absent"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pam_cracklib, because it does not play nice with passwdqc", "module": "apt", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam_cracklib, because it does not play nice with passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_cracklib }}", "state": "absent"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "install the package for strong password checking", "module": "apt", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install the package for strong password checking", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "present", "update_cache": "yes"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure passwdqc", "module": "template", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"src": "usr/share/pam-configs/pam_passwdqd.j2", "dest": "{{ passwdqc_path }}", "mode": "0644", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove passwdqc", "module": "apt", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "absent"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "install tally2", "module": "apt", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install tally2", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries > 0"]}, "module_options": {"name": "libpam-modules", "state": "present"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure tally2", "module": "template", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure tally2", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries > 0"]}, "module_options": {"src": "usr/share/pam-configs/pam_tally2.j2", "dest": "{{ tally2_path }}", "mode": "0644", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete tally2 when retries is 0", "module": "file", "index": 8, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "delete tally2 when retries is 0", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries == 0"]}, "module_options": {"path": "{{ tally2_path }}", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pam_cracklib, because it does not play nice with passwdqc", "module": "yum", "index": 9, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam_cracklib, because it does not play nice with passwdqc", "when": ["ansible_facts.os_family == 'RedHat'", "ansible_facts.distribution_major_version|int is version('7', '<')", "ansible_facts.distribution != 'Amazon'", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_cracklib }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "install the package for strong password checking", "module": "yum", "index": 10, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install the package for strong password checking", "when": ["ansible_facts.os_family == 'RedHat'", "ansible_facts.distribution_major_version|int is version('7', '<')", "ansible_facts.distribution != 'Amazon'", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "present"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove passwdqc", "module": "yum", "index": 11, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove passwdqc", "when": ["ansible_facts.os_family == 'RedHat'", "not os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure passwdqc and tally via central system-auth confic", "module": "template", "index": 12, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure passwdqc and tally via central system-auth confic", "when": "ansible_facts.os_family == 'RedHat'"}, "module_options": {"src": "etc/pam.d/rhel_system_auth.j2", "dest": "/etc/pam.d/system-auth-ac", "mode": "0640", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather package facts", "module": "package_facts", "index": 13, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "Gather package facts", "when": "ansible_facts.os_family != 'Suse'"}, "module_options": {"manager": "auto"}, "executable": "package_facts", "executable_type": "Module", "fqcn": "ansible.builtin.package_facts", "annotations": {}}, {"py/object": "struct4.Task", "name": "NSA 2.3.3.5 Upgrade Password Hashing Algorithm to SHA-512", "module": "template", "index": 14, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "NSA 2.3.3.5 Upgrade Password Hashing Algorithm to SHA-512", "when": ["ansible_facts.os_family != 'Suse'", "'libuser' in ansible_facts.packages"]}, "module_options": {"src": "etc/libuser.conf.j2", "dest": "/etc/libuser.conf", "mode": "0640", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml": {"py/object": "struct4.TaskFile", "name": "hardening.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "tasks": [{"py/object": "struct4.Task", "name": "Set OS family dependent variables", "module": "include_vars", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"name": "Set OS family dependent variables", "tags": "always"}, "module_options": "{{ ansible_facts.os_family }}.yml", "executable": "include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set OS dependent variables", "module": "include_vars", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"name": "Set OS dependent variables", "with_first_found": [{"files": ["{{ ansible_facts.distribution }}-{{ ansible_facts.distribution_major_version }}.yml", "{{ ansible_facts.distribution }}.yml", "{{ ansible_facts.os_family }}-{{ ansible_facts.distribution_major_version }}.yml"], "skip": true}], "tags": "always"}, "module_options": "{{ item }}", "executable": "include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "auditd", "when": "os_auditd_enabled | bool"}, "module_options": "auditd.yml", "executable": "auditd.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "limits"}, "module_options": "limits.yml", "executable": "limits.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "login_defs"}, "module_options": "login_defs.yml", "executable": "login_defs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "minimize_access"}, "module_options": "minimize_access.yml", "executable": "minimize_access.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "pam"}, "module_options": "pam.yml", "executable": "pam.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "modprobe"}, "module_options": "modprobe.yml", "executable": "modprobe.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 8, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "profile"}, "module_options": "profile.yml", "executable": "profile.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 9, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "securetty"}, "module_options": "securetty.yml", "executable": "securetty.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 10, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "os_security_suid_sgid_enforce  | bool", "tags": "suid_sgid"}, "module_options": "suid_sgid.yml", "executable": "suid_sgid.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 11, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "sysctl"}, "module_options": "sysctl.yml", "executable": "sysctl.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 12, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "user_accounts"}, "module_options": "user_accounts.yml", "executable": "user_accounts.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 13, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "rhosts"}, "module_options": "rhosts.yml", "executable": "rhosts.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 14, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "ansible_facts.os_family == 'RedHat'", "tags": "yum"}, "module_options": "yum.yml", "executable": "yum.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 15, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "ansible_facts.distribution in ['Debian', 'Ubuntu']", "tags": "apt"}, "module_options": "apt.yml", "executable": "apt.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 16, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "selinux", "when": "ansible_facts.selinux.status == 'enabled'"}, "module_options": "selinux.yml", "executable": "selinux.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml": {"py/object": "struct4.TaskFile", "name": "suid_sgid.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "tasks": [{"py/object": "struct4.Task", "name": "remove suid/sgid bit from binaries in blacklist | os-06", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "remove suid/sgid bit from binaries in blacklist | os-06", "failed_when": false, "with_flattened": ["{{ os_security_suid_sgid_system_blacklist }}", "{{ os_security_suid_sgid_blacklist }}"]}, "module_options": {"path": "{{ item }}", "mode": "a-s", "state": "file", "follow": "yes"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "find binaries with suid/sgid set | os-06", "module": "shell", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "find binaries with suid/sgid set | os-06", "register": "sbit_binaries", "when": "os_security_suid_sgid_remove_from_unknown | bool", "changed_when": false}, "module_options": "find / -xdev \\( -perm -4000 -o -perm -2000 \\) -type f ! -path '/proc/*' -print 2>/dev/null", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "gather files from which to remove suids/sgids and remove system white-listed files | os-06", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "gather files from which to remove suids/sgids and remove system white-listed files | os-06", "when": "os_security_suid_sgid_remove_from_unknown | bool"}, "module_options": {"suid": "{{ sbit_binaries.stdout_lines | difference(os_security_suid_sgid_system_whitelist) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove suid/sgid bit from all binaries except in system and user whitelist | os-06", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "remove suid/sgid bit from all binaries except in system and user whitelist | os-06", "with_flattened": ["{{ suid | default([]) | difference(os_security_suid_sgid_whitelist) }}"], "when": "os_security_suid_sgid_remove_from_unknown | bool"}, "module_options": {"path": "{{ item }}", "mode": "a-s", "state": "file", "follow": "yes"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/login_defs.yml": {"py/object": "struct4.TaskFile", "name": "login_defs.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/login_defs.yml", "tasks": [{"py/object": "struct4.Task", "name": "create login.defs | os-05, os-05b", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/login_defs.yml", "options": {"name": "create login.defs | os-05, os-05b"}, "module_options": {"src": "etc/login.defs.j2", "dest": "/etc/login.defs", "owner": "root", "group": "root", "mode": "0444"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml": {"py/object": "struct4.TaskFile", "name": "auditd.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "tasks": [{"py/object": "struct4.Task", "name": "install auditd package | package-08", "module": "package", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "options": {"name": "install auditd package | package-08"}, "module_options": {"name": "{{ auditd_package }}", "state": "present"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure auditd | package-08", "module": "template", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "options": {"name": "configure auditd | package-08"}, "module_options": {"src": "etc/audit/auditd.conf.j2", "dest": "/etc/audit/auditd.conf", "owner": "root", "group": "root", "mode": "0640"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/apt.yml": {"py/object": "struct4.TaskFile", "name": "apt.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/apt.yml", "tasks": [{"py/object": "struct4.Task", "name": "remove deprecated or insecure packages | package-01 - package-09", "module": "apt", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/apt.yml", "options": {"name": "remove deprecated or insecure packages | package-01 - package-09", "when": "os_security_packages_clean | bool"}, "module_options": {"name": "{{ os_security_packages_list }}", "state": "absent", "purge": "yes"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml": {"py/object": "struct4.TaskFile", "name": "yum.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "tasks": [{"py/object": "struct4.Task", "name": "remove unused repositories", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "remove unused repositories", "loop": ["CentOS-Debuginfo", "CentOS-Media", "CentOS-Vault"], "when": "os_security_packages_clean | bool"}, "module_options": {"name": "/etc/yum.repos.d/{{ item }}.repo", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "get yum-repository-files", "module": "find", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "get yum-repository-files", "register": "yum_repos"}, "module_options": {"paths": "/etc/yum.repos.d", "patterns": "*.repo"}, "executable": "find", "executable_type": "Module", "fqcn": "ansible.builtin.find", "annotations": {}}, {"py/object": "struct4.Task", "name": "activate gpg-check for yum-repository-files", "module": "replace", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "activate gpg-check for yum-repository-files", "with_items": ["{{ yum_repos.files | default([]) }}"]}, "module_options": {"path": "{{ item.path }}", "regexp": "^\\s*gpgcheck.*", "replace": "gpgcheck=1"}, "executable": "replace", "executable_type": "Module", "fqcn": "ansible.builtin.replace", "annotations": {}}, {"py/object": "struct4.Task", "name": "activate gpg-check for config files", "module": "replace", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "activate gpg-check for config files", "register": "status", "failed_when": "status.rc is defined and status.rc != 257", "loop": ["/etc/yum.conf", "/etc/dnf/dnf.conf", "/etc/yum/pluginconf.d/rhnplugin.conf"]}, "module_options": {"path": "{{ item }}", "regexp": "^\\s*gpgcheck\\W.*", "replace": "gpgcheck=1"}, "executable": "replace", "executable_type": "Module", "fqcn": "ansible.builtin.replace", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove deprecated or insecure packages | package-01 - package-09", "module": "yum", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "remove deprecated or insecure packages | package-01 - package-09", "when": "os_security_packages_clean | bool"}, "module_options": {"name": "{{ os_security_packages_list }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml": {"py/object": "struct4.TaskFile", "name": "sysctl.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "tasks": [{"py/object": "struct4.Task", "name": "protect sysctl.conf", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "protect sysctl.conf"}, "module_options": {"path": "/etc/sysctl.conf", "owner": "root", "group": "root", "mode": "0440"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "set Daemon umask, do config for rhel-family | NSA 2.2.4.1", "module": "template", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "set Daemon umask, do config for rhel-family | NSA 2.2.4.1", "when": "ansible_facts.distribution in ['Amazon', 'CentOS', 'Fedora', 'RedHat']"}, "module_options": {"src": "etc/sysconfig/rhel_sysconfig_init.j2", "dest": "/etc/sysconfig/init", "owner": "root", "group": "root", "mode": "0544"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "install initramfs-tools", "module": "apt", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "install initramfs-tools", "when": ["ansible_facts.os_family == 'Debian'", "os_security_kernel_enable_module_loading"]}, "module_options": {"name": "initramfs-tools", "state": "present", "update_cache": true}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "rebuild initramfs with starting pack of modules, if module loading at runtime is disabled", "module": "template", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "rebuild initramfs with starting pack of modules, if module loading at runtime is disabled", "notify": ["update-initramfs"], "when": ["ansible_facts.os_family == 'Debian'", "os_security_kernel_enable_module_loading"], "register": "initramfs"}, "module_options": {"src": "etc/initramfs-tools/modules.j2", "dest": "/etc/initramfs-tools/modules", "owner": "root", "group": "root", "mode": "0440"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "create a combined sysctl-dict if overwrites are defined", "module": "set_fact", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "create a combined sysctl-dict if overwrites are defined", "when": "sysctl_overwrite | default()"}, "module_options": {"sysctl_config": "{{ sysctl_config | combine(sysctl_overwrite) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Change various sysctl-settings, look at the sysctl-vars file for documentation", "module": "sysctl", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Change various sysctl-settings, look at the sysctl-vars file for documentation", "with_dict": "{{ sysctl_config }}"}, "module_options": {"name": "{{ item.key }}", "value": "{{ item.value }}", "sysctl_set": true, "state": "present", "reload": true, "ignoreerrors": true}, "executable": "sysctl", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation", "module": "sysctl", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation", "with_dict": "{{ sysctl_rhel_config }}", "when": "((ansible_facts.distribution in ['CentOS', 'Fedora', 'RedHat']) and ansible_distribution_version|int is version('7', '<')) or ansible_facts.distribution == 'Amazon'"}, "module_options": {"name": "{{ item.key }}", "value": "{{ item.value }}", "state": "present", "reload": true, "ignoreerrors": true}, "executable": "sysctl", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Apply ufw defaults", "module": "template", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Apply ufw defaults", "when": ["ufw_manage_defaults", "ansible_facts.distribution in ['Debian', 'Ubuntu']"], "tags": "ufw"}, "module_options": {"src": "etc/default/ufw.j2", "dest": "/etc/default/ufw"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/main.yml": {"py/object": "struct4.TaskFile", "name": "main.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/main.yml", "tasks": [{"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/main.yml", "options": {"when": "os_hardening_enabled | bool"}, "module_options": "hardening.yml", "executable": "hardening.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml": {"py/object": "struct4.TaskFile", "name": "modprobe.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "tasks": [{"py/object": "struct4.Task", "name": "install modprobe to disable filesystems | os-10", "module": "package", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "install modprobe to disable filesystems | os-10"}, "module_options": {"name": "{{ modprobe_package }}", "state": "present"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "check if efi is installed", "module": "stat", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "check if efi is installed", "register": "efi_installed"}, "module_options": {"path": "/sys/firmware/efi"}, "executable": "stat", "executable_type": "Module", "fqcn": "ansible.builtin.stat", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove vfat from fs-list if efi is used", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "remove vfat from fs-list if efi is used", "when": ["efi_installed.stat.isdir is defined", "efi_installed.stat.isdir"]}, "module_options": {"os_unused_filesystems": "{{ os_unused_filesystems | difference('vfat') }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove used filesystems from fs-list", "module": "set_fact", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "remove used filesystems from fs-list", "when": "not ((ansible_facts.os_family in ['Oracle Linux', 'RedHat']) and ansible_facts.distribution_major_version < '7')"}, "module_options": {"os_unused_filesystems": "{{ os_unused_filesystems | difference(ansible_mounts | map(attribute='fstype') | list) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "disable unused filesystems | os-10", "module": "template", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "disable unused filesystems | os-10"}, "module_options": {"src": "etc/modprobe.d/modprobe.j2", "dest": "/etc/modprobe.d/dev-sec.conf", "owner": "root", "group": "root", "mode": "0644"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}}, "role_dict": {"dev-sec.os-hardening": {"py/object": "struct4.Role", "name": "dev-sec.os-hardening", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening", "fqcn": "dev-sec.os-hardening", "collection": "", "taskfiles": [{"py/object": "struct4.TaskFile", "name": "user_accounts.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "tasks": [{"py/object": "struct4.Task", "name": "get UID_MIN from login.defs", "module": "shell", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "get UID_MIN from login.defs", "args": {"removes": "/etc/login.defs"}, "register": "uid_min", "check_mode": false, "changed_when": false}, "module_options": "awk '/^\\s*UID_MIN\\s*([0-9]*).*?$/ {print $2}' /etc/login.defs", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "calculate UID_MAX from UID_MIN by substracting 1", "module": "set_fact", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "calculate UID_MAX from UID_MIN by substracting 1", "when": "uid_min.stdout|int > 0"}, "module_options": {"uid_max": "{{ uid_min.stdout | int - 1 }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "set UID_MAX on Debian-systems if no login.defs exist", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "set UID_MAX on Debian-systems if no login.defs exist", "when": ["ansible_facts.os_family == 'Debian'", "uid_max is not defined"]}, "module_options": {"uid_max": "999"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "set UID_MAX on other systems if no login.defs exist", "module": "set_fact", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "set UID_MAX on other systems if no login.defs exist", "when": "uid_max is not defined"}, "module_options": {"uid_max": "499"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "get all system accounts", "module": "command", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "get all system accounts", "args": {"removes": "/etc/passwd"}, "changed_when": false, "check_mode": false, "register": "sys_accs"}, "module_options": "awk -F'':'' '{ if ( $3 <= {{ uid_max|quote }} ) print $1}' /etc/passwd", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove always ignored system accounts from list", "module": "set_fact", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "remove always ignored system accounts from list", "check_mode": false}, "module_options": {"sys_accs_cond": "{{ sys_accs.stdout_lines | difference(os_always_ignore_users) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "change system accounts not on the user provided ignore-list", "module": "user", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/user_accounts.yml", "options": {"name": "change system accounts not on the user provided ignore-list", "with_flattened": ["{{ sys_accs_cond | default([]) | difference(os_ignore_users) | list }}"]}, "module_options": {"name": "{{ item }}", "shell": "{{ os_nologin_shell_path }}", "password": "*", "createhome": false}, "executable": "user", "executable_type": "Module", "fqcn": "ansible.builtin.user", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "rhosts.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "tasks": [{"py/object": "struct4.Task", "name": "Get user accounts | os-09", "module": "command", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "Get user accounts | os-09", "changed_when": false, "check_mode": false, "register": "users_accounts"}, "module_options": "awk -F: '{print $1}' /etc/passwd", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete rhosts-files from system | os-09", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete rhosts-files from system | os-09", "with_flattened": "{{ users_accounts.stdout_lines | default([]) }}"}, "module_options": {"dest": "~{{ item }}/.rhosts", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete hosts.equiv from system | os-01", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete hosts.equiv from system | os-01"}, "module_options": {"dest": "/etc/hosts.equiv", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete .netrc-files from system | os-09", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/rhosts.yml", "options": {"name": "delete .netrc-files from system | os-09", "with_flattened": "{{ users_accounts.stdout_lines | default([]) }}"}, "module_options": {"dest": "~{{ item }}/.netrc", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "securetty.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/securetty.yml", "tasks": [{"py/object": "struct4.Task", "name": "create securetty", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/securetty.yml", "options": {"name": "create securetty"}, "module_options": {"src": "etc/securetty.j2", "dest": "/etc/securetty", "owner": "root", "group": "root", "mode": "0400"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "minimize_access.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "tasks": [{"py/object": "struct4.Task", "name": "find files with write-permissions for group", "module": "shell", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "find files with write-permissions for group", "with_flattened": ["/usr/local/sbin", "/usr/local/bin", "/usr/sbin", "/usr/bin", "/sbin", "/bin", "{{ os_env_extra_user_paths }}"], "register": "minimize_access_directories", "ignore_errors": true, "changed_when": false}, "module_options": "find -L {{ item }} -perm /go+w -type f", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "minimize access on found files", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "minimize access on found files", "with_subelements": ["{{ minimize_access_directories.results }}", "stdout_lines"]}, "module_options": {"path": "{{ item.1 }}", "mode": "go-w", "state": "file"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "change shadow ownership to root and mode to 0600 | os-02", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change shadow ownership to root and mode to 0600 | os-02"}, "module_options": {"dest": "/etc/shadow", "owner": "{{ os_shadow_perms.owner }}", "group": "{{ os_shadow_perms.group }}", "mode": "{{ os_shadow_perms.mode }}"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "change passwd ownership to root and mode to 0644 | os-03", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change passwd ownership to root and mode to 0644 | os-03"}, "module_options": {"dest": "/etc/passwd", "owner": "{{ os_passwd_perms.owner }}", "group": "{{ os_passwd_perms.group }}", "mode": "{{ os_passwd_perms.mode }}"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "change su-binary to only be accessible to user and group root", "module": "file", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "change su-binary to only be accessible to user and group root", "when": "\"change_user\" not in os_security_users_allow"}, "module_options": {"dest": "/bin/su", "owner": "root", "group": "root", "mode": "0750"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "set option hidepid for proc filesystem", "module": "mount", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/minimize_access.yml", "options": {"name": "set option hidepid for proc filesystem"}, "module_options": {"path": "/proc", "src": "proc", "fstype": "proc", "opts": "{{ proc_mnt_options }}", "state": "present"}, "executable": "mount", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "limits.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "tasks": [{"py/object": "struct4.Task", "name": "create limits.d-directory if it does not exist | sysctl-31a, sysctl-31b", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "create limits.d-directory if it does not exist | sysctl-31a, sysctl-31b"}, "module_options": {"path": "/etc/security/limits.d", "owner": "root", "group": "root", "mode": "0755", "state": "directory"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "create additional limits config file -> 10.hardcore.conf | sysctl-31a, sysctl-31b", "module": "pam_limits", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "create additional limits config file -> 10.hardcore.conf | sysctl-31a, sysctl-31b"}, "module_options": {"dest": "/etc/security/limits.d/10.hardcore.conf", "domain": "*", "limit_type": "hard", "limit_item": "core", "value": "0", "comment": "Prevent core dumps for all users. These are usually not needed and may contain sensitive information"}, "executable": "pam_limits", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "set 10.hardcore.conf perms to 0400 and root ownership", "module": "file", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "set 10.hardcore.conf perms to 0400 and root ownership"}, "module_options": {"path": "/etc/security/limits.d/10.hardcore.conf", "owner": "root", "group": "root", "mode": "0440"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove 10.hardcore.conf config file", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/limits.yml", "options": {"name": "remove 10.hardcore.conf config file", "when": "os_security_kernel_enable_core_dump | bool"}, "module_options": {"path": "/etc/security/limits.d/10.hardcore.conf", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "selinux.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/selinux.yml", "tasks": [{"py/object": "struct4.Task", "name": "configure selinux | selinux-01", "module": "selinux", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/selinux.yml", "options": {"name": "configure selinux | selinux-01"}, "module_options": {"policy": "{{ os_selinux_policy }}", "state": "{{ os_selinux_state }}"}, "executable": "selinux", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "profile.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "tasks": [{"py/object": "struct4.Task", "name": "add pinerolo_profile.sh to profile.d", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "options": {"name": "add pinerolo_profile.sh to profile.d", "when": "not os_security_kernel_enable_core_dump | bool"}, "module_options": {"src": "etc/profile.d/profile.conf.j2", "dest": "/etc/profile.d/pinerolo_profile.sh", "owner": "root", "group": "root", "mode": "0750"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pinerolo_profile.sh from profile.d", "module": "file", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/profile.yml", "options": {"name": "remove pinerolo_profile.sh from profile.d", "when": "os_security_kernel_enable_core_dump | bool"}, "module_options": {"path": "/etc/profile.d/pinerolo_profile.sh", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "pam.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "tasks": [{"py/object": "struct4.Task", "name": "update pam on Debian systems", "module": "command", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "update pam on Debian systems", "when": "ansible_facts.distribution in ['Debian', 'Ubuntu']", "changed_when": false, "environment": {"DEBIAN_FRONTEND": "noninteractive"}}, "module_options": "pam-auth-update --package", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pam ccreds to disable password caching", "module": "package", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam ccreds to disable password caching"}, "module_options": {"name": "{{ os_packages_pam_ccreds }}", "state": "absent"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pam_cracklib, because it does not play nice with passwdqc", "module": "apt", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam_cracklib, because it does not play nice with passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_cracklib }}", "state": "absent"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "install the package for strong password checking", "module": "apt", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install the package for strong password checking", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "present", "update_cache": "yes"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure passwdqc", "module": "template", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "os_auth_pam_passwdqc_enable"]}, "module_options": {"src": "usr/share/pam-configs/pam_passwdqd.j2", "dest": "{{ passwdqc_path }}", "mode": "0644", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove passwdqc", "module": "apt", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove passwdqc", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "absent"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "install tally2", "module": "apt", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install tally2", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries > 0"]}, "module_options": {"name": "libpam-modules", "state": "present"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure tally2", "module": "template", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure tally2", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries > 0"]}, "module_options": {"src": "usr/share/pam-configs/pam_tally2.j2", "dest": "{{ tally2_path }}", "mode": "0644", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "delete tally2 when retries is 0", "module": "file", "index": 8, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "delete tally2 when retries is 0", "when": ["ansible_facts.distribution in ['Debian', 'Ubuntu']", "not os_auth_pam_passwdqc_enable", "os_auth_retries == 0"]}, "module_options": {"path": "{{ tally2_path }}", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove pam_cracklib, because it does not play nice with passwdqc", "module": "yum", "index": 9, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove pam_cracklib, because it does not play nice with passwdqc", "when": ["ansible_facts.os_family == 'RedHat'", "ansible_facts.distribution_major_version|int is version('7', '<')", "ansible_facts.distribution != 'Amazon'", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_cracklib }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "install the package for strong password checking", "module": "yum", "index": 10, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "install the package for strong password checking", "when": ["ansible_facts.os_family == 'RedHat'", "ansible_facts.distribution_major_version|int is version('7', '<')", "ansible_facts.distribution != 'Amazon'", "os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "present"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove passwdqc", "module": "yum", "index": 11, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "remove passwdqc", "when": ["ansible_facts.os_family == 'RedHat'", "not os_auth_pam_passwdqc_enable"]}, "module_options": {"name": "{{ os_packages_pam_passwdqc }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure passwdqc and tally via central system-auth confic", "module": "template", "index": 12, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "configure passwdqc and tally via central system-auth confic", "when": "ansible_facts.os_family == 'RedHat'"}, "module_options": {"src": "etc/pam.d/rhel_system_auth.j2", "dest": "/etc/pam.d/system-auth-ac", "mode": "0640", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather package facts", "module": "package_facts", "index": 13, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "Gather package facts", "when": "ansible_facts.os_family != 'Suse'"}, "module_options": {"manager": "auto"}, "executable": "package_facts", "executable_type": "Module", "fqcn": "ansible.builtin.package_facts", "annotations": {}}, {"py/object": "struct4.Task", "name": "NSA 2.3.3.5 Upgrade Password Hashing Algorithm to SHA-512", "module": "template", "index": 14, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/pam.yml", "options": {"name": "NSA 2.3.3.5 Upgrade Password Hashing Algorithm to SHA-512", "when": ["ansible_facts.os_family != 'Suse'", "'libuser' in ansible_facts.packages"]}, "module_options": {"src": "etc/libuser.conf.j2", "dest": "/etc/libuser.conf", "mode": "0640", "owner": "root", "group": "root"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "hardening.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "tasks": [{"py/object": "struct4.Task", "name": "Set OS family dependent variables", "module": "include_vars", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"name": "Set OS family dependent variables", "tags": "always"}, "module_options": "{{ ansible_facts.os_family }}.yml", "executable": "include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set OS dependent variables", "module": "include_vars", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"name": "Set OS dependent variables", "with_first_found": [{"files": ["{{ ansible_facts.distribution }}-{{ ansible_facts.distribution_major_version }}.yml", "{{ ansible_facts.distribution }}.yml", "{{ ansible_facts.os_family }}-{{ ansible_facts.distribution_major_version }}.yml"], "skip": true}], "tags": "always"}, "module_options": "{{ item }}", "executable": "include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "auditd", "when": "os_auditd_enabled | bool"}, "module_options": "auditd.yml", "executable": "auditd.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "limits"}, "module_options": "limits.yml", "executable": "limits.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "login_defs"}, "module_options": "login_defs.yml", "executable": "login_defs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "minimize_access"}, "module_options": "minimize_access.yml", "executable": "minimize_access.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "pam"}, "module_options": "pam.yml", "executable": "pam.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "modprobe"}, "module_options": "modprobe.yml", "executable": "modprobe.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 8, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "profile"}, "module_options": "profile.yml", "executable": "profile.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 9, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "securetty"}, "module_options": "securetty.yml", "executable": "securetty.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 10, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "os_security_suid_sgid_enforce  | bool", "tags": "suid_sgid"}, "module_options": "suid_sgid.yml", "executable": "suid_sgid.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 11, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "sysctl"}, "module_options": "sysctl.yml", "executable": "sysctl.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 12, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "user_accounts"}, "module_options": "user_accounts.yml", "executable": "user_accounts.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 13, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "rhosts"}, "module_options": "rhosts.yml", "executable": "rhosts.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 14, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "ansible_facts.os_family == 'RedHat'", "tags": "yum"}, "module_options": "yum.yml", "executable": "yum.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 15, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"when": "ansible_facts.distribution in ['Debian', 'Ubuntu']", "tags": "apt"}, "module_options": "apt.yml", "executable": "apt.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 16, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/hardening.yml", "options": {"tags": "selinux", "when": "ansible_facts.selinux.status == 'enabled'"}, "module_options": "selinux.yml", "executable": "selinux.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "suid_sgid.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "tasks": [{"py/object": "struct4.Task", "name": "remove suid/sgid bit from binaries in blacklist | os-06", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "remove suid/sgid bit from binaries in blacklist | os-06", "failed_when": false, "with_flattened": ["{{ os_security_suid_sgid_system_blacklist }}", "{{ os_security_suid_sgid_blacklist }}"]}, "module_options": {"path": "{{ item }}", "mode": "a-s", "state": "file", "follow": "yes"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "find binaries with suid/sgid set | os-06", "module": "shell", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "find binaries with suid/sgid set | os-06", "register": "sbit_binaries", "when": "os_security_suid_sgid_remove_from_unknown | bool", "changed_when": false}, "module_options": "find / -xdev \\( -perm -4000 -o -perm -2000 \\) -type f ! -path '/proc/*' -print 2>/dev/null", "executable": "shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "gather files from which to remove suids/sgids and remove system white-listed files | os-06", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "gather files from which to remove suids/sgids and remove system white-listed files | os-06", "when": "os_security_suid_sgid_remove_from_unknown | bool"}, "module_options": {"suid": "{{ sbit_binaries.stdout_lines | difference(os_security_suid_sgid_system_whitelist) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove suid/sgid bit from all binaries except in system and user whitelist | os-06", "module": "file", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/suid_sgid.yml", "options": {"name": "remove suid/sgid bit from all binaries except in system and user whitelist | os-06", "with_flattened": ["{{ suid | default([]) | difference(os_security_suid_sgid_whitelist) }}"], "when": "os_security_suid_sgid_remove_from_unknown | bool"}, "module_options": {"path": "{{ item }}", "mode": "a-s", "state": "file", "follow": "yes"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "login_defs.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/login_defs.yml", "tasks": [{"py/object": "struct4.Task", "name": "create login.defs | os-05, os-05b", "module": "template", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/login_defs.yml", "options": {"name": "create login.defs | os-05, os-05b"}, "module_options": {"src": "etc/login.defs.j2", "dest": "/etc/login.defs", "owner": "root", "group": "root", "mode": "0444"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "auditd.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "tasks": [{"py/object": "struct4.Task", "name": "install auditd package | package-08", "module": "package", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "options": {"name": "install auditd package | package-08"}, "module_options": {"name": "{{ auditd_package }}", "state": "present"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure auditd | package-08", "module": "template", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/auditd.yml", "options": {"name": "configure auditd | package-08"}, "module_options": {"src": "etc/audit/auditd.conf.j2", "dest": "/etc/audit/auditd.conf", "owner": "root", "group": "root", "mode": "0640"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "apt.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/apt.yml", "tasks": [{"py/object": "struct4.Task", "name": "remove deprecated or insecure packages | package-01 - package-09", "module": "apt", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/apt.yml", "options": {"name": "remove deprecated or insecure packages | package-01 - package-09", "when": "os_security_packages_clean | bool"}, "module_options": {"name": "{{ os_security_packages_list }}", "state": "absent", "purge": "yes"}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "yum.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "tasks": [{"py/object": "struct4.Task", "name": "remove unused repositories", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "remove unused repositories", "loop": ["CentOS-Debuginfo", "CentOS-Media", "CentOS-Vault"], "when": "os_security_packages_clean | bool"}, "module_options": {"name": "/etc/yum.repos.d/{{ item }}.repo", "state": "absent"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "get yum-repository-files", "module": "find", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "get yum-repository-files", "register": "yum_repos"}, "module_options": {"paths": "/etc/yum.repos.d", "patterns": "*.repo"}, "executable": "find", "executable_type": "Module", "fqcn": "ansible.builtin.find", "annotations": {}}, {"py/object": "struct4.Task", "name": "activate gpg-check for yum-repository-files", "module": "replace", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "activate gpg-check for yum-repository-files", "with_items": ["{{ yum_repos.files | default([]) }}"]}, "module_options": {"path": "{{ item.path }}", "regexp": "^\\s*gpgcheck.*", "replace": "gpgcheck=1"}, "executable": "replace", "executable_type": "Module", "fqcn": "ansible.builtin.replace", "annotations": {}}, {"py/object": "struct4.Task", "name": "activate gpg-check for config files", "module": "replace", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "activate gpg-check for config files", "register": "status", "failed_when": "status.rc is defined and status.rc != 257", "loop": ["/etc/yum.conf", "/etc/dnf/dnf.conf", "/etc/yum/pluginconf.d/rhnplugin.conf"]}, "module_options": {"path": "{{ item }}", "regexp": "^\\s*gpgcheck\\W.*", "replace": "gpgcheck=1"}, "executable": "replace", "executable_type": "Module", "fqcn": "ansible.builtin.replace", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove deprecated or insecure packages | package-01 - package-09", "module": "yum", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/yum.yml", "options": {"name": "remove deprecated or insecure packages | package-01 - package-09", "when": "os_security_packages_clean | bool"}, "module_options": {"name": "{{ os_security_packages_list }}", "state": "absent"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "sysctl.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "tasks": [{"py/object": "struct4.Task", "name": "protect sysctl.conf", "module": "file", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "protect sysctl.conf"}, "module_options": {"path": "/etc/sysctl.conf", "owner": "root", "group": "root", "mode": "0440"}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "set Daemon umask, do config for rhel-family | NSA 2.2.4.1", "module": "template", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "set Daemon umask, do config for rhel-family | NSA 2.2.4.1", "when": "ansible_facts.distribution in ['Amazon', 'CentOS', 'Fedora', 'RedHat']"}, "module_options": {"src": "etc/sysconfig/rhel_sysconfig_init.j2", "dest": "/etc/sysconfig/init", "owner": "root", "group": "root", "mode": "0544"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "install initramfs-tools", "module": "apt", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "install initramfs-tools", "when": ["ansible_facts.os_family == 'Debian'", "os_security_kernel_enable_module_loading"]}, "module_options": {"name": "initramfs-tools", "state": "present", "update_cache": true}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "rebuild initramfs with starting pack of modules, if module loading at runtime is disabled", "module": "template", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "rebuild initramfs with starting pack of modules, if module loading at runtime is disabled", "notify": ["update-initramfs"], "when": ["ansible_facts.os_family == 'Debian'", "os_security_kernel_enable_module_loading"], "register": "initramfs"}, "module_options": {"src": "etc/initramfs-tools/modules.j2", "dest": "/etc/initramfs-tools/modules", "owner": "root", "group": "root", "mode": "0440"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "create a combined sysctl-dict if overwrites are defined", "module": "set_fact", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "create a combined sysctl-dict if overwrites are defined", "when": "sysctl_overwrite | default()"}, "module_options": {"sysctl_config": "{{ sysctl_config | combine(sysctl_overwrite) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Change various sysctl-settings, look at the sysctl-vars file for documentation", "module": "sysctl", "index": 5, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Change various sysctl-settings, look at the sysctl-vars file for documentation", "with_dict": "{{ sysctl_config }}"}, "module_options": {"name": "{{ item.key }}", "value": "{{ item.value }}", "sysctl_set": true, "state": "present", "reload": true, "ignoreerrors": true}, "executable": "sysctl", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation", "module": "sysctl", "index": 6, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation", "with_dict": "{{ sysctl_rhel_config }}", "when": "((ansible_facts.distribution in ['CentOS', 'Fedora', 'RedHat']) and ansible_distribution_version|int is version('7', '<')) or ansible_facts.distribution == 'Amazon'"}, "module_options": {"name": "{{ item.key }}", "value": "{{ item.value }}", "state": "present", "reload": true, "ignoreerrors": true}, "executable": "sysctl", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Apply ufw defaults", "module": "template", "index": 7, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/sysctl.yml", "options": {"name": "Apply ufw defaults", "when": ["ufw_manage_defaults", "ansible_facts.distribution in ['Debian', 'Ubuntu']"], "tags": "ufw"}, "module_options": {"src": "etc/default/ufw.j2", "dest": "/etc/default/ufw"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "main.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/main.yml", "tasks": [{"py/object": "struct4.Task", "name": "", "module": "import_tasks", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/main.yml", "options": {"when": "os_hardening_enabled | bool"}, "module_options": "hardening.yml", "executable": "hardening.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "modprobe.yml", "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "tasks": [{"py/object": "struct4.Task", "name": "install modprobe to disable filesystems | os-10", "module": "package", "index": 0, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "install modprobe to disable filesystems | os-10"}, "module_options": {"name": "{{ modprobe_package }}", "state": "present"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "check if efi is installed", "module": "stat", "index": 1, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "check if efi is installed", "register": "efi_installed"}, "module_options": {"path": "/sys/firmware/efi"}, "executable": "stat", "executable_type": "Module", "fqcn": "ansible.builtin.stat", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove vfat from fs-list if efi is used", "module": "set_fact", "index": 2, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "remove vfat from fs-list if efi is used", "when": ["efi_installed.stat.isdir is defined", "efi_installed.stat.isdir"]}, "module_options": {"os_unused_filesystems": "{{ os_unused_filesystems | difference('vfat') }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "remove used filesystems from fs-list", "module": "set_fact", "index": 3, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "remove used filesystems from fs-list", "when": "not ((ansible_facts.os_family in ['Oracle Linux', 'RedHat']) and ansible_facts.distribution_major_version < '7')"}, "module_options": {"os_unused_filesystems": "{{ os_unused_filesystems | difference(ansible_mounts | map(attribute='fstype') | list) }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "disable unused filesystems | os-10", "module": "template", "index": 4, "defined_in": "./role-test/testdata/dev-sec-os-hardening/dev-sec.os-hardening/tasks/modprobe.yml", "options": {"name": "disable unused filesystems | os-10"}, "module_options": {"src": "etc/modprobe.d/modprobe.j2", "dest": "/etc/modprobe.d/dev-sec.conf", "owner": "root", "group": "root", "mode": "0644"}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}], "role": "dev-sec.os-hardening", "used_in": [], "annotations": {}}], "modules": [], "source": "", "annotations": {}, "used_in": []}}, "annotations": {}}