{"py/object": "struct4.Repository", "name": "", "path": "", "my_collection_name": "", "playbooks": [], "roles": [], "installed_collections_path": "", "installed_collections": [], "installed_roles_path": "./role-test/testdata/do1jlr-gitea", "installed_roles": [{"py/object": "struct4.Role", "name": "do1jlr.gitea", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea", "fqcn": "do1jlr.gitea", "collection": "", "taskfiles": [{"py/object": "struct4.TaskFile", "name": "install_systemd.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "tasks": [{"py/object": "struct4.Task", "name": "Setup systemd service", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "options": {"name": "Setup systemd service", "become": true, "notify": ["Reload systemd", "Restart gitea"]}, "module_options": {"src": "gitea.service.j2", "dest": "/lib/systemd/system/gitea.service", "owner": "root", "group": "root", "mode": 420}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Reload systemd", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "options": {"name": "Reload systemd", "become": true}, "module_options": {"daemon_reload": true}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "gitea_secrets.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "tasks": [{"py/object": "struct4.Task", "name": "generate gitea SECRET_KEY if not provided", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "generate gitea SECRET_KEY if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_secret_key"}, "when": "gitea_secret_key | string | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret SECRET_KEY > /etc/gitea/gitea_secret_key", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read gitea SECRET_KEY from file", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "read gitea SECRET_KEY from file", "become": true, "register": "remote_secret_key", "when": "gitea_secret_key | string | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_secret_key"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_secret_key", "module": "ansible.builtin.set_fact", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "set fact gitea_secret_key", "when": "gitea_secret_key | string |  length == 0"}, "module_options": {"gitea_secret_key": "{{ remote_secret_key['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate gitea INTERNAL_TOKEN if not provided", "module": "ansible.builtin.shell", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "generate gitea INTERNAL_TOKEN if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_internal_token"}, "when": "gitea_internal_token | string | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret INTERNAL_TOKEN > /etc/gitea/gitea_internal_token", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read gitea INTERNAL_TOKEN from file", "module": "ansible.builtin.slurp", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "read gitea INTERNAL_TOKEN from file", "become": true, "register": "remote_internal_token", "when": "gitea_internal_token | string | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_internal_token"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_internal_token", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "set fact gitea_internal_token", "when": "gitea_internal_token | string | length == 0"}, "module_options": {"gitea_internal_token": "{{ remote_internal_token['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "set_version.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "tasks": [{"py/object": "struct4.Task", "name": "Check gitea installed version", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Check gitea installed version", "args": {"executable": "/bin/bash"}, "register": "gitea_active_version", "changed_when": false, "failed_when": false}, "module_options": "set -eo pipefail; /usr/local/bin/gitea -v | cut -d' ' -f 3", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "Get latest gitea release metadata", "module": "ansible.builtin.uri", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Get latest gitea release metadata", "register": "gitea_remote_metadata", "when": "not ansible_check_mode"}, "module_options": {"url": "https://api.github.com/repos/go-gitea/gitea/releases/latest", "return_content": true}, "executable": "ansible.builtin.uri", "executable_type": "Module", "fqcn": "ansible.builtin.uri", "annotations": {}}, {"py/object": "struct4.Task", "name": "Fail if running in check mode without versions set.", "module": "ansible.builtin.fail", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Fail if running in check mode without versions set.", "when": "ansible_check_mode and ( gitea_version == 'latest' or gitea_version == 'present' )"}, "module_options": {"msg": "\"You are running this playbook in check mode:\nPlease set the Gitea version with the variable 'gitea_version', because the URI module cannot detect the latest version in this mode.\"\n"}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set fact latest gitea release", "module": "ansible.builtin.set_fact", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set fact latest gitea release", "when": "not ansible_check_mode"}, "module_options": {"gitea_remote_version": "{{ gitea_remote_metadata.json.tag_name[1:] }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set gitea version target (latest)", "module": "ansible.builtin.set_fact", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set gitea version target (latest)", "when": "not ansible_check_mode"}, "module_options": {"gitea_version_target": "{{ gitea_remote_version }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set gitea version target ({{ gitea_version }})", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set gitea version target ({{ gitea_version }})", "when": "gitea_version != \"latest\""}, "module_options": {"gitea_version_target": "{{ gitea_version }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Generate gitea download URL", "module": "ansible.builtin.set_fact", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Generate gitea download URL"}, "module_options": {"gitea_dl_url": "https://github.com/go-gitea/gitea/releases/download/v{{ gitea_version_target }}/gitea-{{ gitea_version_target }}-linux-{{ gitea_arch }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "versioncheck.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "tasks": [{"py/object": "struct4.Task", "name": "Create directory for versionscheck", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Create directory for versionscheck", "become": true, "when": "submodules_versioncheck|bool"}, "module_options": {"path": "/etc/.ansible-version", "state": "directory", "mode": 493}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "check playbook version", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "check playbook version", "become": true, "register": "playbook_version", "when": "submodules_versioncheck|bool", "ignore_errors": true, "failed_when": false}, "module_options": {"src": "/etc/.ansible-version/{{ playbook_version_path }}"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "Print remote role version", "module": "ansible.builtin.debug", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Print remote role version", "when": "submodules_versioncheck|bool"}, "module_options": {"msg": "Remote role version: {{ playbook_version.content | default('Y3VycmVudGx5IG5vdCBkZXBsb3llZAo=') | b64decode | string }}"}, "executable": "ansible.builtin.debug", "executable_type": "Module", "fqcn": "ansible.builtin.debug", "annotations": {}}, {"py/object": "struct4.Task", "name": "Print locale role version", "module": "ansible.builtin.debug", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Print locale role version", "when": "submodules_versioncheck|bool"}, "module_options": {"msg": "Local role version: '{{ playbook_version_number|string }}'."}, "executable": "ansible.builtin.debug", "executable_type": "Module", "fqcn": "ansible.builtin.debug", "annotations": {}}, {"py/object": "struct4.Task", "name": "Check if your version is outdated", "module": "ansible.builtin.fail", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Check if your version is outdated", "when": ["playbook_version.content|default(\"Mgo=\")|b64decode|int - 1 >= playbook_version_number|int and submodules_versioncheck|bool"]}, "module_options": {"msg": "Your ansible module has the version '{{ playbook_version_number }}' and is outdated. You need to update it!"}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, {"py/object": "struct4.Task", "name": "write new version to remote disk", "module": "ansible.builtin.copy", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "write new version to remote disk", "become": true, "when": "submodules_versioncheck|bool"}, "module_options": {"content": "{{ playbook_version_number }}", "dest": "/etc/.ansible-version/{{ playbook_version_path }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "configure.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "tasks": [{"py/object": "struct4.Task", "name": "Configure gitea", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "options": {"name": "Configure gitea", "become": true, "notify": "Restart gitea"}, "module_options": {"src": "gitea.ini.j2", "dest": "/etc/gitea/gitea.ini", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": 384}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Service gitea", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "options": {"name": "Service gitea", "become": true, "when": "ansible_service_mgr == \"systemd\""}, "module_options": {"name": "gitea", "state": "started", "enabled": true}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "fail2ban.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "tasks": [{"py/object": "struct4.Task", "name": "Install fail2ban filter", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "Install fail2ban filter", "become": true, "notify": "systemctl restart fail2ban", "when": "'fail2ban' in ansible_facts.packages"}, "module_options": {"src": "fail2ban/filter.conf.j2", "dest": "/etc/fail2ban/filter.d/gitea.conf", "owner": "root", "group": "root", "mode": 292}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install fail2ban jail", "module": "ansible.builtin.template", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "Install fail2ban jail", "become": true, "notify": "systemctl restart fail2ban", "when": "'fail2ban' in ansible_facts.packages"}, "module_options": {"src": "fail2ban/jail.conf.j2", "dest": "/etc/fail2ban/jail.d/gitea.conf", "owner": "root", "group": "root", "mode": 292}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "warn if fail2ban is not installed", "module": "ansible.builtin.fail", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "warn if fail2ban is not installed", "when": "'fail2ban' not in ansible_facts.packages", "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"msg": "the package fail2ban is not installed. no fail2ban filters deployed."}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "customize_footer.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "tasks": [{"py/object": "struct4.Task", "name": "create directory for custom footer", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "options": {"name": "create directory for custom footer", "become": true, "with_items": ["{{ gitea_custom }}/templates", "{{ gitea_custom }}/templates/custom"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom footer template", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "options": {"name": "transfer custom footer template", "become": true, "ignore_errors": true, "tags": "skip_ansible_lint", "notify": "Restart gitea"}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_footer) }}", "dest": "{{ gitea_custom }}/templates/custom/extra_links_footer.tmpl", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "directory.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/directory.yml", "tasks": [{"py/object": "struct4.Task", "name": "Create config and data directory", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/directory.yml", "options": {"name": "Create config and data directory", "become": true, "with_items": ["/etc/gitea", "{{ gitea_home }}", "{{ gitea_home }}/data", "{{ gitea_custom }}", "{{ gitea_custom }}/https", "{{ gitea_custom }}/mailer", "{{ gitea_home }}/indexers", "{{ gitea_home }}/log", "{{ gitea_repository_root }}"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "jwt_secrets.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "tasks": [{"py/object": "struct4.Task", "name": "generate OAuth2 JWT_SECRET if not provided", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "generate OAuth2 JWT_SECRET if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_oauth_jwt_secret"}, "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret JWT_SECRET > /etc/gitea/gitea_oauth_jwt_secret", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read OAuth2 JWT_SECRET from file", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "read OAuth2 JWT_SECRET from file", "become": true, "register": "oauth_jwt_secret", "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_oauth_jwt_secret"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_oauth2_jwt_secret", "module": "ansible.builtin.set_fact", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "set fact gitea_oauth2_jwt_secret", "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": {"gitea_oauth2_jwt_secret": "{{ oauth_jwt_secret['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate LFS JWT_SECRET if not provided", "module": "ansible.builtin.shell", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "generate LFS JWT_SECRET if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_lfs_jwt_secret"}, "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret JWT_SECRET > /etc/gitea/gitea_lfs_jwt_secret", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read LFS JWT_SECRET from file", "module": "ansible.builtin.slurp", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "read LFS JWT_SECRET from file", "become": true, "register": "lfs_jwt_secret", "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_lfs_jwt_secret"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_lfs_jwt_secret", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "set fact gitea_lfs_jwt_secret", "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": {"gitea_lfs_jwt_secret": "{{ lfs_jwt_secret['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "customize_logo.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "tasks": [{"py/object": "struct4.Task", "name": "create directory for custom logos", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "create directory for custom logos", "become": true, "with_items": ["{{ gitea_custom }}/public", "{{ gitea_custom }}/public/img"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom logo.svg", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom logo.svg", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_logosvg) }}", "dest": "{{ gitea_custom }}/public/img/logo.svg", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom logo.png", "module": "ansible.builtin.copy", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom logo.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_logopng) }}", "dest": "{{ gitea_custom }}/public/img/logo.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom favicon.png", "module": "ansible.builtin.copy", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom favicon.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_faviconpng) }}", "dest": "{{ gitea_custom }}/public/img/favicon.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom apple-touch-icon.png", "module": "ansible.builtin.copy", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom apple-touch-icon.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_appletouchiconpng) }}", "dest": "{{ gitea_custom }}/public/img/apple-touch-icon.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "customize_public_files.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "tasks": [{"py/object": "struct4.Task", "name": "create public directory for custom public web files", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "options": {"name": "create public directory for custom public web files", "become": true, "with_items": ["{{ gitea_custom }}/public"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom public web data", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "options": {"name": "transfer custom public web data", "become": true, "ignore_errors": true, "tags": "skip_ansible_lint", "notify": "Restart gitea"}, "module_options": {"src": "{{ gitea_customize_files_path }}", "dest": "{{ gitea_custom }}/public/", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "directory_mode": true, "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "backup.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "tasks": [{"py/object": "struct4.Task", "name": "Get service facts", "module": "ansible.builtin.service_facts", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Get service facts"}, "module_options": null, "executable": "ansible.builtin.service_facts", "executable_type": "Module", "fqcn": "ansible.builtin.service_facts", "annotations": {}}, {"py/object": "struct4.Task", "name": "Stopping gitea before upgrade", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Stopping gitea before upgrade", "become": true, "when": "ansible_service_mgr == \"systemd\""}, "module_options": {"name": "gitea", "state": "stopped"}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create backup directory", "module": "ansible.builtin.file", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Create backup directory", "become": true, "with_items": ["{{ gitea_backup_location }}"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwx,g=rx,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "Backing up gitea before upgrade", "module": "ansible.builtin.command", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Backing up gitea before upgrade", "become": true, "changed_when": true}, "module_options": {"cmd": "sudo -u {{ gitea_user }} /usr/local/bin/gitea dump -c /etc/gitea/gitea.ini", "chdir": "{{ gitea_backup_location }}"}, "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "create_user.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "tasks": [{"py/object": "struct4.Task", "name": "Create Gitea Group", "module": "ansible.builtin.group", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Create Gitea Group", "become": true}, "module_options": {"name": "{{ gitea_group }}", "system": true, "state": "present"}, "executable": "ansible.builtin.group", "executable_type": "Module", "fqcn": "ansible.builtin.group", "annotations": {}}, {"py/object": "struct4.Task", "name": "Switch shell when not using the builtin ssh server", "module": "ansible.builtin.set_fact", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Switch shell when not using the builtin ssh server", "when": "not gitea_start_ssh and gitea_shell == '/bin/false'"}, "module_options": {"gitea_shell": "/bin/bash"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create Gitea user", "module": "ansible.builtin.user", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Create Gitea user", "become": true}, "module_options": {"name": "{{ gitea_user }}", "comment": "Gitea user", "group": "{{ gitea_group }}", "groups": "{{ gitea_groups | default(omit) }}", "home": "{{ gitea_home }}", "shell": "{{ gitea_shell }}", "system": true}, "executable": "ansible.builtin.user", "executable_type": "Module", "fqcn": "ansible.builtin.user", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "install.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "tasks": [{"py/object": "struct4.Task", "name": "Update apt cache", "module": "ansible.builtin.apt", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Update apt cache", "become": true, "register": "_pre_update_apt_cache", "until": "_pre_update_apt_cache is succeeded", "when": ["ansible_pkg_mgr == \"apt\""]}, "module_options": {"cache_valid_time": 3600, "update_cache": true}, "executable": "ansible.builtin.apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install dependencies", "module": "ansible.builtin.package", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Install dependencies", "become": true, "register": "_install_dep_packages", "until": "_install_dep_packages is succeeded", "retries": 5, "delay": 2}, "module_options": {"name": "{{ gitea_dependencies }}", "state": "present"}, "executable": "ansible.builtin.package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Download gitea archive", "module": "ansible.builtin.get_url", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Download gitea archive", "register": "_download_archive", "until": "_download_archive is succeeded", "retries": 5, "delay": 2}, "module_options": {"url": "{{ gitea_dl_url }}.xz", "dest": "/tmp/{{ gitea_filename }}.xz", "checksum": "sha256:{{ gitea_dl_url }}.xz.sha256", "mode": 416}, "executable": "ansible.builtin.get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "Download gitea asc file", "module": "ansible.builtin.get_url", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Download gitea asc file", "register": "_download_asc", "until": "_download_asc is succeeded", "retries": 5, "delay": 2}, "module_options": {"url": "{{ gitea_dl_url }}.xz.asc", "dest": "/tmp/{{ gitea_filename }}.xz.asc", "mode": 416}, "executable": "ansible.builtin.get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "Check gitea gpg key", "module": "ansible.builtin.command", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Check gitea gpg key", "register": "_gitea_gpg_key_status", "changed_when": false, "failed_when": "_gitea_gpg_key_status.rc not in (0, 2)"}, "module_options": "gpg --list-keys 0x{{ gitea_gpg_key }}", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Import gitea gpg key", "module": "ansible.builtin.command", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Import gitea gpg key", "register": "_gitea_import_key", "changed_when": "\"imported: 1\" in _gitea_import_key.stderr", "when": "_gitea_gpg_key_status.rc != 0"}, "module_options": "gpg --keyserver {{ gitea_gpg_server }} --recv {{ gitea_gpg_key }}", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Check archive signature", "module": "ansible.builtin.command", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Check archive signature", "changed_when": false}, "module_options": "gpg --verify /tmp/{{ gitea_filename }}.xz.asc /tmp/{{ gitea_filename }}.xz", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Unpack gitea binary", "module": "ansible.builtin.command", "index": 7, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Unpack gitea binary"}, "module_options": {"cmd": "xz -k -d /tmp/{{ gitea_filename }}.xz", "creates": "/tmp/{{ gitea_filename }}"}, "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Propagate gitea binary", "module": "ansible.builtin.copy", "index": 8, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Propagate gitea binary", "become": true, "notify": "Restart gitea"}, "module_options": {"src": "/tmp/{{ gitea_filename }}", "remote_src": true, "dest": "/usr/local/bin/gitea", "mode": 493, "owner": "root", "group": "root"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "main.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "tasks": [{"py/object": "struct4.Task", "name": "perform optional versionscheck", "module": "ansible.builtin.include_tasks", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "perform optional versionscheck", "when": "submodules_versioncheck|bool"}, "module_options": "versioncheck.yml", "executable": "versioncheck.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather installed packages for checks later on", "module": "ansible.builtin.package_facts", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather installed packages for checks later on"}, "module_options": {"manager": "auto"}, "executable": "ansible.builtin.package_facts", "executable_type": "Module", "fqcn": "ansible.builtin.package_facts", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather variables for each operating system", "module": "ansible.builtin.include_vars", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather variables for each operating system"}, "module_options": "{{ lookup('first_found', gitea_variables) }}", "executable": "ansible.builtin.include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather versioning information", "module": "ansible.builtin.include_tasks", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather versioning information"}, "module_options": "set_version.yml", "executable": "set_version.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "backup gitea before update", "module": "ansible.builtin.include_tasks", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "backup gitea before update", "when": "gitea_backup_on_upgrade|bool"}, "module_options": "backup.yml", "executable": "backup.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "create gitea user and role", "module": "ansible.builtin.include_tasks", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "create gitea user and role"}, "module_options": "create_user.yml", "executable": "create_user.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "install or update gitea", "module": "ansible.builtin.include_tasks", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "install or update gitea"}, "module_options": "install.yml", "executable": "install.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create directories", "module": "ansible.builtin.include_tasks", "index": 7, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Create directories"}, "module_options": "directory.yml", "executable": "directory.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup gitea systemd service", "module": "ansible.builtin.include_tasks", "index": 8, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "setup gitea systemd service", "when": "ansible_service_mgr == \"systemd\""}, "module_options": "install_systemd.yml", "executable": "install_systemd.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate JWT Secrets if undefined", "module": "ansible.builtin.include_tasks", "index": 9, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "generate JWT Secrets if undefined"}, "module_options": "jwt_secrets.yml", "executable": "jwt_secrets.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate gitea secrets if undefined", "module": "ansible.builtin.include_tasks", "index": 10, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "generate gitea secrets if undefined"}, "module_options": "gitea_secrets.yml", "executable": "gitea_secrets.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure gitea", "module": "ansible.builtin.include_tasks", "index": 11, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "configure gitea"}, "module_options": "configure.yml", "executable": "configure.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "deploy optional fail2ban rules", "module": "ansible.builtin.include_tasks", "index": 12, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "deploy optional fail2ban rules", "when": "gitea_fail2ban_enabled|bool"}, "module_options": "fail2ban.yml", "executable": "fail2ban.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "optionally customize gitea", "module": "ansible.builtin.include_tasks", "index": 13, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally customize gitea", "when": "gitea_customize_logo|bool"}, "module_options": "customize_logo.yml", "executable": "customize_logo.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "optionally customize footer", "module": "ansible.builtin.include_tasks", "index": 14, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally customize footer", "when": "gitea_customize_footer|bool"}, "module_options": "customize_footer.yml", "executable": "customize_footer.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "optionally deploy public files", "module": "ansible.builtin.include_tasks", "index": 15, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally deploy public files", "when": "gitea_customize_files|bool"}, "module_options": "customize_public_files.yml", "executable": "customize_public_files.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}], "modules": [], "source": "", "annotations": {}, "used_in": []}], "modules": [], "taskfiles": [], "version": "", "module_dict": {}, "task_dict": {"{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Setup systemd service", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "options": {"name": "Setup systemd service", "become": true, "notify": ["Reload systemd", "Restart gitea"]}, "module_options": {"src": "gitea.service.j2", "dest": "/lib/systemd/system/gitea.service", "owner": "root", "group": "root", "mode": 420}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Reload systemd", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "options": {"name": "Reload systemd", "become": true}, "module_options": {"daemon_reload": true}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "generate gitea SECRET_KEY if not provided", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "generate gitea SECRET_KEY if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_secret_key"}, "when": "gitea_secret_key | string | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret SECRET_KEY > /etc/gitea/gitea_secret_key", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "read gitea SECRET_KEY from file", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "read gitea SECRET_KEY from file", "become": true, "register": "remote_secret_key", "when": "gitea_secret_key | string | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_secret_key"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "set fact gitea_secret_key", "module": "ansible.builtin.set_fact", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "set fact gitea_secret_key", "when": "gitea_secret_key | string |  length == 0"}, "module_options": {"gitea_secret_key": "{{ remote_secret_key['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "generate gitea INTERNAL_TOKEN if not provided", "module": "ansible.builtin.shell", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "generate gitea INTERNAL_TOKEN if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_internal_token"}, "when": "gitea_internal_token | string | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret INTERNAL_TOKEN > /etc/gitea/gitea_internal_token", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "read gitea INTERNAL_TOKEN from file", "module": "ansible.builtin.slurp", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "read gitea INTERNAL_TOKEN from file", "become": true, "register": "remote_internal_token", "when": "gitea_internal_token | string | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_internal_token"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "set fact gitea_internal_token", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "set fact gitea_internal_token", "when": "gitea_internal_token | string | length == 0"}, "module_options": {"gitea_internal_token": "{{ remote_internal_token['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Check gitea installed version", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Check gitea installed version", "args": {"executable": "/bin/bash"}, "register": "gitea_active_version", "changed_when": false, "failed_when": false}, "module_options": "set -eo pipefail; /usr/local/bin/gitea -v | cut -d' ' -f 3", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Get latest gitea release metadata", "module": "ansible.builtin.uri", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Get latest gitea release metadata", "register": "gitea_remote_metadata", "when": "not ansible_check_mode"}, "module_options": {"url": "https://api.github.com/repos/go-gitea/gitea/releases/latest", "return_content": true}, "executable": "ansible.builtin.uri", "executable_type": "Module", "fqcn": "ansible.builtin.uri", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "Fail if running in check mode without versions set.", "module": "ansible.builtin.fail", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Fail if running in check mode without versions set.", "when": "ansible_check_mode and ( gitea_version == 'latest' or gitea_version == 'present' )"}, "module_options": {"msg": "\"You are running this playbook in check mode:\nPlease set the Gitea version with the variable 'gitea_version', because the URI module cannot detect the latest version in this mode.\"\n"}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "Set fact latest gitea release", "module": "ansible.builtin.set_fact", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set fact latest gitea release", "when": "not ansible_check_mode"}, "module_options": {"gitea_remote_version": "{{ gitea_remote_metadata.json.tag_name[1:] }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "Set gitea version target (latest)", "module": "ansible.builtin.set_fact", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set gitea version target (latest)", "when": "not ansible_check_mode"}, "module_options": {"gitea_version_target": "{{ gitea_remote_version }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "Set gitea version target ({{ gitea_version }})", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set gitea version target ({{ gitea_version }})", "when": "gitea_version != \"latest\""}, "module_options": {"gitea_version_target": "{{ gitea_version }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "Generate gitea download URL", "module": "ansible.builtin.set_fact", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Generate gitea download URL"}, "module_options": {"gitea_dl_url": "https://github.com/go-gitea/gitea/releases/download/v{{ gitea_version_target }}/gitea-{{ gitea_version_target }}-linux-{{ gitea_arch }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Create directory for versionscheck", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Create directory for versionscheck", "become": true, "when": "submodules_versioncheck|bool"}, "module_options": {"path": "/etc/.ansible-version", "state": "directory", "mode": 493}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "check playbook version", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "check playbook version", "become": true, "register": "playbook_version", "when": "submodules_versioncheck|bool", "ignore_errors": true, "failed_when": false}, "module_options": {"src": "/etc/.ansible-version/{{ playbook_version_path }}"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "Print remote role version", "module": "ansible.builtin.debug", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Print remote role version", "when": "submodules_versioncheck|bool"}, "module_options": {"msg": "Remote role version: {{ playbook_version.content | default('Y3VycmVudGx5IG5vdCBkZXBsb3llZAo=') | b64decode | string }}"}, "executable": "ansible.builtin.debug", "executable_type": "Module", "fqcn": "ansible.builtin.debug", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "Print locale role version", "module": "ansible.builtin.debug", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Print locale role version", "when": "submodules_versioncheck|bool"}, "module_options": {"msg": "Local role version: '{{ playbook_version_number|string }}'."}, "executable": "ansible.builtin.debug", "executable_type": "Module", "fqcn": "ansible.builtin.debug", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "Check if your version is outdated", "module": "ansible.builtin.fail", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Check if your version is outdated", "when": ["playbook_version.content|default(\"Mgo=\")|b64decode|int - 1 >= playbook_version_number|int and submodules_versioncheck|bool"]}, "module_options": {"msg": "Your ansible module has the version '{{ playbook_version_number }}' and is outdated. You need to update it!"}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "write new version to remote disk", "module": "ansible.builtin.copy", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "write new version to remote disk", "become": true, "when": "submodules_versioncheck|bool"}, "module_options": {"content": "{{ playbook_version_number }}", "dest": "/etc/.ansible-version/{{ playbook_version_path }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Configure gitea", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "options": {"name": "Configure gitea", "become": true, "notify": "Restart gitea"}, "module_options": {"src": "gitea.ini.j2", "dest": "/etc/gitea/gitea.ini", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": 384}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Service gitea", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "options": {"name": "Service gitea", "become": true, "when": "ansible_service_mgr == \"systemd\""}, "module_options": {"name": "gitea", "state": "started", "enabled": true}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Install fail2ban filter", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "Install fail2ban filter", "become": true, "notify": "systemctl restart fail2ban", "when": "'fail2ban' in ansible_facts.packages"}, "module_options": {"src": "fail2ban/filter.conf.j2", "dest": "/etc/fail2ban/filter.d/gitea.conf", "owner": "root", "group": "root", "mode": 292}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Install fail2ban jail", "module": "ansible.builtin.template", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "Install fail2ban jail", "become": true, "notify": "systemctl restart fail2ban", "when": "'fail2ban' in ansible_facts.packages"}, "module_options": {"src": "fail2ban/jail.conf.j2", "dest": "/etc/fail2ban/jail.d/gitea.conf", "owner": "root", "group": "root", "mode": 292}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "warn if fail2ban is not installed", "module": "ansible.builtin.fail", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "warn if fail2ban is not installed", "when": "'fail2ban' not in ansible_facts.packages", "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"msg": "the package fail2ban is not installed. no fail2ban filters deployed."}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "create directory for custom footer", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "options": {"name": "create directory for custom footer", "become": true, "with_items": ["{{ gitea_custom }}/templates", "{{ gitea_custom }}/templates/custom"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "transfer custom footer template", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "options": {"name": "transfer custom footer template", "become": true, "ignore_errors": true, "tags": "skip_ansible_lint", "notify": "Restart gitea"}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_footer) }}", "dest": "{{ gitea_custom }}/templates/custom/extra_links_footer.tmpl", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/directory.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Create config and data directory", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/directory.yml", "options": {"name": "Create config and data directory", "become": true, "with_items": ["/etc/gitea", "{{ gitea_home }}", "{{ gitea_home }}/data", "{{ gitea_custom }}", "{{ gitea_custom }}/https", "{{ gitea_custom }}/mailer", "{{ gitea_home }}/indexers", "{{ gitea_home }}/log", "{{ gitea_repository_root }}"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "generate OAuth2 JWT_SECRET if not provided", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "generate OAuth2 JWT_SECRET if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_oauth_jwt_secret"}, "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret JWT_SECRET > /etc/gitea/gitea_oauth_jwt_secret", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "read OAuth2 JWT_SECRET from file", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "read OAuth2 JWT_SECRET from file", "become": true, "register": "oauth_jwt_secret", "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_oauth_jwt_secret"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "set fact gitea_oauth2_jwt_secret", "module": "ansible.builtin.set_fact", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "set fact gitea_oauth2_jwt_secret", "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": {"gitea_oauth2_jwt_secret": "{{ oauth_jwt_secret['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "generate LFS JWT_SECRET if not provided", "module": "ansible.builtin.shell", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "generate LFS JWT_SECRET if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_lfs_jwt_secret"}, "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret JWT_SECRET > /etc/gitea/gitea_lfs_jwt_secret", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "read LFS JWT_SECRET from file", "module": "ansible.builtin.slurp", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "read LFS JWT_SECRET from file", "become": true, "register": "lfs_jwt_secret", "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_lfs_jwt_secret"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "set fact gitea_lfs_jwt_secret", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "set fact gitea_lfs_jwt_secret", "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": {"gitea_lfs_jwt_secret": "{{ lfs_jwt_secret['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "create directory for custom logos", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "create directory for custom logos", "become": true, "with_items": ["{{ gitea_custom }}/public", "{{ gitea_custom }}/public/img"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "transfer custom logo.svg", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom logo.svg", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_logosvg) }}", "dest": "{{ gitea_custom }}/public/img/logo.svg", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "transfer custom logo.png", "module": "ansible.builtin.copy", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom logo.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_logopng) }}", "dest": "{{ gitea_custom }}/public/img/logo.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "transfer custom favicon.png", "module": "ansible.builtin.copy", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom favicon.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_faviconpng) }}", "dest": "{{ gitea_custom }}/public/img/favicon.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "transfer custom apple-touch-icon.png", "module": "ansible.builtin.copy", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom apple-touch-icon.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_appletouchiconpng) }}", "dest": "{{ gitea_custom }}/public/img/apple-touch-icon.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "create public directory for custom public web files", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "options": {"name": "create public directory for custom public web files", "become": true, "with_items": ["{{ gitea_custom }}/public"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "transfer custom public web data", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "options": {"name": "transfer custom public web data", "become": true, "ignore_errors": true, "tags": "skip_ansible_lint", "notify": "Restart gitea"}, "module_options": {"src": "{{ gitea_customize_files_path }}", "dest": "{{ gitea_custom }}/public/", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "directory_mode": true, "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Get service facts", "module": "ansible.builtin.service_facts", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Get service facts"}, "module_options": null, "executable": "ansible.builtin.service_facts", "executable_type": "Module", "fqcn": "ansible.builtin.service_facts", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Stopping gitea before upgrade", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Stopping gitea before upgrade", "become": true, "when": "ansible_service_mgr == \"systemd\""}, "module_options": {"name": "gitea", "state": "stopped"}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "Create backup directory", "module": "ansible.builtin.file", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Create backup directory", "become": true, "with_items": ["{{ gitea_backup_location }}"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwx,g=rx,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "Backing up gitea before upgrade", "module": "ansible.builtin.command", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Backing up gitea before upgrade", "become": true, "changed_when": true}, "module_options": {"cmd": "sudo -u {{ gitea_user }} /usr/local/bin/gitea dump -c /etc/gitea/gitea.ini", "chdir": "{{ gitea_backup_location }}"}, "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Create Gitea Group", "module": "ansible.builtin.group", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Create Gitea Group", "become": true}, "module_options": {"name": "{{ gitea_group }}", "system": true, "state": "present"}, "executable": "ansible.builtin.group", "executable_type": "Module", "fqcn": "ansible.builtin.group", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Switch shell when not using the builtin ssh server", "module": "ansible.builtin.set_fact", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Switch shell when not using the builtin ssh server", "when": "not gitea_start_ssh and gitea_shell == '/bin/false'"}, "module_options": {"gitea_shell": "/bin/bash"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "Create Gitea user", "module": "ansible.builtin.user", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Create Gitea user", "become": true}, "module_options": {"name": "{{ gitea_user }}", "comment": "Gitea user", "group": "{{ gitea_group }}", "groups": "{{ gitea_groups | default(omit) }}", "home": "{{ gitea_home }}", "shell": "{{ gitea_shell }}", "system": true}, "executable": "ansible.builtin.user", "executable_type": "Module", "fqcn": "ansible.builtin.user", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Update apt cache", "module": "ansible.builtin.apt", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Update apt cache", "become": true, "register": "_pre_update_apt_cache", "until": "_pre_update_apt_cache is succeeded", "when": ["ansible_pkg_mgr == \"apt\""]}, "module_options": {"cache_valid_time": 3600, "update_cache": true}, "executable": "ansible.builtin.apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Install dependencies", "module": "ansible.builtin.package", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Install dependencies", "become": true, "register": "_install_dep_packages", "until": "_install_dep_packages is succeeded", "retries": 5, "delay": 2}, "module_options": {"name": "{{ gitea_dependencies }}", "state": "present"}, "executable": "ansible.builtin.package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "Download gitea archive", "module": "ansible.builtin.get_url", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Download gitea archive", "register": "_download_archive", "until": "_download_archive is succeeded", "retries": 5, "delay": 2}, "module_options": {"url": "{{ gitea_dl_url }}.xz", "dest": "/tmp/{{ gitea_filename }}.xz", "checksum": "sha256:{{ gitea_dl_url }}.xz.sha256", "mode": 416}, "executable": "ansible.builtin.get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "Download gitea asc file", "module": "ansible.builtin.get_url", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Download gitea asc file", "register": "_download_asc", "until": "_download_asc is succeeded", "retries": 5, "delay": 2}, "module_options": {"url": "{{ gitea_dl_url }}.xz.asc", "dest": "/tmp/{{ gitea_filename }}.xz.asc", "mode": 416}, "executable": "ansible.builtin.get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "Check gitea gpg key", "module": "ansible.builtin.command", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Check gitea gpg key", "register": "_gitea_gpg_key_status", "changed_when": false, "failed_when": "_gitea_gpg_key_status.rc not in (0, 2)"}, "module_options": "gpg --list-keys 0x{{ gitea_gpg_key }}", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "Import gitea gpg key", "module": "ansible.builtin.command", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Import gitea gpg key", "register": "_gitea_import_key", "changed_when": "\"imported: 1\" in _gitea_import_key.stderr", "when": "_gitea_gpg_key_status.rc != 0"}, "module_options": "gpg --keyserver {{ gitea_gpg_server }} --recv {{ gitea_gpg_key }}", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "Check archive signature", "module": "ansible.builtin.command", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Check archive signature", "changed_when": false}, "module_options": "gpg --verify /tmp/{{ gitea_filename }}.xz.asc /tmp/{{ gitea_filename }}.xz", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml\", \"index\": 7}": {"py/object": "struct4.Task", "name": "Unpack gitea binary", "module": "ansible.builtin.command", "index": 7, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Unpack gitea binary"}, "module_options": {"cmd": "xz -k -d /tmp/{{ gitea_filename }}.xz", "creates": "/tmp/{{ gitea_filename }}"}, "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml\", \"index\": 8}": {"py/object": "struct4.Task", "name": "Propagate gitea binary", "module": "ansible.builtin.copy", "index": 8, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Propagate gitea binary", "become": true, "notify": "Restart gitea"}, "module_options": {"src": "/tmp/{{ gitea_filename }}", "remote_src": true, "dest": "/usr/local/bin/gitea", "mode": 493, "owner": "root", "group": "root"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "perform optional versionscheck", "module": "ansible.builtin.include_tasks", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "perform optional versionscheck", "when": "submodules_versioncheck|bool"}, "module_options": "versioncheck.yml", "executable": "versioncheck.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Gather installed packages for checks later on", "module": "ansible.builtin.package_facts", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather installed packages for checks later on"}, "module_options": {"manager": "auto"}, "executable": "ansible.builtin.package_facts", "executable_type": "Module", "fqcn": "ansible.builtin.package_facts", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "Gather variables for each operating system", "module": "ansible.builtin.include_vars", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather variables for each operating system"}, "module_options": "{{ lookup('first_found', gitea_variables) }}", "executable": "ansible.builtin.include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "Gather versioning information", "module": "ansible.builtin.include_tasks", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather versioning information"}, "module_options": "set_version.yml", "executable": "set_version.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "backup gitea before update", "module": "ansible.builtin.include_tasks", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "backup gitea before update", "when": "gitea_backup_on_upgrade|bool"}, "module_options": "backup.yml", "executable": "backup.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "create gitea user and role", "module": "ansible.builtin.include_tasks", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "create gitea user and role"}, "module_options": "create_user.yml", "executable": "create_user.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "install or update gitea", "module": "ansible.builtin.include_tasks", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "install or update gitea"}, "module_options": "install.yml", "executable": "install.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 7}": {"py/object": "struct4.Task", "name": "Create directories", "module": "ansible.builtin.include_tasks", "index": 7, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Create directories"}, "module_options": "directory.yml", "executable": "directory.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 8}": {"py/object": "struct4.Task", "name": "setup gitea systemd service", "module": "ansible.builtin.include_tasks", "index": 8, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "setup gitea systemd service", "when": "ansible_service_mgr == \"systemd\""}, "module_options": "install_systemd.yml", "executable": "install_systemd.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 9}": {"py/object": "struct4.Task", "name": "generate JWT Secrets if undefined", "module": "ansible.builtin.include_tasks", "index": 9, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "generate JWT Secrets if undefined"}, "module_options": "jwt_secrets.yml", "executable": "jwt_secrets.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 10}": {"py/object": "struct4.Task", "name": "generate gitea secrets if undefined", "module": "ansible.builtin.include_tasks", "index": 10, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "generate gitea secrets if undefined"}, "module_options": "gitea_secrets.yml", "executable": "gitea_secrets.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 11}": {"py/object": "struct4.Task", "name": "configure gitea", "module": "ansible.builtin.include_tasks", "index": 11, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "configure gitea"}, "module_options": "configure.yml", "executable": "configure.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 12}": {"py/object": "struct4.Task", "name": "deploy optional fail2ban rules", "module": "ansible.builtin.include_tasks", "index": 12, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "deploy optional fail2ban rules", "when": "gitea_fail2ban_enabled|bool"}, "module_options": "fail2ban.yml", "executable": "fail2ban.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 13}": {"py/object": "struct4.Task", "name": "optionally customize gitea", "module": "ansible.builtin.include_tasks", "index": 13, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally customize gitea", "when": "gitea_customize_logo|bool"}, "module_options": "customize_logo.yml", "executable": "customize_logo.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 14}": {"py/object": "struct4.Task", "name": "optionally customize footer", "module": "ansible.builtin.include_tasks", "index": 14, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally customize footer", "when": "gitea_customize_footer|bool"}, "module_options": "customize_footer.yml", "executable": "customize_footer.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml\", \"index\": 15}": {"py/object": "struct4.Task", "name": "optionally deploy public files", "module": "ansible.builtin.include_tasks", "index": 15, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally deploy public files", "when": "gitea_customize_files|bool"}, "module_options": "customize_public_files.yml", "executable": "customize_public_files.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}}, "taskfile_dict": {"./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml": {"py/object": "struct4.TaskFile", "name": "install_systemd.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "tasks": [{"py/object": "struct4.Task", "name": "Setup systemd service", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "options": {"name": "Setup systemd service", "become": true, "notify": ["Reload systemd", "Restart gitea"]}, "module_options": {"src": "gitea.service.j2", "dest": "/lib/systemd/system/gitea.service", "owner": "root", "group": "root", "mode": 420}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Reload systemd", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "options": {"name": "Reload systemd", "become": true}, "module_options": {"daemon_reload": true}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml": {"py/object": "struct4.TaskFile", "name": "gitea_secrets.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "tasks": [{"py/object": "struct4.Task", "name": "generate gitea SECRET_KEY if not provided", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "generate gitea SECRET_KEY if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_secret_key"}, "when": "gitea_secret_key | string | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret SECRET_KEY > /etc/gitea/gitea_secret_key", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read gitea SECRET_KEY from file", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "read gitea SECRET_KEY from file", "become": true, "register": "remote_secret_key", "when": "gitea_secret_key | string | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_secret_key"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_secret_key", "module": "ansible.builtin.set_fact", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "set fact gitea_secret_key", "when": "gitea_secret_key | string |  length == 0"}, "module_options": {"gitea_secret_key": "{{ remote_secret_key['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate gitea INTERNAL_TOKEN if not provided", "module": "ansible.builtin.shell", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "generate gitea INTERNAL_TOKEN if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_internal_token"}, "when": "gitea_internal_token | string | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret INTERNAL_TOKEN > /etc/gitea/gitea_internal_token", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read gitea INTERNAL_TOKEN from file", "module": "ansible.builtin.slurp", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "read gitea INTERNAL_TOKEN from file", "become": true, "register": "remote_internal_token", "when": "gitea_internal_token | string | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_internal_token"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_internal_token", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "set fact gitea_internal_token", "when": "gitea_internal_token | string | length == 0"}, "module_options": {"gitea_internal_token": "{{ remote_internal_token['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml": {"py/object": "struct4.TaskFile", "name": "set_version.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "tasks": [{"py/object": "struct4.Task", "name": "Check gitea installed version", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Check gitea installed version", "args": {"executable": "/bin/bash"}, "register": "gitea_active_version", "changed_when": false, "failed_when": false}, "module_options": "set -eo pipefail; /usr/local/bin/gitea -v | cut -d' ' -f 3", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "Get latest gitea release metadata", "module": "ansible.builtin.uri", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Get latest gitea release metadata", "register": "gitea_remote_metadata", "when": "not ansible_check_mode"}, "module_options": {"url": "https://api.github.com/repos/go-gitea/gitea/releases/latest", "return_content": true}, "executable": "ansible.builtin.uri", "executable_type": "Module", "fqcn": "ansible.builtin.uri", "annotations": {}}, {"py/object": "struct4.Task", "name": "Fail if running in check mode without versions set.", "module": "ansible.builtin.fail", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Fail if running in check mode without versions set.", "when": "ansible_check_mode and ( gitea_version == 'latest' or gitea_version == 'present' )"}, "module_options": {"msg": "\"You are running this playbook in check mode:\nPlease set the Gitea version with the variable 'gitea_version', because the URI module cannot detect the latest version in this mode.\"\n"}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set fact latest gitea release", "module": "ansible.builtin.set_fact", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set fact latest gitea release", "when": "not ansible_check_mode"}, "module_options": {"gitea_remote_version": "{{ gitea_remote_metadata.json.tag_name[1:] }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set gitea version target (latest)", "module": "ansible.builtin.set_fact", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set gitea version target (latest)", "when": "not ansible_check_mode"}, "module_options": {"gitea_version_target": "{{ gitea_remote_version }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set gitea version target ({{ gitea_version }})", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set gitea version target ({{ gitea_version }})", "when": "gitea_version != \"latest\""}, "module_options": {"gitea_version_target": "{{ gitea_version }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Generate gitea download URL", "module": "ansible.builtin.set_fact", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Generate gitea download URL"}, "module_options": {"gitea_dl_url": "https://github.com/go-gitea/gitea/releases/download/v{{ gitea_version_target }}/gitea-{{ gitea_version_target }}-linux-{{ gitea_arch }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml": {"py/object": "struct4.TaskFile", "name": "versioncheck.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "tasks": [{"py/object": "struct4.Task", "name": "Create directory for versionscheck", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Create directory for versionscheck", "become": true, "when": "submodules_versioncheck|bool"}, "module_options": {"path": "/etc/.ansible-version", "state": "directory", "mode": 493}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "check playbook version", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "check playbook version", "become": true, "register": "playbook_version", "when": "submodules_versioncheck|bool", "ignore_errors": true, "failed_when": false}, "module_options": {"src": "/etc/.ansible-version/{{ playbook_version_path }}"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "Print remote role version", "module": "ansible.builtin.debug", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Print remote role version", "when": "submodules_versioncheck|bool"}, "module_options": {"msg": "Remote role version: {{ playbook_version.content | default('Y3VycmVudGx5IG5vdCBkZXBsb3llZAo=') | b64decode | string }}"}, "executable": "ansible.builtin.debug", "executable_type": "Module", "fqcn": "ansible.builtin.debug", "annotations": {}}, {"py/object": "struct4.Task", "name": "Print locale role version", "module": "ansible.builtin.debug", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Print locale role version", "when": "submodules_versioncheck|bool"}, "module_options": {"msg": "Local role version: '{{ playbook_version_number|string }}'."}, "executable": "ansible.builtin.debug", "executable_type": "Module", "fqcn": "ansible.builtin.debug", "annotations": {}}, {"py/object": "struct4.Task", "name": "Check if your version is outdated", "module": "ansible.builtin.fail", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Check if your version is outdated", "when": ["playbook_version.content|default(\"Mgo=\")|b64decode|int - 1 >= playbook_version_number|int and submodules_versioncheck|bool"]}, "module_options": {"msg": "Your ansible module has the version '{{ playbook_version_number }}' and is outdated. You need to update it!"}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, {"py/object": "struct4.Task", "name": "write new version to remote disk", "module": "ansible.builtin.copy", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "write new version to remote disk", "become": true, "when": "submodules_versioncheck|bool"}, "module_options": {"content": "{{ playbook_version_number }}", "dest": "/etc/.ansible-version/{{ playbook_version_path }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml": {"py/object": "struct4.TaskFile", "name": "configure.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "tasks": [{"py/object": "struct4.Task", "name": "Configure gitea", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "options": {"name": "Configure gitea", "become": true, "notify": "Restart gitea"}, "module_options": {"src": "gitea.ini.j2", "dest": "/etc/gitea/gitea.ini", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": 384}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Service gitea", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "options": {"name": "Service gitea", "become": true, "when": "ansible_service_mgr == \"systemd\""}, "module_options": {"name": "gitea", "state": "started", "enabled": true}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml": {"py/object": "struct4.TaskFile", "name": "fail2ban.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "tasks": [{"py/object": "struct4.Task", "name": "Install fail2ban filter", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "Install fail2ban filter", "become": true, "notify": "systemctl restart fail2ban", "when": "'fail2ban' in ansible_facts.packages"}, "module_options": {"src": "fail2ban/filter.conf.j2", "dest": "/etc/fail2ban/filter.d/gitea.conf", "owner": "root", "group": "root", "mode": 292}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install fail2ban jail", "module": "ansible.builtin.template", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "Install fail2ban jail", "become": true, "notify": "systemctl restart fail2ban", "when": "'fail2ban' in ansible_facts.packages"}, "module_options": {"src": "fail2ban/jail.conf.j2", "dest": "/etc/fail2ban/jail.d/gitea.conf", "owner": "root", "group": "root", "mode": 292}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "warn if fail2ban is not installed", "module": "ansible.builtin.fail", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "warn if fail2ban is not installed", "when": "'fail2ban' not in ansible_facts.packages", "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"msg": "the package fail2ban is not installed. no fail2ban filters deployed."}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml": {"py/object": "struct4.TaskFile", "name": "customize_footer.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "tasks": [{"py/object": "struct4.Task", "name": "create directory for custom footer", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "options": {"name": "create directory for custom footer", "become": true, "with_items": ["{{ gitea_custom }}/templates", "{{ gitea_custom }}/templates/custom"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom footer template", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "options": {"name": "transfer custom footer template", "become": true, "ignore_errors": true, "tags": "skip_ansible_lint", "notify": "Restart gitea"}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_footer) }}", "dest": "{{ gitea_custom }}/templates/custom/extra_links_footer.tmpl", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/directory.yml": {"py/object": "struct4.TaskFile", "name": "directory.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/directory.yml", "tasks": [{"py/object": "struct4.Task", "name": "Create config and data directory", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/directory.yml", "options": {"name": "Create config and data directory", "become": true, "with_items": ["/etc/gitea", "{{ gitea_home }}", "{{ gitea_home }}/data", "{{ gitea_custom }}", "{{ gitea_custom }}/https", "{{ gitea_custom }}/mailer", "{{ gitea_home }}/indexers", "{{ gitea_home }}/log", "{{ gitea_repository_root }}"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml": {"py/object": "struct4.TaskFile", "name": "jwt_secrets.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "tasks": [{"py/object": "struct4.Task", "name": "generate OAuth2 JWT_SECRET if not provided", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "generate OAuth2 JWT_SECRET if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_oauth_jwt_secret"}, "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret JWT_SECRET > /etc/gitea/gitea_oauth_jwt_secret", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read OAuth2 JWT_SECRET from file", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "read OAuth2 JWT_SECRET from file", "become": true, "register": "oauth_jwt_secret", "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_oauth_jwt_secret"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_oauth2_jwt_secret", "module": "ansible.builtin.set_fact", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "set fact gitea_oauth2_jwt_secret", "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": {"gitea_oauth2_jwt_secret": "{{ oauth_jwt_secret['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate LFS JWT_SECRET if not provided", "module": "ansible.builtin.shell", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "generate LFS JWT_SECRET if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_lfs_jwt_secret"}, "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret JWT_SECRET > /etc/gitea/gitea_lfs_jwt_secret", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read LFS JWT_SECRET from file", "module": "ansible.builtin.slurp", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "read LFS JWT_SECRET from file", "become": true, "register": "lfs_jwt_secret", "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_lfs_jwt_secret"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_lfs_jwt_secret", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "set fact gitea_lfs_jwt_secret", "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": {"gitea_lfs_jwt_secret": "{{ lfs_jwt_secret['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml": {"py/object": "struct4.TaskFile", "name": "customize_logo.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "tasks": [{"py/object": "struct4.Task", "name": "create directory for custom logos", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "create directory for custom logos", "become": true, "with_items": ["{{ gitea_custom }}/public", "{{ gitea_custom }}/public/img"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom logo.svg", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom logo.svg", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_logosvg) }}", "dest": "{{ gitea_custom }}/public/img/logo.svg", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom logo.png", "module": "ansible.builtin.copy", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom logo.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_logopng) }}", "dest": "{{ gitea_custom }}/public/img/logo.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom favicon.png", "module": "ansible.builtin.copy", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom favicon.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_faviconpng) }}", "dest": "{{ gitea_custom }}/public/img/favicon.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom apple-touch-icon.png", "module": "ansible.builtin.copy", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom apple-touch-icon.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_appletouchiconpng) }}", "dest": "{{ gitea_custom }}/public/img/apple-touch-icon.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml": {"py/object": "struct4.TaskFile", "name": "customize_public_files.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "tasks": [{"py/object": "struct4.Task", "name": "create public directory for custom public web files", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "options": {"name": "create public directory for custom public web files", "become": true, "with_items": ["{{ gitea_custom }}/public"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom public web data", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "options": {"name": "transfer custom public web data", "become": true, "ignore_errors": true, "tags": "skip_ansible_lint", "notify": "Restart gitea"}, "module_options": {"src": "{{ gitea_customize_files_path }}", "dest": "{{ gitea_custom }}/public/", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "directory_mode": true, "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml": {"py/object": "struct4.TaskFile", "name": "backup.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "tasks": [{"py/object": "struct4.Task", "name": "Get service facts", "module": "ansible.builtin.service_facts", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Get service facts"}, "module_options": null, "executable": "ansible.builtin.service_facts", "executable_type": "Module", "fqcn": "ansible.builtin.service_facts", "annotations": {}}, {"py/object": "struct4.Task", "name": "Stopping gitea before upgrade", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Stopping gitea before upgrade", "become": true, "when": "ansible_service_mgr == \"systemd\""}, "module_options": {"name": "gitea", "state": "stopped"}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create backup directory", "module": "ansible.builtin.file", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Create backup directory", "become": true, "with_items": ["{{ gitea_backup_location }}"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwx,g=rx,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "Backing up gitea before upgrade", "module": "ansible.builtin.command", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Backing up gitea before upgrade", "become": true, "changed_when": true}, "module_options": {"cmd": "sudo -u {{ gitea_user }} /usr/local/bin/gitea dump -c /etc/gitea/gitea.ini", "chdir": "{{ gitea_backup_location }}"}, "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml": {"py/object": "struct4.TaskFile", "name": "create_user.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "tasks": [{"py/object": "struct4.Task", "name": "Create Gitea Group", "module": "ansible.builtin.group", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Create Gitea Group", "become": true}, "module_options": {"name": "{{ gitea_group }}", "system": true, "state": "present"}, "executable": "ansible.builtin.group", "executable_type": "Module", "fqcn": "ansible.builtin.group", "annotations": {}}, {"py/object": "struct4.Task", "name": "Switch shell when not using the builtin ssh server", "module": "ansible.builtin.set_fact", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Switch shell when not using the builtin ssh server", "when": "not gitea_start_ssh and gitea_shell == '/bin/false'"}, "module_options": {"gitea_shell": "/bin/bash"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create Gitea user", "module": "ansible.builtin.user", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Create Gitea user", "become": true}, "module_options": {"name": "{{ gitea_user }}", "comment": "Gitea user", "group": "{{ gitea_group }}", "groups": "{{ gitea_groups | default(omit) }}", "home": "{{ gitea_home }}", "shell": "{{ gitea_shell }}", "system": true}, "executable": "ansible.builtin.user", "executable_type": "Module", "fqcn": "ansible.builtin.user", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml": {"py/object": "struct4.TaskFile", "name": "install.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "tasks": [{"py/object": "struct4.Task", "name": "Update apt cache", "module": "ansible.builtin.apt", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Update apt cache", "become": true, "register": "_pre_update_apt_cache", "until": "_pre_update_apt_cache is succeeded", "when": ["ansible_pkg_mgr == \"apt\""]}, "module_options": {"cache_valid_time": 3600, "update_cache": true}, "executable": "ansible.builtin.apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install dependencies", "module": "ansible.builtin.package", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Install dependencies", "become": true, "register": "_install_dep_packages", "until": "_install_dep_packages is succeeded", "retries": 5, "delay": 2}, "module_options": {"name": "{{ gitea_dependencies }}", "state": "present"}, "executable": "ansible.builtin.package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Download gitea archive", "module": "ansible.builtin.get_url", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Download gitea archive", "register": "_download_archive", "until": "_download_archive is succeeded", "retries": 5, "delay": 2}, "module_options": {"url": "{{ gitea_dl_url }}.xz", "dest": "/tmp/{{ gitea_filename }}.xz", "checksum": "sha256:{{ gitea_dl_url }}.xz.sha256", "mode": 416}, "executable": "ansible.builtin.get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "Download gitea asc file", "module": "ansible.builtin.get_url", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Download gitea asc file", "register": "_download_asc", "until": "_download_asc is succeeded", "retries": 5, "delay": 2}, "module_options": {"url": "{{ gitea_dl_url }}.xz.asc", "dest": "/tmp/{{ gitea_filename }}.xz.asc", "mode": 416}, "executable": "ansible.builtin.get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "Check gitea gpg key", "module": "ansible.builtin.command", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Check gitea gpg key", "register": "_gitea_gpg_key_status", "changed_when": false, "failed_when": "_gitea_gpg_key_status.rc not in (0, 2)"}, "module_options": "gpg --list-keys 0x{{ gitea_gpg_key }}", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Import gitea gpg key", "module": "ansible.builtin.command", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Import gitea gpg key", "register": "_gitea_import_key", "changed_when": "\"imported: 1\" in _gitea_import_key.stderr", "when": "_gitea_gpg_key_status.rc != 0"}, "module_options": "gpg --keyserver {{ gitea_gpg_server }} --recv {{ gitea_gpg_key }}", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Check archive signature", "module": "ansible.builtin.command", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Check archive signature", "changed_when": false}, "module_options": "gpg --verify /tmp/{{ gitea_filename }}.xz.asc /tmp/{{ gitea_filename }}.xz", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Unpack gitea binary", "module": "ansible.builtin.command", "index": 7, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Unpack gitea binary"}, "module_options": {"cmd": "xz -k -d /tmp/{{ gitea_filename }}.xz", "creates": "/tmp/{{ gitea_filename }}"}, "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Propagate gitea binary", "module": "ansible.builtin.copy", "index": 8, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Propagate gitea binary", "become": true, "notify": "Restart gitea"}, "module_options": {"src": "/tmp/{{ gitea_filename }}", "remote_src": true, "dest": "/usr/local/bin/gitea", "mode": 493, "owner": "root", "group": "root"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml": {"py/object": "struct4.TaskFile", "name": "main.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "tasks": [{"py/object": "struct4.Task", "name": "perform optional versionscheck", "module": "ansible.builtin.include_tasks", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "perform optional versionscheck", "when": "submodules_versioncheck|bool"}, "module_options": "versioncheck.yml", "executable": "versioncheck.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather installed packages for checks later on", "module": "ansible.builtin.package_facts", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather installed packages for checks later on"}, "module_options": {"manager": "auto"}, "executable": "ansible.builtin.package_facts", "executable_type": "Module", "fqcn": "ansible.builtin.package_facts", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather variables for each operating system", "module": "ansible.builtin.include_vars", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather variables for each operating system"}, "module_options": "{{ lookup('first_found', gitea_variables) }}", "executable": "ansible.builtin.include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather versioning information", "module": "ansible.builtin.include_tasks", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather versioning information"}, "module_options": "set_version.yml", "executable": "set_version.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "backup gitea before update", "module": "ansible.builtin.include_tasks", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "backup gitea before update", "when": "gitea_backup_on_upgrade|bool"}, "module_options": "backup.yml", "executable": "backup.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "create gitea user and role", "module": "ansible.builtin.include_tasks", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "create gitea user and role"}, "module_options": "create_user.yml", "executable": "create_user.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "install or update gitea", "module": "ansible.builtin.include_tasks", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "install or update gitea"}, "module_options": "install.yml", "executable": "install.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create directories", "module": "ansible.builtin.include_tasks", "index": 7, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Create directories"}, "module_options": "directory.yml", "executable": "directory.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup gitea systemd service", "module": "ansible.builtin.include_tasks", "index": 8, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "setup gitea systemd service", "when": "ansible_service_mgr == \"systemd\""}, "module_options": "install_systemd.yml", "executable": "install_systemd.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate JWT Secrets if undefined", "module": "ansible.builtin.include_tasks", "index": 9, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "generate JWT Secrets if undefined"}, "module_options": "jwt_secrets.yml", "executable": "jwt_secrets.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate gitea secrets if undefined", "module": "ansible.builtin.include_tasks", "index": 10, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "generate gitea secrets if undefined"}, "module_options": "gitea_secrets.yml", "executable": "gitea_secrets.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure gitea", "module": "ansible.builtin.include_tasks", "index": 11, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "configure gitea"}, "module_options": "configure.yml", "executable": "configure.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "deploy optional fail2ban rules", "module": "ansible.builtin.include_tasks", "index": 12, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "deploy optional fail2ban rules", "when": "gitea_fail2ban_enabled|bool"}, "module_options": "fail2ban.yml", "executable": "fail2ban.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "optionally customize gitea", "module": "ansible.builtin.include_tasks", "index": 13, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally customize gitea", "when": "gitea_customize_logo|bool"}, "module_options": "customize_logo.yml", "executable": "customize_logo.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "optionally customize footer", "module": "ansible.builtin.include_tasks", "index": 14, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally customize footer", "when": "gitea_customize_footer|bool"}, "module_options": "customize_footer.yml", "executable": "customize_footer.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "optionally deploy public files", "module": "ansible.builtin.include_tasks", "index": 15, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally deploy public files", "when": "gitea_customize_files|bool"}, "module_options": "customize_public_files.yml", "executable": "customize_public_files.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}}, "role_dict": {"do1jlr.gitea": {"py/object": "struct4.Role", "name": "do1jlr.gitea", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea", "fqcn": "do1jlr.gitea", "collection": "", "taskfiles": [{"py/object": "struct4.TaskFile", "name": "install_systemd.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "tasks": [{"py/object": "struct4.Task", "name": "Setup systemd service", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "options": {"name": "Setup systemd service", "become": true, "notify": ["Reload systemd", "Restart gitea"]}, "module_options": {"src": "gitea.service.j2", "dest": "/lib/systemd/system/gitea.service", "owner": "root", "group": "root", "mode": 420}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Reload systemd", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install_systemd.yml", "options": {"name": "Reload systemd", "become": true}, "module_options": {"daemon_reload": true}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "gitea_secrets.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "tasks": [{"py/object": "struct4.Task", "name": "generate gitea SECRET_KEY if not provided", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "generate gitea SECRET_KEY if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_secret_key"}, "when": "gitea_secret_key | string | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret SECRET_KEY > /etc/gitea/gitea_secret_key", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read gitea SECRET_KEY from file", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "read gitea SECRET_KEY from file", "become": true, "register": "remote_secret_key", "when": "gitea_secret_key | string | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_secret_key"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_secret_key", "module": "ansible.builtin.set_fact", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "set fact gitea_secret_key", "when": "gitea_secret_key | string |  length == 0"}, "module_options": {"gitea_secret_key": "{{ remote_secret_key['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate gitea INTERNAL_TOKEN if not provided", "module": "ansible.builtin.shell", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "generate gitea INTERNAL_TOKEN if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_internal_token"}, "when": "gitea_internal_token | string | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret INTERNAL_TOKEN > /etc/gitea/gitea_internal_token", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read gitea INTERNAL_TOKEN from file", "module": "ansible.builtin.slurp", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "read gitea INTERNAL_TOKEN from file", "become": true, "register": "remote_internal_token", "when": "gitea_internal_token | string | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_internal_token"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_internal_token", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/gitea_secrets.yml", "options": {"name": "set fact gitea_internal_token", "when": "gitea_internal_token | string | length == 0"}, "module_options": {"gitea_internal_token": "{{ remote_internal_token['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "set_version.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "tasks": [{"py/object": "struct4.Task", "name": "Check gitea installed version", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Check gitea installed version", "args": {"executable": "/bin/bash"}, "register": "gitea_active_version", "changed_when": false, "failed_when": false}, "module_options": "set -eo pipefail; /usr/local/bin/gitea -v | cut -d' ' -f 3", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "Get latest gitea release metadata", "module": "ansible.builtin.uri", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Get latest gitea release metadata", "register": "gitea_remote_metadata", "when": "not ansible_check_mode"}, "module_options": {"url": "https://api.github.com/repos/go-gitea/gitea/releases/latest", "return_content": true}, "executable": "ansible.builtin.uri", "executable_type": "Module", "fqcn": "ansible.builtin.uri", "annotations": {}}, {"py/object": "struct4.Task", "name": "Fail if running in check mode without versions set.", "module": "ansible.builtin.fail", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Fail if running in check mode without versions set.", "when": "ansible_check_mode and ( gitea_version == 'latest' or gitea_version == 'present' )"}, "module_options": {"msg": "\"You are running this playbook in check mode:\nPlease set the Gitea version with the variable 'gitea_version', because the URI module cannot detect the latest version in this mode.\"\n"}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set fact latest gitea release", "module": "ansible.builtin.set_fact", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set fact latest gitea release", "when": "not ansible_check_mode"}, "module_options": {"gitea_remote_version": "{{ gitea_remote_metadata.json.tag_name[1:] }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set gitea version target (latest)", "module": "ansible.builtin.set_fact", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set gitea version target (latest)", "when": "not ansible_check_mode"}, "module_options": {"gitea_version_target": "{{ gitea_remote_version }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set gitea version target ({{ gitea_version }})", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Set gitea version target ({{ gitea_version }})", "when": "gitea_version != \"latest\""}, "module_options": {"gitea_version_target": "{{ gitea_version }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Generate gitea download URL", "module": "ansible.builtin.set_fact", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/set_version.yml", "options": {"name": "Generate gitea download URL"}, "module_options": {"gitea_dl_url": "https://github.com/go-gitea/gitea/releases/download/v{{ gitea_version_target }}/gitea-{{ gitea_version_target }}-linux-{{ gitea_arch }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "versioncheck.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "tasks": [{"py/object": "struct4.Task", "name": "Create directory for versionscheck", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Create directory for versionscheck", "become": true, "when": "submodules_versioncheck|bool"}, "module_options": {"path": "/etc/.ansible-version", "state": "directory", "mode": 493}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "check playbook version", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "check playbook version", "become": true, "register": "playbook_version", "when": "submodules_versioncheck|bool", "ignore_errors": true, "failed_when": false}, "module_options": {"src": "/etc/.ansible-version/{{ playbook_version_path }}"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "Print remote role version", "module": "ansible.builtin.debug", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Print remote role version", "when": "submodules_versioncheck|bool"}, "module_options": {"msg": "Remote role version: {{ playbook_version.content | default('Y3VycmVudGx5IG5vdCBkZXBsb3llZAo=') | b64decode | string }}"}, "executable": "ansible.builtin.debug", "executable_type": "Module", "fqcn": "ansible.builtin.debug", "annotations": {}}, {"py/object": "struct4.Task", "name": "Print locale role version", "module": "ansible.builtin.debug", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Print locale role version", "when": "submodules_versioncheck|bool"}, "module_options": {"msg": "Local role version: '{{ playbook_version_number|string }}'."}, "executable": "ansible.builtin.debug", "executable_type": "Module", "fqcn": "ansible.builtin.debug", "annotations": {}}, {"py/object": "struct4.Task", "name": "Check if your version is outdated", "module": "ansible.builtin.fail", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "Check if your version is outdated", "when": ["playbook_version.content|default(\"Mgo=\")|b64decode|int - 1 >= playbook_version_number|int and submodules_versioncheck|bool"]}, "module_options": {"msg": "Your ansible module has the version '{{ playbook_version_number }}' and is outdated. You need to update it!"}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, {"py/object": "struct4.Task", "name": "write new version to remote disk", "module": "ansible.builtin.copy", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/versioncheck.yml", "options": {"name": "write new version to remote disk", "become": true, "when": "submodules_versioncheck|bool"}, "module_options": {"content": "{{ playbook_version_number }}", "dest": "/etc/.ansible-version/{{ playbook_version_path }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "configure.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "tasks": [{"py/object": "struct4.Task", "name": "Configure gitea", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "options": {"name": "Configure gitea", "become": true, "notify": "Restart gitea"}, "module_options": {"src": "gitea.ini.j2", "dest": "/etc/gitea/gitea.ini", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": 384}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Service gitea", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/configure.yml", "options": {"name": "Service gitea", "become": true, "when": "ansible_service_mgr == \"systemd\""}, "module_options": {"name": "gitea", "state": "started", "enabled": true}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "fail2ban.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "tasks": [{"py/object": "struct4.Task", "name": "Install fail2ban filter", "module": "ansible.builtin.template", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "Install fail2ban filter", "become": true, "notify": "systemctl restart fail2ban", "when": "'fail2ban' in ansible_facts.packages"}, "module_options": {"src": "fail2ban/filter.conf.j2", "dest": "/etc/fail2ban/filter.d/gitea.conf", "owner": "root", "group": "root", "mode": 292}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install fail2ban jail", "module": "ansible.builtin.template", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "Install fail2ban jail", "become": true, "notify": "systemctl restart fail2ban", "when": "'fail2ban' in ansible_facts.packages"}, "module_options": {"src": "fail2ban/jail.conf.j2", "dest": "/etc/fail2ban/jail.d/gitea.conf", "owner": "root", "group": "root", "mode": 292}, "executable": "ansible.builtin.template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "warn if fail2ban is not installed", "module": "ansible.builtin.fail", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/fail2ban.yml", "options": {"name": "warn if fail2ban is not installed", "when": "'fail2ban' not in ansible_facts.packages", "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"msg": "the package fail2ban is not installed. no fail2ban filters deployed."}, "executable": "ansible.builtin.fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "customize_footer.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "tasks": [{"py/object": "struct4.Task", "name": "create directory for custom footer", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "options": {"name": "create directory for custom footer", "become": true, "with_items": ["{{ gitea_custom }}/templates", "{{ gitea_custom }}/templates/custom"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom footer template", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_footer.yml", "options": {"name": "transfer custom footer template", "become": true, "ignore_errors": true, "tags": "skip_ansible_lint", "notify": "Restart gitea"}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_footer) }}", "dest": "{{ gitea_custom }}/templates/custom/extra_links_footer.tmpl", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "directory.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/directory.yml", "tasks": [{"py/object": "struct4.Task", "name": "Create config and data directory", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/directory.yml", "options": {"name": "Create config and data directory", "become": true, "with_items": ["/etc/gitea", "{{ gitea_home }}", "{{ gitea_home }}/data", "{{ gitea_custom }}", "{{ gitea_custom }}/https", "{{ gitea_custom }}/mailer", "{{ gitea_home }}/indexers", "{{ gitea_home }}/log", "{{ gitea_repository_root }}"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "jwt_secrets.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "tasks": [{"py/object": "struct4.Task", "name": "generate OAuth2 JWT_SECRET if not provided", "module": "ansible.builtin.shell", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "generate OAuth2 JWT_SECRET if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_oauth_jwt_secret"}, "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret JWT_SECRET > /etc/gitea/gitea_oauth_jwt_secret", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read OAuth2 JWT_SECRET from file", "module": "ansible.builtin.slurp", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "read OAuth2 JWT_SECRET from file", "become": true, "register": "oauth_jwt_secret", "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_oauth_jwt_secret"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_oauth2_jwt_secret", "module": "ansible.builtin.set_fact", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "set fact gitea_oauth2_jwt_secret", "when": "gitea_oauth2_jwt_secret | length == 0"}, "module_options": {"gitea_oauth2_jwt_secret": "{{ oauth_jwt_secret['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate LFS JWT_SECRET if not provided", "module": "ansible.builtin.shell", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "generate LFS JWT_SECRET if not provided", "become": true, "args": {"creates": "/etc/gitea/gitea_lfs_jwt_secret"}, "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": "umask 077; /usr/local/bin/gitea generate secret JWT_SECRET > /etc/gitea/gitea_lfs_jwt_secret", "executable": "ansible.builtin.shell", "executable_type": "Module", "fqcn": "ansible.builtin.shell", "annotations": {}}, {"py/object": "struct4.Task", "name": "read LFS JWT_SECRET from file", "module": "ansible.builtin.slurp", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "read LFS JWT_SECRET from file", "become": true, "register": "lfs_jwt_secret", "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": {"src": "/etc/gitea/gitea_lfs_jwt_secret"}, "executable": "ansible.builtin.slurp", "executable_type": "Module", "fqcn": "ansible.builtin.slurp", "annotations": {}}, {"py/object": "struct4.Task", "name": "set fact gitea_lfs_jwt_secret", "module": "ansible.builtin.set_fact", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/jwt_secrets.yml", "options": {"name": "set fact gitea_lfs_jwt_secret", "when": "gitea_lfs_jwt_secret | length == 0"}, "module_options": {"gitea_lfs_jwt_secret": "{{ lfs_jwt_secret['content'] | b64decode }}"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "customize_logo.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "tasks": [{"py/object": "struct4.Task", "name": "create directory for custom logos", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "create directory for custom logos", "become": true, "with_items": ["{{ gitea_custom }}/public", "{{ gitea_custom }}/public/img"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom logo.svg", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom logo.svg", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_logosvg) }}", "dest": "{{ gitea_custom }}/public/img/logo.svg", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom logo.png", "module": "ansible.builtin.copy", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom logo.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_logopng) }}", "dest": "{{ gitea_custom }}/public/img/logo.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom favicon.png", "module": "ansible.builtin.copy", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom favicon.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_faviconpng) }}", "dest": "{{ gitea_custom }}/public/img/favicon.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom apple-touch-icon.png", "module": "ansible.builtin.copy", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_logo.yml", "options": {"name": "transfer custom apple-touch-icon.png", "become": true, "tags": "skip_ansible_lint", "ignore_errors": true}, "module_options": {"src": "{{ lookup('first_found', transfer_custom_logo_appletouchiconpng) }}", "dest": "{{ gitea_custom }}/public/img/apple-touch-icon.png", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "0644"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "customize_public_files.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "tasks": [{"py/object": "struct4.Task", "name": "create public directory for custom public web files", "module": "ansible.builtin.file", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "options": {"name": "create public directory for custom public web files", "become": true, "with_items": ["{{ gitea_custom }}/public"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "transfer custom public web data", "module": "ansible.builtin.copy", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/customize_public_files.yml", "options": {"name": "transfer custom public web data", "become": true, "ignore_errors": true, "tags": "skip_ansible_lint", "notify": "Restart gitea"}, "module_options": {"src": "{{ gitea_customize_files_path }}", "dest": "{{ gitea_custom }}/public/", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "directory_mode": true, "mode": "u=rwX,g=rX,o="}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "backup.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "tasks": [{"py/object": "struct4.Task", "name": "Get service facts", "module": "ansible.builtin.service_facts", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Get service facts"}, "module_options": null, "executable": "ansible.builtin.service_facts", "executable_type": "Module", "fqcn": "ansible.builtin.service_facts", "annotations": {}}, {"py/object": "struct4.Task", "name": "Stopping gitea before upgrade", "module": "ansible.builtin.systemd", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Stopping gitea before upgrade", "become": true, "when": "ansible_service_mgr == \"systemd\""}, "module_options": {"name": "gitea", "state": "stopped"}, "executable": "ansible.builtin.systemd", "executable_type": "Module", "fqcn": "ansible.builtin.systemd", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create backup directory", "module": "ansible.builtin.file", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Create backup directory", "become": true, "with_items": ["{{ gitea_backup_location }}"]}, "module_options": {"path": "{{ item }}", "state": "directory", "owner": "{{ gitea_user }}", "group": "{{ gitea_group }}", "mode": "u=rwx,g=rx,o="}, "executable": "ansible.builtin.file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "Backing up gitea before upgrade", "module": "ansible.builtin.command", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/backup.yml", "options": {"name": "Backing up gitea before upgrade", "become": true, "changed_when": true}, "module_options": {"cmd": "sudo -u {{ gitea_user }} /usr/local/bin/gitea dump -c /etc/gitea/gitea.ini", "chdir": "{{ gitea_backup_location }}"}, "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "create_user.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "tasks": [{"py/object": "struct4.Task", "name": "Create Gitea Group", "module": "ansible.builtin.group", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Create Gitea Group", "become": true}, "module_options": {"name": "{{ gitea_group }}", "system": true, "state": "present"}, "executable": "ansible.builtin.group", "executable_type": "Module", "fqcn": "ansible.builtin.group", "annotations": {}}, {"py/object": "struct4.Task", "name": "Switch shell when not using the builtin ssh server", "module": "ansible.builtin.set_fact", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Switch shell when not using the builtin ssh server", "when": "not gitea_start_ssh and gitea_shell == '/bin/false'"}, "module_options": {"gitea_shell": "/bin/bash"}, "executable": "ansible.builtin.set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create Gitea user", "module": "ansible.builtin.user", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/create_user.yml", "options": {"name": "Create Gitea user", "become": true}, "module_options": {"name": "{{ gitea_user }}", "comment": "Gitea user", "group": "{{ gitea_group }}", "groups": "{{ gitea_groups | default(omit) }}", "home": "{{ gitea_home }}", "shell": "{{ gitea_shell }}", "system": true}, "executable": "ansible.builtin.user", "executable_type": "Module", "fqcn": "ansible.builtin.user", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "install.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "tasks": [{"py/object": "struct4.Task", "name": "Update apt cache", "module": "ansible.builtin.apt", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Update apt cache", "become": true, "register": "_pre_update_apt_cache", "until": "_pre_update_apt_cache is succeeded", "when": ["ansible_pkg_mgr == \"apt\""]}, "module_options": {"cache_valid_time": 3600, "update_cache": true}, "executable": "ansible.builtin.apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install dependencies", "module": "ansible.builtin.package", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Install dependencies", "become": true, "register": "_install_dep_packages", "until": "_install_dep_packages is succeeded", "retries": 5, "delay": 2}, "module_options": {"name": "{{ gitea_dependencies }}", "state": "present"}, "executable": "ansible.builtin.package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Download gitea archive", "module": "ansible.builtin.get_url", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Download gitea archive", "register": "_download_archive", "until": "_download_archive is succeeded", "retries": 5, "delay": 2}, "module_options": {"url": "{{ gitea_dl_url }}.xz", "dest": "/tmp/{{ gitea_filename }}.xz", "checksum": "sha256:{{ gitea_dl_url }}.xz.sha256", "mode": 416}, "executable": "ansible.builtin.get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "Download gitea asc file", "module": "ansible.builtin.get_url", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Download gitea asc file", "register": "_download_asc", "until": "_download_asc is succeeded", "retries": 5, "delay": 2}, "module_options": {"url": "{{ gitea_dl_url }}.xz.asc", "dest": "/tmp/{{ gitea_filename }}.xz.asc", "mode": 416}, "executable": "ansible.builtin.get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "Check gitea gpg key", "module": "ansible.builtin.command", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Check gitea gpg key", "register": "_gitea_gpg_key_status", "changed_when": false, "failed_when": "_gitea_gpg_key_status.rc not in (0, 2)"}, "module_options": "gpg --list-keys 0x{{ gitea_gpg_key }}", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Import gitea gpg key", "module": "ansible.builtin.command", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Import gitea gpg key", "register": "_gitea_import_key", "changed_when": "\"imported: 1\" in _gitea_import_key.stderr", "when": "_gitea_gpg_key_status.rc != 0"}, "module_options": "gpg --keyserver {{ gitea_gpg_server }} --recv {{ gitea_gpg_key }}", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Check archive signature", "module": "ansible.builtin.command", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Check archive signature", "changed_when": false}, "module_options": "gpg --verify /tmp/{{ gitea_filename }}.xz.asc /tmp/{{ gitea_filename }}.xz", "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Unpack gitea binary", "module": "ansible.builtin.command", "index": 7, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Unpack gitea binary"}, "module_options": {"cmd": "xz -k -d /tmp/{{ gitea_filename }}.xz", "creates": "/tmp/{{ gitea_filename }}"}, "executable": "ansible.builtin.command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Propagate gitea binary", "module": "ansible.builtin.copy", "index": 8, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/install.yml", "options": {"name": "Propagate gitea binary", "become": true, "notify": "Restart gitea"}, "module_options": {"src": "/tmp/{{ gitea_filename }}", "remote_src": true, "dest": "/usr/local/bin/gitea", "mode": 493, "owner": "root", "group": "root"}, "executable": "ansible.builtin.copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "main.yml", "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "tasks": [{"py/object": "struct4.Task", "name": "perform optional versionscheck", "module": "ansible.builtin.include_tasks", "index": 0, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "perform optional versionscheck", "when": "submodules_versioncheck|bool"}, "module_options": "versioncheck.yml", "executable": "versioncheck.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather installed packages for checks later on", "module": "ansible.builtin.package_facts", "index": 1, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather installed packages for checks later on"}, "module_options": {"manager": "auto"}, "executable": "ansible.builtin.package_facts", "executable_type": "Module", "fqcn": "ansible.builtin.package_facts", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather variables for each operating system", "module": "ansible.builtin.include_vars", "index": 2, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather variables for each operating system"}, "module_options": "{{ lookup('first_found', gitea_variables) }}", "executable": "ansible.builtin.include_vars", "executable_type": "Module", "fqcn": "ansible.builtin.include_vars", "annotations": {}}, {"py/object": "struct4.Task", "name": "Gather versioning information", "module": "ansible.builtin.include_tasks", "index": 3, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Gather versioning information"}, "module_options": "set_version.yml", "executable": "set_version.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "backup gitea before update", "module": "ansible.builtin.include_tasks", "index": 4, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "backup gitea before update", "when": "gitea_backup_on_upgrade|bool"}, "module_options": "backup.yml", "executable": "backup.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "create gitea user and role", "module": "ansible.builtin.include_tasks", "index": 5, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "create gitea user and role"}, "module_options": "create_user.yml", "executable": "create_user.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "install or update gitea", "module": "ansible.builtin.include_tasks", "index": 6, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "install or update gitea"}, "module_options": "install.yml", "executable": "install.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create directories", "module": "ansible.builtin.include_tasks", "index": 7, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "Create directories"}, "module_options": "directory.yml", "executable": "directory.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup gitea systemd service", "module": "ansible.builtin.include_tasks", "index": 8, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "setup gitea systemd service", "when": "ansible_service_mgr == \"systemd\""}, "module_options": "install_systemd.yml", "executable": "install_systemd.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate JWT Secrets if undefined", "module": "ansible.builtin.include_tasks", "index": 9, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "generate JWT Secrets if undefined"}, "module_options": "jwt_secrets.yml", "executable": "jwt_secrets.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "generate gitea secrets if undefined", "module": "ansible.builtin.include_tasks", "index": 10, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "generate gitea secrets if undefined"}, "module_options": "gitea_secrets.yml", "executable": "gitea_secrets.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure gitea", "module": "ansible.builtin.include_tasks", "index": 11, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "configure gitea"}, "module_options": "configure.yml", "executable": "configure.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "deploy optional fail2ban rules", "module": "ansible.builtin.include_tasks", "index": 12, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "deploy optional fail2ban rules", "when": "gitea_fail2ban_enabled|bool"}, "module_options": "fail2ban.yml", "executable": "fail2ban.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "optionally customize gitea", "module": "ansible.builtin.include_tasks", "index": 13, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally customize gitea", "when": "gitea_customize_logo|bool"}, "module_options": "customize_logo.yml", "executable": "customize_logo.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "optionally customize footer", "module": "ansible.builtin.include_tasks", "index": 14, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally customize footer", "when": "gitea_customize_footer|bool"}, "module_options": "customize_footer.yml", "executable": "customize_footer.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "optionally deploy public files", "module": "ansible.builtin.include_tasks", "index": 15, "defined_in": "./role-test/testdata/do1jlr-gitea/do1jlr.gitea/tasks/main.yml", "options": {"name": "optionally deploy public files", "when": "gitea_customize_files|bool"}, "module_options": "customize_public_files.yml", "executable": "customize_public_files.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "do1jlr.gitea", "used_in": [], "annotations": {}}], "modules": [], "source": "", "annotations": {}, "used_in": []}}, "annotations": {}}