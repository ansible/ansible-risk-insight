{"py/object": "struct4.Repository", "name": "", "path": "", "my_collection_name": "", "playbooks": [], "roles": [], "installed_collections_path": "", "installed_collections": [], "installed_roles_path": "./role-test/testdata/newrelic-newrelic-infra", "installed_roles": [{"py/object": "struct4.Role", "name": "newrelic.newrelic-infra", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra", "fqcn": "newrelic.newrelic-infra", "collection": "", "taskfiles": [{"py/object": "struct4.TaskFile", "name": "install_dist_pkgs.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "tasks": [{"py/object": "struct4.Task", "name": "confirm redhat lsb util is present pre2.8.0", "module": "yum", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm redhat lsb util is present pre2.8.0", "when": "nrinfragent_os_name == 'redhat' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "redhat-lsb-core", "state": "present"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "confirm redhat lsb util is present post2.8.0", "module": "yum", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm redhat lsb util is present post2.8.0", "when": "nrinfragent_os_name == 'redhat' and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "redhat-lsb-core", "state": "present", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "reread ansible_lsb facts", "module": "setup", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "reread ansible_lsb facts", "when": "nrinfragent_os_name == 'redhat'"}, "module_options": {"filter": "ansible_lsb*"}, "executable": "setup", "executable_type": "Module", "fqcn": "ansible.builtin.setup", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "apt_key", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"url": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "apt_key", "executable_type": "Module", "fqcn": "ansible.builtin.apt_key", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "rpm_key", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'redhat'"}, "module_options": {"key": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "rpm_key", "executable_type": "Module", "fqcn": "ansible.builtin.rpm_key", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "rpm_key", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'suse'"}, "module_options": {"key": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "rpm_key", "executable_type": "Module", "fqcn": "ansible.builtin.rpm_key", "annotations": {}}, {"py/object": "struct4.Task", "name": "confirm Debian apt-transport-https is present", "module": "apt", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm Debian apt-transport-https is present", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"name": "apt-transport-https", "state": "present", "update_cache": true}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "apt_repository", "index": 7, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"repo": "deb https://download.newrelic.com/infrastructure_agent/linux/apt {{ nrinfragent_os_codename }} main", "state": "present", "update_cache": "yes"}, "executable": "apt_repository", "executable_type": "Module", "fqcn": "ansible.builtin.apt_repository", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "yum_repository", "index": 8, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_distribution == 'amazon'", "register": "setup_agent_repo_amazon"}, "module_options": {"baseurl": "https://download.newrelic.com/infrastructure_agent/linux/yum/el/{{ (ansible_service_mgr == 'upstart') | ternary('6', '7') }}/{{ ansible_architecture }}", "gpgcheck": "yes", "gpgkey": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "name": "newrelic-infra", "repo_gpgcheck": "yes", "state": "present", "description": "New Relic Infrastructure"}, "executable": "yum_repository", "executable_type": "Module", "fqcn": "ansible.builtin.yum_repository", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "yum_repository", "index": 9, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'redhat' and ansible_distribution|lower != 'amazon'", "register": "setup_agent_repo_redhat"}, "module_options": {"baseurl": "https://download.newrelic.com/infrastructure_agent/linux/yum/el/{{ nrinfragent_os_version }}/{{ ansible_architecture }}", "gpgcheck": "yes", "gpgkey": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "name": "newrelic-infra", "repo_gpgcheck": "{{ (nrinfragent_os_version == '5') | ternary('no', 'yes') }}", "state": "present", "description": "New Relic Infrastructure"}, "executable": "yum_repository", "executable_type": "Module", "fqcn": "ansible.builtin.yum_repository", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "zypper_repository", "index": 10, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'suse'", "register": "infra_agent_zypper_repo"}, "module_options": {"name": "newrelic-infra", "description": "New Relic Infrastructure Agent", "repo": "http://download.newrelic.com/infrastructure_agent/linux/zypp/sles/{{ ansible_distribution_version }}/{{ ansible_machine }}/", "runrefresh": "yes", "auto_import_keys": "yes", "disable_gpg_check": "yes"}, "executable": "zypper_repository", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "run make cache to actually import gpg key", "module": "command", "index": 11, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "run make cache to actually import gpg key", "when": "nrinfragent_os_name == 'redhat' and (setup_agent_repo_amazon.changed or setup_agent_repo_redhat.changed)", "tags": ["skip_ansible_lint"], "args": {"warn": false}}, "module_options": "yum -q makecache -y --disablerepo='*' --enablerepo='newrelic-infra'", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "create log destination directory", "module": "file", "index": 12, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "create log destination directory", "when": ["nrinfragent_state != 'absent'", "nrinfragent_config['log_file'] is defined"]}, "module_options": {"path": "{{ nrinfragent_config['log_file'] | dirname }}", "state": "directory", "recurse": true}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "install agent pre2.8.0", "module": "package", "index": 13, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent pre2.8.0", "when": "nrinfragent_os_name != 'windows' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "install agent post2.8.0", "module": "package", "index": 14, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent post2.8.0", "when": "nrinfragent_os_name != 'windows' and ansible_version.full >= \"2.8.0\" and nrinfragent_os_name != 'amazon' and nrinfragent_os_name != 'redhat'"}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install agent yum", "module": "yum", "index": 15, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install agent yum", "when": "(nrinfragent_os_name == 'redhat' or nrinfragent_os_name == 'amazon') and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "install integrations pre2.8.0", "module": "package", "index": 16, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install integrations pre2.8.0", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install integrations post2.8.0", "module": "package", "index": 17, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install integrations post2.8.0", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows' and ansible_version.full >= \"2.8.0\" and nrinfragent_os_name != 'amazon' and nrinfragent_os_name != 'redhat'"}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install integrations yum", "module": "yum", "index": 18, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install integrations yum", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name == 'redhat' or nrinfragent_os_name == 'amazon' and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "install agent (windows)", "module": "win_chocolatey", "index": 19, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent (windows)", "when": ["nrinfragent_os_name == 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}", "version": "{{ nrinfragent_choco_version | default(omit) }}"}, "executable": "win_chocolatey", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "setup_agent_service.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "tasks": [{"py/object": "struct4.Task", "name": "setup agent init service", "module": "service", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "options": {"name": "setup agent init service", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_service_state }}", "enabled": "{{ nrinfragent_service_enabled }}"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent init service (windows)", "module": "win_service", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "options": {"name": "setup agent init service (windows)", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_service_state }}", "start_mode": "{{ nrinfragent_service_enabled | ternary('auto','manual') }}"}, "executable": "win_service", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "setup_logging.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "tasks": [{"py/object": "struct4.Task", "name": "Setup logging", "module": "template", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "options": {"name": "Setup logging", "when": ["nrinfragent_logging is defined", "nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"src": "newrelic-logging.yml.j2", "dest": "/etc/newrelic-infra/logging.d/logging.yml", "trim_blocks": false}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup logging (windows)", "module": "win_template", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "options": {"name": "setup logging (windows)", "when": ["nrinfragent_logging is defined", "nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"src": "newrelic-logging.yml.j2", "dest": "C:\\Program Files\\New Relic\\newrelic-infra\\logging.d\\logging.yml", "trim_blocks": false}, "executable": "win_template", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "install_targz.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "tasks": [{"py/object": "struct4.Task", "name": "validate agent tarball required variables", "module": "fail", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "validate agent tarball required variables", "when": "vars[item] is undefined or not vars[item]", "loop": ["nrinfragent_tarball_version", "nrinfragent_tarball_download_dir"]}, "module_options": {"msg": "Required variable {{ item }} has not been provided or it's null"}, "executable": "fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set full download path", "module": "set_fact", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Set full download path"}, "module_options": {"nrinfragent_tarball_download_path": "{{ nrinfragent_tarball_download_dir }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create the download directory, including intermediate ones", "module": "file", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Create the download directory, including intermediate ones"}, "module_options": {"path": "{{ nrinfragent_tarball_download_path }}", "state": "directory", "mode": 384}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "downloading bundled agent file", "module": "get_url", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "downloading bundled agent file", "when": "nrinfragent_tarball_from_local is undefined"}, "module_options": {"url": "http://download.newrelic.com/infrastructure_agent/binaries/linux/{{ nrinfragent_architecture }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}.tar.gz", "dest": "{{ nrinfragent_tarball_download_path }}.tar.gz"}, "executable": "get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create temporary file for bundle", "module": "ansible.builtin.tempfile", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Create temporary file for bundle", "register": "tarball_local", "delegate_to": "127.0.0.1", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"state": "file", "suffix": "temp"}, "executable": "ansible.builtin.tempfile", "executable_type": "Module", "fqcn": "ansible.builtin.tempfile", "annotations": {}}, {"py/object": "struct4.Task", "name": "downloading bundled agent file locally", "module": "get_url", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "downloading bundled agent file locally", "delegate_to": "127.0.0.1", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"url": "http://download.newrelic.com/infrastructure_agent/binaries/linux/{{ nrinfragent_architecture }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}.tar.gz", "dest": "{{ tarball_local.path }}"}, "executable": "get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "upload bundled agent file", "module": "copy", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "upload bundled agent file", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"src": "{{ tarball_local.path }}", "dest": "{{ nrinfragent_tarball_download_path }}.tar.gz"}, "executable": "copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "create agent destination directory", "module": "file", "index": 7, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "create agent destination directory"}, "module_options": {"path": "{{ nrinfragent_tarball_download_path }}", "state": "directory", "recurse": true, "mode": 438}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "uncompressing bundled agent file", "module": "unarchive", "index": 8, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "uncompressing bundled agent file", "register": "archive_contents"}, "module_options": {"src": "{{ nrinfragent_tarball_download_path }}.tar.gz", "dest": "{{ nrinfragent_tarball_download_path }}/", "remote_src": true, "creates": "{{ nrinfragent_tarball_download_path }}/newrelic-infra/"}, "executable": "unarchive", "executable_type": "Module", "fqcn": "ansible.builtin.unarchive", "annotations": {}}, {"py/object": "struct4.Task", "name": "Stop newrelic-infra if running", "module": "service", "index": 9, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Stop newrelic-infra if running", "failed_when": false}, "module_options": {"name": "newrelic-infra", "state": "stopped"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}, {"py/object": "struct4.Task", "name": "running installer", "module": "command", "index": 10, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "running installer", "args": {"chdir": "{{ nrinfragent_tarball_download_path }}/newrelic-infra/"}, "environment": {"NRIA_AGENT_DIR": "{{ nrinfragent_tarball_agent_dir | default('') }}", "NRIA_BIN_DIR": "{{ nrinfragent_tarball_bin_dir | default('') }}", "NRIA_CONFIG_FILE": "{{ nrinfragent_config_path | default('') }}", "NRIA_LICENSE_KEY": "{{ nrinfragent_config['license_key'] | default('') }}", "NRIA_LOG_FILE": "{{ nrinfragent_tarball_log_file | default('') }}", "NRIA_MODE": "{{ nrinfragent_tarball_mode | default('') }}", "NRIA_PID_FILE": "{{ nrinfragent_tarball_pid_file | default('') }}", "NRIA_PLUGIN_DIR": "{{ nrinfragent_tarball_plugin_dir | default('') }}", "NRIA_USER": "{{ nrinfragent_tarball_user | default('') }}", "NRIA_PROXY": "{{ nrinfragent_config['proxy'] | default('') }}"}, "become": true, "when": "archive_contents is defined and archive_contents.changed"}, "module_options": "./installer.sh", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Start newrelic-infra", "module": "service", "index": 11, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Start newrelic-infra"}, "module_options": {"name": "newrelic-infra", "state": "started"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "configure_agent.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "tasks": [{"py/object": "struct4.Task", "name": "ensure python-yaml is installed", "module": "package", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure python-yaml is installed", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'", "ansible_python_version is version('3.0', '<')"]}, "module_options": {"name": "python-yaml", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "ensure python3-yaml is installed", "module": "package", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure python3-yaml is installed", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'", "ansible_python_version is version('3.0', '>=')", "ansible_facts['os_family'] == 'Debian'"]}, "module_options": {"name": "python3-yaml", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "ensure pyYAML is installed via pip", "module": "pip", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure pyYAML is installed via pip", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != \"windows\"", "ansible_python_version is version('3.0', '>=')", "ansible_facts['os_family'] == 'RedHat'"]}, "module_options": {"name": "PyYAML"}, "executable": "pip", "executable_type": "Module", "fqcn": "ansible.builtin.pip", "annotations": {}}, {"py/object": "struct4.Task", "name": "Stat newrelic-infra.yml config file", "module": "stat", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Stat newrelic-infra.yml config file", "register": "nrinfragent_config_stat", "when": ["nrinfragent_os_name != 'windows'"]}, "module_options": {"path": "{{ nrinfragent_config_path }}"}, "executable": "stat", "executable_type": "Module", "fqcn": "ansible.builtin.stat", "annotations": {}}, {"py/object": "struct4.Task", "name": "Ensure newrelic-infra.yml exists", "module": "file", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Ensure newrelic-infra.yml exists", "when": ["nrinfragent_os_name != 'windows'", "nrinfragent_config_stat.stat.exists == false or nrinfragent_config_stat.stat.mode != '0600'"]}, "module_options": {"path": "{{ nrinfragent_config_path }}", "state": "touch", "mode": 384}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "Setup agent config *NIX", "module": "merge_yaml", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Setup agent config *NIX", "no_log": "{{ nrinfragent_hide_config_values }}", "notify": "restart newrelic-infra", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"src": "{{ nrinfragent_config_path }}", "value": "{{ nrinfragent_config }}"}, "executable": "merge_yaml", "executable_type": "Module", "fqcn": "merge_yaml", "annotations": {"use-non-builtin-module": true}}, {"py/object": "struct4.Task", "name": "setup agent config (windows)", "module": "win_template", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "setup agent config (windows)", "notify": "restart newrelic-infra (windows)", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"src": "newrelic-infra.yml.j2", "dest": "{{ nrinfragent_config_path }}"}, "executable": "win_template", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {"use-non-builtin-module": true}}, {"py/object": "struct4.TaskFile", "name": "install_integrations_pkgs.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_integrations_pkgs.yml", "tasks": [{"py/object": "struct4.Task", "name": "install integrations", "module": "package", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_integrations_pkgs.yml", "options": {"name": "install integrations", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows'"}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "main.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "tasks": [{"py/object": "struct4.Task", "name": "installation from tarball package", "module": "import_tasks", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "installation from tarball package", "tags": ["nria_install_tarball"], "when": ["nrinfragent_tarball_version is defined", "nrinfragent_os_name != 'windows'"]}, "module_options": "install_targz.yml", "executable": "install_targz.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "install from standard distribution packages", "module": "import_tasks", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "install from standard distribution packages", "tags": ["nria_install"], "when": "nrinfragent_tarball_version is undefined"}, "module_options": "install_dist_pkgs.yml", "executable": "install_dist_pkgs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "install OHIs", "module": "import_tasks", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "install OHIs", "tags": ["nria_install_integrations"], "when": "nrinfragent_tarball_version is undefined"}, "module_options": "install_integrations_pkgs.yml", "executable": "install_integrations_pkgs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure the infrastructure agent", "module": "import_tasks", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "configure the infrastructure agent", "tags": ["nria_configure"]}, "module_options": "configure_agent.yml", "executable": "configure_agent.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent init service", "module": "import_tasks", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "setup agent init service", "tags": ["nria_setup_service"]}, "module_options": "setup_agent_service.yml", "executable": "setup_agent_service.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}], "modules": [{"py/object": "struct4.Module", "name": "merge_yaml", "fqcn": "merge_yaml", "collection": "", "role": "newrelic.newrelic-infra", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/library/merge_yaml.py", "builtin": false, "used_in": ["{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 5}"], "annotations": {}}], "source": "", "annotations": {"use-non-builtin-module": true}, "used_in": []}], "modules": [], "taskfiles": [], "version": "", "module_dict": {"merge_yaml": {"py/object": "struct4.Module", "name": "merge_yaml", "fqcn": "merge_yaml", "collection": "", "role": "newrelic.newrelic-infra", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/library/merge_yaml.py", "builtin": false, "used_in": ["{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 5}"], "annotations": {}}}, "task_dict": {"{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "confirm redhat lsb util is present pre2.8.0", "module": "yum", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm redhat lsb util is present pre2.8.0", "when": "nrinfragent_os_name == 'redhat' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "redhat-lsb-core", "state": "present"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "confirm redhat lsb util is present post2.8.0", "module": "yum", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm redhat lsb util is present post2.8.0", "when": "nrinfragent_os_name == 'redhat' and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "redhat-lsb-core", "state": "present", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "reread ansible_lsb facts", "module": "setup", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "reread ansible_lsb facts", "when": "nrinfragent_os_name == 'redhat'"}, "module_options": {"filter": "ansible_lsb*"}, "executable": "setup", "executable_type": "Module", "fqcn": "ansible.builtin.setup", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "apt_key", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"url": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "apt_key", "executable_type": "Module", "fqcn": "ansible.builtin.apt_key", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "rpm_key", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'redhat'"}, "module_options": {"key": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "rpm_key", "executable_type": "Module", "fqcn": "ansible.builtin.rpm_key", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "rpm_key", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'suse'"}, "module_options": {"key": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "rpm_key", "executable_type": "Module", "fqcn": "ansible.builtin.rpm_key", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "confirm Debian apt-transport-https is present", "module": "apt", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm Debian apt-transport-https is present", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"name": "apt-transport-https", "state": "present", "update_cache": true}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 7}": {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "apt_repository", "index": 7, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"repo": "deb https://download.newrelic.com/infrastructure_agent/linux/apt {{ nrinfragent_os_codename }} main", "state": "present", "update_cache": "yes"}, "executable": "apt_repository", "executable_type": "Module", "fqcn": "ansible.builtin.apt_repository", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 8}": {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "yum_repository", "index": 8, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_distribution == 'amazon'", "register": "setup_agent_repo_amazon"}, "module_options": {"baseurl": "https://download.newrelic.com/infrastructure_agent/linux/yum/el/{{ (ansible_service_mgr == 'upstart') | ternary('6', '7') }}/{{ ansible_architecture }}", "gpgcheck": "yes", "gpgkey": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "name": "newrelic-infra", "repo_gpgcheck": "yes", "state": "present", "description": "New Relic Infrastructure"}, "executable": "yum_repository", "executable_type": "Module", "fqcn": "ansible.builtin.yum_repository", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 9}": {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "yum_repository", "index": 9, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'redhat' and ansible_distribution|lower != 'amazon'", "register": "setup_agent_repo_redhat"}, "module_options": {"baseurl": "https://download.newrelic.com/infrastructure_agent/linux/yum/el/{{ nrinfragent_os_version }}/{{ ansible_architecture }}", "gpgcheck": "yes", "gpgkey": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "name": "newrelic-infra", "repo_gpgcheck": "{{ (nrinfragent_os_version == '5') | ternary('no', 'yes') }}", "state": "present", "description": "New Relic Infrastructure"}, "executable": "yum_repository", "executable_type": "Module", "fqcn": "ansible.builtin.yum_repository", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 10}": {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "zypper_repository", "index": 10, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'suse'", "register": "infra_agent_zypper_repo"}, "module_options": {"name": "newrelic-infra", "description": "New Relic Infrastructure Agent", "repo": "http://download.newrelic.com/infrastructure_agent/linux/zypp/sles/{{ ansible_distribution_version }}/{{ ansible_machine }}/", "runrefresh": "yes", "auto_import_keys": "yes", "disable_gpg_check": "yes"}, "executable": "zypper_repository", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 11}": {"py/object": "struct4.Task", "name": "run make cache to actually import gpg key", "module": "command", "index": 11, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "run make cache to actually import gpg key", "when": "nrinfragent_os_name == 'redhat' and (setup_agent_repo_amazon.changed or setup_agent_repo_redhat.changed)", "tags": ["skip_ansible_lint"], "args": {"warn": false}}, "module_options": "yum -q makecache -y --disablerepo='*' --enablerepo='newrelic-infra'", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 12}": {"py/object": "struct4.Task", "name": "create log destination directory", "module": "file", "index": 12, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "create log destination directory", "when": ["nrinfragent_state != 'absent'", "nrinfragent_config['log_file'] is defined"]}, "module_options": {"path": "{{ nrinfragent_config['log_file'] | dirname }}", "state": "directory", "recurse": true}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 13}": {"py/object": "struct4.Task", "name": "install agent pre2.8.0", "module": "package", "index": 13, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent pre2.8.0", "when": "nrinfragent_os_name != 'windows' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 14}": {"py/object": "struct4.Task", "name": "install agent post2.8.0", "module": "package", "index": 14, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent post2.8.0", "when": "nrinfragent_os_name != 'windows' and ansible_version.full >= \"2.8.0\" and nrinfragent_os_name != 'amazon' and nrinfragent_os_name != 'redhat'"}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 15}": {"py/object": "struct4.Task", "name": "Install agent yum", "module": "yum", "index": 15, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install agent yum", "when": "(nrinfragent_os_name == 'redhat' or nrinfragent_os_name == 'amazon') and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 16}": {"py/object": "struct4.Task", "name": "install integrations pre2.8.0", "module": "package", "index": 16, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install integrations pre2.8.0", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 17}": {"py/object": "struct4.Task", "name": "Install integrations post2.8.0", "module": "package", "index": 17, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install integrations post2.8.0", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows' and ansible_version.full >= \"2.8.0\" and nrinfragent_os_name != 'amazon' and nrinfragent_os_name != 'redhat'"}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 18}": {"py/object": "struct4.Task", "name": "Install integrations yum", "module": "yum", "index": 18, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install integrations yum", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name == 'redhat' or nrinfragent_os_name == 'amazon' and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml\", \"index\": 19}": {"py/object": "struct4.Task", "name": "install agent (windows)", "module": "win_chocolatey", "index": 19, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent (windows)", "when": ["nrinfragent_os_name == 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}", "version": "{{ nrinfragent_choco_version | default(omit) }}"}, "executable": "win_chocolatey", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "setup agent init service", "module": "service", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "options": {"name": "setup agent init service", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_service_state }}", "enabled": "{{ nrinfragent_service_enabled }}"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "setup agent init service (windows)", "module": "win_service", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "options": {"name": "setup agent init service (windows)", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_service_state }}", "start_mode": "{{ nrinfragent_service_enabled | ternary('auto','manual') }}"}, "executable": "win_service", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "Setup logging", "module": "template", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "options": {"name": "Setup logging", "when": ["nrinfragent_logging is defined", "nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"src": "newrelic-logging.yml.j2", "dest": "/etc/newrelic-infra/logging.d/logging.yml", "trim_blocks": false}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "setup logging (windows)", "module": "win_template", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "options": {"name": "setup logging (windows)", "when": ["nrinfragent_logging is defined", "nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"src": "newrelic-logging.yml.j2", "dest": "C:\\Program Files\\New Relic\\newrelic-infra\\logging.d\\logging.yml", "trim_blocks": false}, "executable": "win_template", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "validate agent tarball required variables", "module": "fail", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "validate agent tarball required variables", "when": "vars[item] is undefined or not vars[item]", "loop": ["nrinfragent_tarball_version", "nrinfragent_tarball_download_dir"]}, "module_options": {"msg": "Required variable {{ item }} has not been provided or it's null"}, "executable": "fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "Set full download path", "module": "set_fact", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Set full download path"}, "module_options": {"nrinfragent_tarball_download_path": "{{ nrinfragent_tarball_download_dir }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "Create the download directory, including intermediate ones", "module": "file", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Create the download directory, including intermediate ones"}, "module_options": {"path": "{{ nrinfragent_tarball_download_path }}", "state": "directory", "mode": 384}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "downloading bundled agent file", "module": "get_url", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "downloading bundled agent file", "when": "nrinfragent_tarball_from_local is undefined"}, "module_options": {"url": "http://download.newrelic.com/infrastructure_agent/binaries/linux/{{ nrinfragent_architecture }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}.tar.gz", "dest": "{{ nrinfragent_tarball_download_path }}.tar.gz"}, "executable": "get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "Create temporary file for bundle", "module": "ansible.builtin.tempfile", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Create temporary file for bundle", "register": "tarball_local", "delegate_to": "127.0.0.1", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"state": "file", "suffix": "temp"}, "executable": "ansible.builtin.tempfile", "executable_type": "Module", "fqcn": "ansible.builtin.tempfile", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "downloading bundled agent file locally", "module": "get_url", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "downloading bundled agent file locally", "delegate_to": "127.0.0.1", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"url": "http://download.newrelic.com/infrastructure_agent/binaries/linux/{{ nrinfragent_architecture }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}.tar.gz", "dest": "{{ tarball_local.path }}"}, "executable": "get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "upload bundled agent file", "module": "copy", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "upload bundled agent file", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"src": "{{ tarball_local.path }}", "dest": "{{ nrinfragent_tarball_download_path }}.tar.gz"}, "executable": "copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 7}": {"py/object": "struct4.Task", "name": "create agent destination directory", "module": "file", "index": 7, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "create agent destination directory"}, "module_options": {"path": "{{ nrinfragent_tarball_download_path }}", "state": "directory", "recurse": true, "mode": 438}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 8}": {"py/object": "struct4.Task", "name": "uncompressing bundled agent file", "module": "unarchive", "index": 8, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "uncompressing bundled agent file", "register": "archive_contents"}, "module_options": {"src": "{{ nrinfragent_tarball_download_path }}.tar.gz", "dest": "{{ nrinfragent_tarball_download_path }}/", "remote_src": true, "creates": "{{ nrinfragent_tarball_download_path }}/newrelic-infra/"}, "executable": "unarchive", "executable_type": "Module", "fqcn": "ansible.builtin.unarchive", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 9}": {"py/object": "struct4.Task", "name": "Stop newrelic-infra if running", "module": "service", "index": 9, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Stop newrelic-infra if running", "failed_when": false}, "module_options": {"name": "newrelic-infra", "state": "stopped"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 10}": {"py/object": "struct4.Task", "name": "running installer", "module": "command", "index": 10, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "running installer", "args": {"chdir": "{{ nrinfragent_tarball_download_path }}/newrelic-infra/"}, "environment": {"NRIA_AGENT_DIR": "{{ nrinfragent_tarball_agent_dir | default('') }}", "NRIA_BIN_DIR": "{{ nrinfragent_tarball_bin_dir | default('') }}", "NRIA_CONFIG_FILE": "{{ nrinfragent_config_path | default('') }}", "NRIA_LICENSE_KEY": "{{ nrinfragent_config['license_key'] | default('') }}", "NRIA_LOG_FILE": "{{ nrinfragent_tarball_log_file | default('') }}", "NRIA_MODE": "{{ nrinfragent_tarball_mode | default('') }}", "NRIA_PID_FILE": "{{ nrinfragent_tarball_pid_file | default('') }}", "NRIA_PLUGIN_DIR": "{{ nrinfragent_tarball_plugin_dir | default('') }}", "NRIA_USER": "{{ nrinfragent_tarball_user | default('') }}", "NRIA_PROXY": "{{ nrinfragent_config['proxy'] | default('') }}"}, "become": true, "when": "archive_contents is defined and archive_contents.changed"}, "module_options": "./installer.sh", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml\", \"index\": 11}": {"py/object": "struct4.Task", "name": "Start newrelic-infra", "module": "service", "index": 11, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Start newrelic-infra"}, "module_options": {"name": "newrelic-infra", "state": "started"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "ensure python-yaml is installed", "module": "package", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure python-yaml is installed", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'", "ansible_python_version is version('3.0', '<')"]}, "module_options": {"name": "python-yaml", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "ensure python3-yaml is installed", "module": "package", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure python3-yaml is installed", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'", "ansible_python_version is version('3.0', '>=')", "ansible_facts['os_family'] == 'Debian'"]}, "module_options": {"name": "python3-yaml", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "ensure pyYAML is installed via pip", "module": "pip", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure pyYAML is installed via pip", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != \"windows\"", "ansible_python_version is version('3.0', '>=')", "ansible_facts['os_family'] == 'RedHat'"]}, "module_options": {"name": "PyYAML"}, "executable": "pip", "executable_type": "Module", "fqcn": "ansible.builtin.pip", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "Stat newrelic-infra.yml config file", "module": "stat", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Stat newrelic-infra.yml config file", "register": "nrinfragent_config_stat", "when": ["nrinfragent_os_name != 'windows'"]}, "module_options": {"path": "{{ nrinfragent_config_path }}"}, "executable": "stat", "executable_type": "Module", "fqcn": "ansible.builtin.stat", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "Ensure newrelic-infra.yml exists", "module": "file", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Ensure newrelic-infra.yml exists", "when": ["nrinfragent_os_name != 'windows'", "nrinfragent_config_stat.stat.exists == false or nrinfragent_config_stat.stat.mode != '0600'"]}, "module_options": {"path": "{{ nrinfragent_config_path }}", "state": "touch", "mode": 384}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 5}": {"py/object": "struct4.Task", "name": "Setup agent config *NIX", "module": "merge_yaml", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Setup agent config *NIX", "no_log": "{{ nrinfragent_hide_config_values }}", "notify": "restart newrelic-infra", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"src": "{{ nrinfragent_config_path }}", "value": "{{ nrinfragent_config }}"}, "executable": "merge_yaml", "executable_type": "Module", "fqcn": "merge_yaml", "annotations": {"use-non-builtin-module": true}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 6}": {"py/object": "struct4.Task", "name": "setup agent config (windows)", "module": "win_template", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "setup agent config (windows)", "notify": "restart newrelic-infra (windows)", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"src": "newrelic-infra.yml.j2", "dest": "{{ nrinfragent_config_path }}"}, "executable": "win_template", "executable_type": "Module", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_integrations_pkgs.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "install integrations", "module": "package", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_integrations_pkgs.yml", "options": {"name": "install integrations", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows'"}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml\", \"index\": 0}": {"py/object": "struct4.Task", "name": "installation from tarball package", "module": "import_tasks", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "installation from tarball package", "tags": ["nria_install_tarball"], "when": ["nrinfragent_tarball_version is defined", "nrinfragent_os_name != 'windows'"]}, "module_options": "install_targz.yml", "executable": "install_targz.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml\", \"index\": 1}": {"py/object": "struct4.Task", "name": "install from standard distribution packages", "module": "import_tasks", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "install from standard distribution packages", "tags": ["nria_install"], "when": "nrinfragent_tarball_version is undefined"}, "module_options": "install_dist_pkgs.yml", "executable": "install_dist_pkgs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml\", \"index\": 2}": {"py/object": "struct4.Task", "name": "install OHIs", "module": "import_tasks", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "install OHIs", "tags": ["nria_install_integrations"], "when": "nrinfragent_tarball_version is undefined"}, "module_options": "install_integrations_pkgs.yml", "executable": "install_integrations_pkgs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml\", \"index\": 3}": {"py/object": "struct4.Task", "name": "configure the infrastructure agent", "module": "import_tasks", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "configure the infrastructure agent", "tags": ["nria_configure"]}, "module_options": "configure_agent.yml", "executable": "configure_agent.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, "{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml\", \"index\": 4}": {"py/object": "struct4.Task", "name": "setup agent init service", "module": "import_tasks", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "setup agent init service", "tags": ["nria_setup_service"]}, "module_options": "setup_agent_service.yml", "executable": "setup_agent_service.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}}, "taskfile_dict": {"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml": {"py/object": "struct4.TaskFile", "name": "install_dist_pkgs.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "tasks": [{"py/object": "struct4.Task", "name": "confirm redhat lsb util is present pre2.8.0", "module": "yum", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm redhat lsb util is present pre2.8.0", "when": "nrinfragent_os_name == 'redhat' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "redhat-lsb-core", "state": "present"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "confirm redhat lsb util is present post2.8.0", "module": "yum", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm redhat lsb util is present post2.8.0", "when": "nrinfragent_os_name == 'redhat' and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "redhat-lsb-core", "state": "present", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "reread ansible_lsb facts", "module": "setup", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "reread ansible_lsb facts", "when": "nrinfragent_os_name == 'redhat'"}, "module_options": {"filter": "ansible_lsb*"}, "executable": "setup", "executable_type": "Module", "fqcn": "ansible.builtin.setup", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "apt_key", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"url": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "apt_key", "executable_type": "Module", "fqcn": "ansible.builtin.apt_key", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "rpm_key", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'redhat'"}, "module_options": {"key": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "rpm_key", "executable_type": "Module", "fqcn": "ansible.builtin.rpm_key", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "rpm_key", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'suse'"}, "module_options": {"key": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "rpm_key", "executable_type": "Module", "fqcn": "ansible.builtin.rpm_key", "annotations": {}}, {"py/object": "struct4.Task", "name": "confirm Debian apt-transport-https is present", "module": "apt", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm Debian apt-transport-https is present", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"name": "apt-transport-https", "state": "present", "update_cache": true}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "apt_repository", "index": 7, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"repo": "deb https://download.newrelic.com/infrastructure_agent/linux/apt {{ nrinfragent_os_codename }} main", "state": "present", "update_cache": "yes"}, "executable": "apt_repository", "executable_type": "Module", "fqcn": "ansible.builtin.apt_repository", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "yum_repository", "index": 8, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_distribution == 'amazon'", "register": "setup_agent_repo_amazon"}, "module_options": {"baseurl": "https://download.newrelic.com/infrastructure_agent/linux/yum/el/{{ (ansible_service_mgr == 'upstart') | ternary('6', '7') }}/{{ ansible_architecture }}", "gpgcheck": "yes", "gpgkey": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "name": "newrelic-infra", "repo_gpgcheck": "yes", "state": "present", "description": "New Relic Infrastructure"}, "executable": "yum_repository", "executable_type": "Module", "fqcn": "ansible.builtin.yum_repository", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "yum_repository", "index": 9, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'redhat' and ansible_distribution|lower != 'amazon'", "register": "setup_agent_repo_redhat"}, "module_options": {"baseurl": "https://download.newrelic.com/infrastructure_agent/linux/yum/el/{{ nrinfragent_os_version }}/{{ ansible_architecture }}", "gpgcheck": "yes", "gpgkey": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "name": "newrelic-infra", "repo_gpgcheck": "{{ (nrinfragent_os_version == '5') | ternary('no', 'yes') }}", "state": "present", "description": "New Relic Infrastructure"}, "executable": "yum_repository", "executable_type": "Module", "fqcn": "ansible.builtin.yum_repository", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "zypper_repository", "index": 10, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'suse'", "register": "infra_agent_zypper_repo"}, "module_options": {"name": "newrelic-infra", "description": "New Relic Infrastructure Agent", "repo": "http://download.newrelic.com/infrastructure_agent/linux/zypp/sles/{{ ansible_distribution_version }}/{{ ansible_machine }}/", "runrefresh": "yes", "auto_import_keys": "yes", "disable_gpg_check": "yes"}, "executable": "zypper_repository", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "run make cache to actually import gpg key", "module": "command", "index": 11, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "run make cache to actually import gpg key", "when": "nrinfragent_os_name == 'redhat' and (setup_agent_repo_amazon.changed or setup_agent_repo_redhat.changed)", "tags": ["skip_ansible_lint"], "args": {"warn": false}}, "module_options": "yum -q makecache -y --disablerepo='*' --enablerepo='newrelic-infra'", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "create log destination directory", "module": "file", "index": 12, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "create log destination directory", "when": ["nrinfragent_state != 'absent'", "nrinfragent_config['log_file'] is defined"]}, "module_options": {"path": "{{ nrinfragent_config['log_file'] | dirname }}", "state": "directory", "recurse": true}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "install agent pre2.8.0", "module": "package", "index": 13, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent pre2.8.0", "when": "nrinfragent_os_name != 'windows' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "install agent post2.8.0", "module": "package", "index": 14, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent post2.8.0", "when": "nrinfragent_os_name != 'windows' and ansible_version.full >= \"2.8.0\" and nrinfragent_os_name != 'amazon' and nrinfragent_os_name != 'redhat'"}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install agent yum", "module": "yum", "index": 15, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install agent yum", "when": "(nrinfragent_os_name == 'redhat' or nrinfragent_os_name == 'amazon') and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "install integrations pre2.8.0", "module": "package", "index": 16, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install integrations pre2.8.0", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install integrations post2.8.0", "module": "package", "index": 17, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install integrations post2.8.0", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows' and ansible_version.full >= \"2.8.0\" and nrinfragent_os_name != 'amazon' and nrinfragent_os_name != 'redhat'"}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install integrations yum", "module": "yum", "index": 18, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install integrations yum", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name == 'redhat' or nrinfragent_os_name == 'amazon' and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "install agent (windows)", "module": "win_chocolatey", "index": 19, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent (windows)", "when": ["nrinfragent_os_name == 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}", "version": "{{ nrinfragent_choco_version | default(omit) }}"}, "executable": "win_chocolatey", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml": {"py/object": "struct4.TaskFile", "name": "setup_agent_service.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "tasks": [{"py/object": "struct4.Task", "name": "setup agent init service", "module": "service", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "options": {"name": "setup agent init service", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_service_state }}", "enabled": "{{ nrinfragent_service_enabled }}"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent init service (windows)", "module": "win_service", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "options": {"name": "setup agent init service (windows)", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_service_state }}", "start_mode": "{{ nrinfragent_service_enabled | ternary('auto','manual') }}"}, "executable": "win_service", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml": {"py/object": "struct4.TaskFile", "name": "setup_logging.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "tasks": [{"py/object": "struct4.Task", "name": "Setup logging", "module": "template", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "options": {"name": "Setup logging", "when": ["nrinfragent_logging is defined", "nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"src": "newrelic-logging.yml.j2", "dest": "/etc/newrelic-infra/logging.d/logging.yml", "trim_blocks": false}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup logging (windows)", "module": "win_template", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "options": {"name": "setup logging (windows)", "when": ["nrinfragent_logging is defined", "nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"src": "newrelic-logging.yml.j2", "dest": "C:\\Program Files\\New Relic\\newrelic-infra\\logging.d\\logging.yml", "trim_blocks": false}, "executable": "win_template", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml": {"py/object": "struct4.TaskFile", "name": "install_targz.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "tasks": [{"py/object": "struct4.Task", "name": "validate agent tarball required variables", "module": "fail", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "validate agent tarball required variables", "when": "vars[item] is undefined or not vars[item]", "loop": ["nrinfragent_tarball_version", "nrinfragent_tarball_download_dir"]}, "module_options": {"msg": "Required variable {{ item }} has not been provided or it's null"}, "executable": "fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set full download path", "module": "set_fact", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Set full download path"}, "module_options": {"nrinfragent_tarball_download_path": "{{ nrinfragent_tarball_download_dir }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create the download directory, including intermediate ones", "module": "file", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Create the download directory, including intermediate ones"}, "module_options": {"path": "{{ nrinfragent_tarball_download_path }}", "state": "directory", "mode": 384}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "downloading bundled agent file", "module": "get_url", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "downloading bundled agent file", "when": "nrinfragent_tarball_from_local is undefined"}, "module_options": {"url": "http://download.newrelic.com/infrastructure_agent/binaries/linux/{{ nrinfragent_architecture }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}.tar.gz", "dest": "{{ nrinfragent_tarball_download_path }}.tar.gz"}, "executable": "get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create temporary file for bundle", "module": "ansible.builtin.tempfile", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Create temporary file for bundle", "register": "tarball_local", "delegate_to": "127.0.0.1", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"state": "file", "suffix": "temp"}, "executable": "ansible.builtin.tempfile", "executable_type": "Module", "fqcn": "ansible.builtin.tempfile", "annotations": {}}, {"py/object": "struct4.Task", "name": "downloading bundled agent file locally", "module": "get_url", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "downloading bundled agent file locally", "delegate_to": "127.0.0.1", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"url": "http://download.newrelic.com/infrastructure_agent/binaries/linux/{{ nrinfragent_architecture }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}.tar.gz", "dest": "{{ tarball_local.path }}"}, "executable": "get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "upload bundled agent file", "module": "copy", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "upload bundled agent file", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"src": "{{ tarball_local.path }}", "dest": "{{ nrinfragent_tarball_download_path }}.tar.gz"}, "executable": "copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "create agent destination directory", "module": "file", "index": 7, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "create agent destination directory"}, "module_options": {"path": "{{ nrinfragent_tarball_download_path }}", "state": "directory", "recurse": true, "mode": 438}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "uncompressing bundled agent file", "module": "unarchive", "index": 8, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "uncompressing bundled agent file", "register": "archive_contents"}, "module_options": {"src": "{{ nrinfragent_tarball_download_path }}.tar.gz", "dest": "{{ nrinfragent_tarball_download_path }}/", "remote_src": true, "creates": "{{ nrinfragent_tarball_download_path }}/newrelic-infra/"}, "executable": "unarchive", "executable_type": "Module", "fqcn": "ansible.builtin.unarchive", "annotations": {}}, {"py/object": "struct4.Task", "name": "Stop newrelic-infra if running", "module": "service", "index": 9, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Stop newrelic-infra if running", "failed_when": false}, "module_options": {"name": "newrelic-infra", "state": "stopped"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}, {"py/object": "struct4.Task", "name": "running installer", "module": "command", "index": 10, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "running installer", "args": {"chdir": "{{ nrinfragent_tarball_download_path }}/newrelic-infra/"}, "environment": {"NRIA_AGENT_DIR": "{{ nrinfragent_tarball_agent_dir | default('') }}", "NRIA_BIN_DIR": "{{ nrinfragent_tarball_bin_dir | default('') }}", "NRIA_CONFIG_FILE": "{{ nrinfragent_config_path | default('') }}", "NRIA_LICENSE_KEY": "{{ nrinfragent_config['license_key'] | default('') }}", "NRIA_LOG_FILE": "{{ nrinfragent_tarball_log_file | default('') }}", "NRIA_MODE": "{{ nrinfragent_tarball_mode | default('') }}", "NRIA_PID_FILE": "{{ nrinfragent_tarball_pid_file | default('') }}", "NRIA_PLUGIN_DIR": "{{ nrinfragent_tarball_plugin_dir | default('') }}", "NRIA_USER": "{{ nrinfragent_tarball_user | default('') }}", "NRIA_PROXY": "{{ nrinfragent_config['proxy'] | default('') }}"}, "become": true, "when": "archive_contents is defined and archive_contents.changed"}, "module_options": "./installer.sh", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Start newrelic-infra", "module": "service", "index": 11, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Start newrelic-infra"}, "module_options": {"name": "newrelic-infra", "state": "started"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml": {"py/object": "struct4.TaskFile", "name": "configure_agent.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "tasks": [{"py/object": "struct4.Task", "name": "ensure python-yaml is installed", "module": "package", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure python-yaml is installed", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'", "ansible_python_version is version('3.0', '<')"]}, "module_options": {"name": "python-yaml", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "ensure python3-yaml is installed", "module": "package", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure python3-yaml is installed", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'", "ansible_python_version is version('3.0', '>=')", "ansible_facts['os_family'] == 'Debian'"]}, "module_options": {"name": "python3-yaml", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "ensure pyYAML is installed via pip", "module": "pip", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure pyYAML is installed via pip", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != \"windows\"", "ansible_python_version is version('3.0', '>=')", "ansible_facts['os_family'] == 'RedHat'"]}, "module_options": {"name": "PyYAML"}, "executable": "pip", "executable_type": "Module", "fqcn": "ansible.builtin.pip", "annotations": {}}, {"py/object": "struct4.Task", "name": "Stat newrelic-infra.yml config file", "module": "stat", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Stat newrelic-infra.yml config file", "register": "nrinfragent_config_stat", "when": ["nrinfragent_os_name != 'windows'"]}, "module_options": {"path": "{{ nrinfragent_config_path }}"}, "executable": "stat", "executable_type": "Module", "fqcn": "ansible.builtin.stat", "annotations": {}}, {"py/object": "struct4.Task", "name": "Ensure newrelic-infra.yml exists", "module": "file", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Ensure newrelic-infra.yml exists", "when": ["nrinfragent_os_name != 'windows'", "nrinfragent_config_stat.stat.exists == false or nrinfragent_config_stat.stat.mode != '0600'"]}, "module_options": {"path": "{{ nrinfragent_config_path }}", "state": "touch", "mode": 384}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "Setup agent config *NIX", "module": "merge_yaml", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Setup agent config *NIX", "no_log": "{{ nrinfragent_hide_config_values }}", "notify": "restart newrelic-infra", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"src": "{{ nrinfragent_config_path }}", "value": "{{ nrinfragent_config }}"}, "executable": "merge_yaml", "executable_type": "Module", "fqcn": "merge_yaml", "annotations": {"use-non-builtin-module": true}}, {"py/object": "struct4.Task", "name": "setup agent config (windows)", "module": "win_template", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "setup agent config (windows)", "notify": "restart newrelic-infra (windows)", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"src": "newrelic-infra.yml.j2", "dest": "{{ nrinfragent_config_path }}"}, "executable": "win_template", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {"use-non-builtin-module": true}}, "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_integrations_pkgs.yml": {"py/object": "struct4.TaskFile", "name": "install_integrations_pkgs.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_integrations_pkgs.yml", "tasks": [{"py/object": "struct4.Task", "name": "install integrations", "module": "package", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_integrations_pkgs.yml", "options": {"name": "install integrations", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows'"}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml": {"py/object": "struct4.TaskFile", "name": "main.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "tasks": [{"py/object": "struct4.Task", "name": "installation from tarball package", "module": "import_tasks", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "installation from tarball package", "tags": ["nria_install_tarball"], "when": ["nrinfragent_tarball_version is defined", "nrinfragent_os_name != 'windows'"]}, "module_options": "install_targz.yml", "executable": "install_targz.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "install from standard distribution packages", "module": "import_tasks", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "install from standard distribution packages", "tags": ["nria_install"], "when": "nrinfragent_tarball_version is undefined"}, "module_options": "install_dist_pkgs.yml", "executable": "install_dist_pkgs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "install OHIs", "module": "import_tasks", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "install OHIs", "tags": ["nria_install_integrations"], "when": "nrinfragent_tarball_version is undefined"}, "module_options": "install_integrations_pkgs.yml", "executable": "install_integrations_pkgs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure the infrastructure agent", "module": "import_tasks", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "configure the infrastructure agent", "tags": ["nria_configure"]}, "module_options": "configure_agent.yml", "executable": "configure_agent.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent init service", "module": "import_tasks", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "setup agent init service", "tags": ["nria_setup_service"]}, "module_options": "setup_agent_service.yml", "executable": "setup_agent_service.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}}, "role_dict": {"newrelic.newrelic-infra": {"py/object": "struct4.Role", "name": "newrelic.newrelic-infra", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra", "fqcn": "newrelic.newrelic-infra", "collection": "", "taskfiles": [{"py/object": "struct4.TaskFile", "name": "install_dist_pkgs.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "tasks": [{"py/object": "struct4.Task", "name": "confirm redhat lsb util is present pre2.8.0", "module": "yum", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm redhat lsb util is present pre2.8.0", "when": "nrinfragent_os_name == 'redhat' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "redhat-lsb-core", "state": "present"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "confirm redhat lsb util is present post2.8.0", "module": "yum", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm redhat lsb util is present post2.8.0", "when": "nrinfragent_os_name == 'redhat' and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "redhat-lsb-core", "state": "present", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "reread ansible_lsb facts", "module": "setup", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "reread ansible_lsb facts", "when": "nrinfragent_os_name == 'redhat'"}, "module_options": {"filter": "ansible_lsb*"}, "executable": "setup", "executable_type": "Module", "fqcn": "ansible.builtin.setup", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "apt_key", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"url": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "apt_key", "executable_type": "Module", "fqcn": "ansible.builtin.apt_key", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "rpm_key", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'redhat'"}, "module_options": {"key": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "rpm_key", "executable_type": "Module", "fqcn": "ansible.builtin.rpm_key", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo keys", "module": "rpm_key", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo keys", "when": "nrinfragent_os_name == 'suse'"}, "module_options": {"key": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "state": "present"}, "executable": "rpm_key", "executable_type": "Module", "fqcn": "ansible.builtin.rpm_key", "annotations": {}}, {"py/object": "struct4.Task", "name": "confirm Debian apt-transport-https is present", "module": "apt", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "confirm Debian apt-transport-https is present", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"name": "apt-transport-https", "state": "present", "update_cache": true}, "executable": "apt", "executable_type": "Module", "fqcn": "ansible.builtin.apt", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "apt_repository", "index": 7, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'debian'"}, "module_options": {"repo": "deb https://download.newrelic.com/infrastructure_agent/linux/apt {{ nrinfragent_os_codename }} main", "state": "present", "update_cache": "yes"}, "executable": "apt_repository", "executable_type": "Module", "fqcn": "ansible.builtin.apt_repository", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "yum_repository", "index": 8, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_distribution == 'amazon'", "register": "setup_agent_repo_amazon"}, "module_options": {"baseurl": "https://download.newrelic.com/infrastructure_agent/linux/yum/el/{{ (ansible_service_mgr == 'upstart') | ternary('6', '7') }}/{{ ansible_architecture }}", "gpgcheck": "yes", "gpgkey": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "name": "newrelic-infra", "repo_gpgcheck": "yes", "state": "present", "description": "New Relic Infrastructure"}, "executable": "yum_repository", "executable_type": "Module", "fqcn": "ansible.builtin.yum_repository", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "yum_repository", "index": 9, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'redhat' and ansible_distribution|lower != 'amazon'", "register": "setup_agent_repo_redhat"}, "module_options": {"baseurl": "https://download.newrelic.com/infrastructure_agent/linux/yum/el/{{ nrinfragent_os_version }}/{{ ansible_architecture }}", "gpgcheck": "yes", "gpgkey": "https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg", "name": "newrelic-infra", "repo_gpgcheck": "{{ (nrinfragent_os_version == '5') | ternary('no', 'yes') }}", "state": "present", "description": "New Relic Infrastructure"}, "executable": "yum_repository", "executable_type": "Module", "fqcn": "ansible.builtin.yum_repository", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent repo reference", "module": "zypper_repository", "index": 10, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "setup agent repo reference", "when": "nrinfragent_os_name == 'suse'", "register": "infra_agent_zypper_repo"}, "module_options": {"name": "newrelic-infra", "description": "New Relic Infrastructure Agent", "repo": "http://download.newrelic.com/infrastructure_agent/linux/zypp/sles/{{ ansible_distribution_version }}/{{ ansible_machine }}/", "runrefresh": "yes", "auto_import_keys": "yes", "disable_gpg_check": "yes"}, "executable": "zypper_repository", "executable_type": "Module", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "run make cache to actually import gpg key", "module": "command", "index": 11, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "run make cache to actually import gpg key", "when": "nrinfragent_os_name == 'redhat' and (setup_agent_repo_amazon.changed or setup_agent_repo_redhat.changed)", "tags": ["skip_ansible_lint"], "args": {"warn": false}}, "module_options": "yum -q makecache -y --disablerepo='*' --enablerepo='newrelic-infra'", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "create log destination directory", "module": "file", "index": 12, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "create log destination directory", "when": ["nrinfragent_state != 'absent'", "nrinfragent_config['log_file'] is defined"]}, "module_options": {"path": "{{ nrinfragent_config['log_file'] | dirname }}", "state": "directory", "recurse": true}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "install agent pre2.8.0", "module": "package", "index": 13, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent pre2.8.0", "when": "nrinfragent_os_name != 'windows' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "install agent post2.8.0", "module": "package", "index": 14, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent post2.8.0", "when": "nrinfragent_os_name != 'windows' and ansible_version.full >= \"2.8.0\" and nrinfragent_os_name != 'amazon' and nrinfragent_os_name != 'redhat'"}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install agent yum", "module": "yum", "index": 15, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install agent yum", "when": "(nrinfragent_os_name == 'redhat' or nrinfragent_os_name == 'amazon') and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "install integrations pre2.8.0", "module": "package", "index": 16, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install integrations pre2.8.0", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows' and ansible_version.full < \"2.8.0\""}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install integrations post2.8.0", "module": "package", "index": 17, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install integrations post2.8.0", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows' and ansible_version.full >= \"2.8.0\" and nrinfragent_os_name != 'amazon' and nrinfragent_os_name != 'redhat'"}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "Install integrations yum", "module": "yum", "index": 18, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "Install integrations yum", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name == 'redhat' or nrinfragent_os_name == 'amazon' and ansible_version.full >= \"2.8.0\""}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}", "lock_timeout": "{{ nrinfragent_yum_lock_timeout }}"}, "executable": "yum", "executable_type": "Module", "fqcn": "ansible.builtin.yum", "annotations": {}}, {"py/object": "struct4.Task", "name": "install agent (windows)", "module": "win_chocolatey", "index": 19, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_dist_pkgs.yml", "options": {"name": "install agent (windows)", "when": ["nrinfragent_os_name == 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_state }}", "version": "{{ nrinfragent_choco_version | default(omit) }}"}, "executable": "win_chocolatey", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "setup_agent_service.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "tasks": [{"py/object": "struct4.Task", "name": "setup agent init service", "module": "service", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "options": {"name": "setup agent init service", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_service_state }}", "enabled": "{{ nrinfragent_service_enabled }}"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent init service (windows)", "module": "win_service", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_agent_service.yml", "options": {"name": "setup agent init service (windows)", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"name": "newrelic-infra", "state": "{{ nrinfragent_service_state }}", "start_mode": "{{ nrinfragent_service_enabled | ternary('auto','manual') }}"}, "executable": "win_service", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "setup_logging.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "tasks": [{"py/object": "struct4.Task", "name": "Setup logging", "module": "template", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "options": {"name": "Setup logging", "when": ["nrinfragent_logging is defined", "nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"src": "newrelic-logging.yml.j2", "dest": "/etc/newrelic-infra/logging.d/logging.yml", "trim_blocks": false}, "executable": "template", "executable_type": "Module", "fqcn": "ansible.builtin.template", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup logging (windows)", "module": "win_template", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/setup_logging.yml", "options": {"name": "setup logging (windows)", "when": ["nrinfragent_logging is defined", "nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"src": "newrelic-logging.yml.j2", "dest": "C:\\Program Files\\New Relic\\newrelic-infra\\logging.d\\logging.yml", "trim_blocks": false}, "executable": "win_template", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "install_targz.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "tasks": [{"py/object": "struct4.Task", "name": "validate agent tarball required variables", "module": "fail", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "validate agent tarball required variables", "when": "vars[item] is undefined or not vars[item]", "loop": ["nrinfragent_tarball_version", "nrinfragent_tarball_download_dir"]}, "module_options": {"msg": "Required variable {{ item }} has not been provided or it's null"}, "executable": "fail", "executable_type": "Module", "fqcn": "ansible.builtin.fail", "annotations": {}}, {"py/object": "struct4.Task", "name": "Set full download path", "module": "set_fact", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Set full download path"}, "module_options": {"nrinfragent_tarball_download_path": "{{ nrinfragent_tarball_download_dir }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}"}, "executable": "set_fact", "executable_type": "Module", "fqcn": "ansible.builtin.set_fact", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create the download directory, including intermediate ones", "module": "file", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Create the download directory, including intermediate ones"}, "module_options": {"path": "{{ nrinfragent_tarball_download_path }}", "state": "directory", "mode": 384}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "downloading bundled agent file", "module": "get_url", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "downloading bundled agent file", "when": "nrinfragent_tarball_from_local is undefined"}, "module_options": {"url": "http://download.newrelic.com/infrastructure_agent/binaries/linux/{{ nrinfragent_architecture }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}.tar.gz", "dest": "{{ nrinfragent_tarball_download_path }}.tar.gz"}, "executable": "get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "Create temporary file for bundle", "module": "ansible.builtin.tempfile", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Create temporary file for bundle", "register": "tarball_local", "delegate_to": "127.0.0.1", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"state": "file", "suffix": "temp"}, "executable": "ansible.builtin.tempfile", "executable_type": "Module", "fqcn": "ansible.builtin.tempfile", "annotations": {}}, {"py/object": "struct4.Task", "name": "downloading bundled agent file locally", "module": "get_url", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "downloading bundled agent file locally", "delegate_to": "127.0.0.1", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"url": "http://download.newrelic.com/infrastructure_agent/binaries/linux/{{ nrinfragent_architecture }}/newrelic-infra_linux_{{ nrinfragent_tarball_version }}_{{ nrinfragent_architecture }}.tar.gz", "dest": "{{ tarball_local.path }}"}, "executable": "get_url", "executable_type": "Module", "fqcn": "ansible.builtin.get_url", "annotations": {}}, {"py/object": "struct4.Task", "name": "upload bundled agent file", "module": "copy", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "upload bundled agent file", "when": "nrinfragent_tarball_from_local is defined"}, "module_options": {"src": "{{ tarball_local.path }}", "dest": "{{ nrinfragent_tarball_download_path }}.tar.gz"}, "executable": "copy", "executable_type": "Module", "fqcn": "ansible.builtin.copy", "annotations": {}}, {"py/object": "struct4.Task", "name": "create agent destination directory", "module": "file", "index": 7, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "create agent destination directory"}, "module_options": {"path": "{{ nrinfragent_tarball_download_path }}", "state": "directory", "recurse": true, "mode": 438}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "uncompressing bundled agent file", "module": "unarchive", "index": 8, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "uncompressing bundled agent file", "register": "archive_contents"}, "module_options": {"src": "{{ nrinfragent_tarball_download_path }}.tar.gz", "dest": "{{ nrinfragent_tarball_download_path }}/", "remote_src": true, "creates": "{{ nrinfragent_tarball_download_path }}/newrelic-infra/"}, "executable": "unarchive", "executable_type": "Module", "fqcn": "ansible.builtin.unarchive", "annotations": {}}, {"py/object": "struct4.Task", "name": "Stop newrelic-infra if running", "module": "service", "index": 9, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Stop newrelic-infra if running", "failed_when": false}, "module_options": {"name": "newrelic-infra", "state": "stopped"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}, {"py/object": "struct4.Task", "name": "running installer", "module": "command", "index": 10, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "running installer", "args": {"chdir": "{{ nrinfragent_tarball_download_path }}/newrelic-infra/"}, "environment": {"NRIA_AGENT_DIR": "{{ nrinfragent_tarball_agent_dir | default('') }}", "NRIA_BIN_DIR": "{{ nrinfragent_tarball_bin_dir | default('') }}", "NRIA_CONFIG_FILE": "{{ nrinfragent_config_path | default('') }}", "NRIA_LICENSE_KEY": "{{ nrinfragent_config['license_key'] | default('') }}", "NRIA_LOG_FILE": "{{ nrinfragent_tarball_log_file | default('') }}", "NRIA_MODE": "{{ nrinfragent_tarball_mode | default('') }}", "NRIA_PID_FILE": "{{ nrinfragent_tarball_pid_file | default('') }}", "NRIA_PLUGIN_DIR": "{{ nrinfragent_tarball_plugin_dir | default('') }}", "NRIA_USER": "{{ nrinfragent_tarball_user | default('') }}", "NRIA_PROXY": "{{ nrinfragent_config['proxy'] | default('') }}"}, "become": true, "when": "archive_contents is defined and archive_contents.changed"}, "module_options": "./installer.sh", "executable": "command", "executable_type": "Module", "fqcn": "ansible.builtin.command", "annotations": {}}, {"py/object": "struct4.Task", "name": "Start newrelic-infra", "module": "service", "index": 11, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_targz.yml", "options": {"name": "Start newrelic-infra"}, "module_options": {"name": "newrelic-infra", "state": "started"}, "executable": "service", "executable_type": "Module", "fqcn": "ansible.builtin.service", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "configure_agent.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "tasks": [{"py/object": "struct4.Task", "name": "ensure python-yaml is installed", "module": "package", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure python-yaml is installed", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'", "ansible_python_version is version('3.0', '<')"]}, "module_options": {"name": "python-yaml", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "ensure python3-yaml is installed", "module": "package", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure python3-yaml is installed", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'", "ansible_python_version is version('3.0', '>=')", "ansible_facts['os_family'] == 'Debian'"]}, "module_options": {"name": "python3-yaml", "state": "{{ nrinfragent_state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}, {"py/object": "struct4.Task", "name": "ensure pyYAML is installed via pip", "module": "pip", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "ensure pyYAML is installed via pip", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != \"windows\"", "ansible_python_version is version('3.0', '>=')", "ansible_facts['os_family'] == 'RedHat'"]}, "module_options": {"name": "PyYAML"}, "executable": "pip", "executable_type": "Module", "fqcn": "ansible.builtin.pip", "annotations": {}}, {"py/object": "struct4.Task", "name": "Stat newrelic-infra.yml config file", "module": "stat", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Stat newrelic-infra.yml config file", "register": "nrinfragent_config_stat", "when": ["nrinfragent_os_name != 'windows'"]}, "module_options": {"path": "{{ nrinfragent_config_path }}"}, "executable": "stat", "executable_type": "Module", "fqcn": "ansible.builtin.stat", "annotations": {}}, {"py/object": "struct4.Task", "name": "Ensure newrelic-infra.yml exists", "module": "file", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Ensure newrelic-infra.yml exists", "when": ["nrinfragent_os_name != 'windows'", "nrinfragent_config_stat.stat.exists == false or nrinfragent_config_stat.stat.mode != '0600'"]}, "module_options": {"path": "{{ nrinfragent_config_path }}", "state": "touch", "mode": 384}, "executable": "file", "executable_type": "Module", "fqcn": "ansible.builtin.file", "annotations": {}}, {"py/object": "struct4.Task", "name": "Setup agent config *NIX", "module": "merge_yaml", "index": 5, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "Setup agent config *NIX", "no_log": "{{ nrinfragent_hide_config_values }}", "notify": "restart newrelic-infra", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name != 'windows'"]}, "module_options": {"src": "{{ nrinfragent_config_path }}", "value": "{{ nrinfragent_config }}"}, "executable": "merge_yaml", "executable_type": "Module", "fqcn": "merge_yaml", "annotations": {"use-non-builtin-module": true}}, {"py/object": "struct4.Task", "name": "setup agent config (windows)", "module": "win_template", "index": 6, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml", "options": {"name": "setup agent config (windows)", "notify": "restart newrelic-infra (windows)", "when": ["nrinfragent_state != \"absent\"", "nrinfragent_os_name == 'windows'"]}, "module_options": {"src": "newrelic-infra.yml.j2", "dest": "{{ nrinfragent_config_path }}"}, "executable": "win_template", "executable_type": "Module", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {"use-non-builtin-module": true}}, {"py/object": "struct4.TaskFile", "name": "install_integrations_pkgs.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_integrations_pkgs.yml", "tasks": [{"py/object": "struct4.Task", "name": "install integrations", "module": "package", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/install_integrations_pkgs.yml", "options": {"name": "install integrations", "with_items": "{{ nrinfragent_integrations }}", "when": "nrinfragent_os_name != 'windows'"}, "module_options": {"name": "{{ item.name }}", "state": "{{ item.state }}"}, "executable": "package", "executable_type": "Module", "fqcn": "ansible.builtin.package", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}, {"py/object": "struct4.TaskFile", "name": "main.yml", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "tasks": [{"py/object": "struct4.Task", "name": "installation from tarball package", "module": "import_tasks", "index": 0, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "installation from tarball package", "tags": ["nria_install_tarball"], "when": ["nrinfragent_tarball_version is defined", "nrinfragent_os_name != 'windows'"]}, "module_options": "install_targz.yml", "executable": "install_targz.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "install from standard distribution packages", "module": "import_tasks", "index": 1, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "install from standard distribution packages", "tags": ["nria_install"], "when": "nrinfragent_tarball_version is undefined"}, "module_options": "install_dist_pkgs.yml", "executable": "install_dist_pkgs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "install OHIs", "module": "import_tasks", "index": 2, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "install OHIs", "tags": ["nria_install_integrations"], "when": "nrinfragent_tarball_version is undefined"}, "module_options": "install_integrations_pkgs.yml", "executable": "install_integrations_pkgs.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "configure the infrastructure agent", "module": "import_tasks", "index": 3, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "configure the infrastructure agent", "tags": ["nria_configure"]}, "module_options": "configure_agent.yml", "executable": "configure_agent.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}, {"py/object": "struct4.Task", "name": "setup agent init service", "module": "import_tasks", "index": 4, "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/main.yml", "options": {"name": "setup agent init service", "tags": ["nria_setup_service"]}, "module_options": "setup_agent_service.yml", "executable": "setup_agent_service.yml", "executable_type": "TaskFile", "fqcn": "", "annotations": {}}], "role": "newrelic.newrelic-infra", "used_in": [], "annotations": {}}], "modules": [{"py/object": "struct4.Module", "name": "merge_yaml", "fqcn": "merge_yaml", "collection": "", "role": "newrelic.newrelic-infra", "defined_in": "./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/library/merge_yaml.py", "builtin": false, "used_in": ["{\"path\": \"./role-test/testdata/newrelic-newrelic-infra/newrelic.newrelic-infra/tasks/configure_agent.yml\", \"index\": 5}"], "annotations": {}}], "source": "", "annotations": {"use-non-builtin-module": true}, "used_in": []}}, "annotations": {}}